<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Author-->
    
        <meta name="author" content="kaem"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="GraphQL &amp; React &amp; PSQL: Types, Queries &amp; Resolvers in Apollo Server"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Angry Chaired Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

    <!-- Title -->
    
    <title>GraphQL &amp; React &amp; PSQL: Types, Queries &amp; Resolvers in Apollo Server - Angry Chaired Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/angry-chaired-blog/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/angry-chaired-blog/images/favicon.ico"/>
    

<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/angry-chaired-blog/atom.xml" title="Angry Chaired Blog" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/angry-chaired-blog/">Angry Chaired Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li class="">
                        <a href="/angry-chaired-blog/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://angrychaired.surge.sh">
                            
                                <i class="fa fa-user fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://github.com/ikaem/">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a href="/angry-chaired-blog/atom.xml">
                            
                                <i class="fa fa-rss fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/angry-chaired-blog/images/header-image.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>GraphQL & React & PSQL: Types, Queries & Resolvers in Apollo Server</h1>

                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            16/08/2020
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/angry-chaired-blog/categories/graphql-react-psql/">graphql & react & psql</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Step Content Start -->

<h4 id="Part-5-of-9-in-GraphQL-amp-React-amp-PSQL"><a href="#Part-5-of-9-in-GraphQL-amp-React-amp-PSQL" class="headerlink" title="Part 5 of 9 in GraphQL &amp; React &amp; PSQL"></a>Part 5 of 9 in GraphQL &amp; React &amp; PSQL</h4><p>GraphQL requires a quick setup to be able to fetch and modify data in the database. In particular, it needs to know what type of data it deals with, what are the possible queries it might receive in regards to data, and how to actually resolve those queries.<br>This is what we deal with in this post.</p>
<a id="more"></a>

<h4 id="See-Project-Information"><a href="#See-Project-Information" class="headerlink" title="See Project Information"></a>See <a href="#Project-Information">Project Information</a></h4><h2 id="Step-5-Create-GQL-types-queries-and-resolvers-on-backend"><a href="#Step-5-Create-GQL-types-queries-and-resolvers-on-backend" class="headerlink" title="Step 5. Create GQL types, queries and resolvers on backend"></a>Step 5. Create GQL types, queries and resolvers on backend</h2><p>Let’s make these types, queries and resolvers. We will:</p>
<ol>
<li>Create modules for <strong>typeDefs</strong> and <strong>resolvers</strong>, and use those for data manipulation</li>
<li>We will also create <strong>context</strong> on our instance of Apollo Server Express, and make the same connection pool available to all resolvers.</li>
</ol>
<h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><p>Create folder <strong>gql</strong> in <strong>src</strong> folder.</p>
<h4 id="TypeDefs-module"><a href="#TypeDefs-module" class="headerlink" title="TypeDefs module"></a>TypeDefs module</h4><p>Inside <strong>gql</strong> folder, add file called <strong>type-defs.ts</strong>.<br>Inside the file, import <strong>gql</strong> from apollo-server-express, then write the module as shown below.</p>
<p>Note the different types od data we created:</p>
<ol>
<li><strong>User</strong></li>
<li><strong>UserForEdit</strong>, which returns data of type User, as well as all countries available in the PSQL countries table </li>
<li><strong>PaginatedUser</strong>, returning an array with data of User type, as well as additional data of Int and Boolean type that will help us create paginatin later in the post.</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/gql/type-defs.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; gql &#125; <span class="keyword">from</span> <span class="string">&quot;apollo-server-express&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> gql<span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        getUsers: [User]</span></span><br><span class="line"><span class="string">        getUser(id: Int!): User</span></span><br><span class="line"><span class="string">        getUserForEdit(id: Int): UserForEdit</span></span><br><span class="line"><span class="string">        getCountries: [Country]</span></span><br><span class="line"><span class="string">        getCountry(id: Int!): Country</span></span><br><span class="line"><span class="string">        getPaginatedCountries(cursor: Int): PaginatedCountries</span></span><br><span class="line"><span class="string">        getPaginatedUsers(cursor: Int): PaginatedUsers</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type Mutation &#123;</span></span><br><span class="line"><span class="string">        newUser(</span></span><br><span class="line"><span class="string">            email: String!</span></span><br><span class="line"><span class="string">            password: String!</span></span><br><span class="line"><span class="string">            first_name: String</span></span><br><span class="line"><span class="string">            last_name: String</span></span><br><span class="line"><span class="string">            country: Int</span></span><br><span class="line"><span class="string">            city: String</span></span><br><span class="line"><span class="string">            website: String</span></span><br><span class="line"><span class="string">            age: Int</span></span><br><span class="line"><span class="string">            hobbies: [String]!</span></span><br><span class="line"><span class="string">            avatar_link: String</span></span><br><span class="line"><span class="string">        ): User</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        editUser(</span></span><br><span class="line"><span class="string">            user_id: Int!</span></span><br><span class="line"><span class="string">            email: String!</span></span><br><span class="line"><span class="string">            first_name: String!</span></span><br><span class="line"><span class="string">            last_name: String!</span></span><br><span class="line"><span class="string">            country: Int!</span></span><br><span class="line"><span class="string">            city: String!</span></span><br><span class="line"><span class="string">            website: String!</span></span><br><span class="line"><span class="string">            age: Int!</span></span><br><span class="line"><span class="string">            hobbies: [String]!</span></span><br><span class="line"><span class="string">            avatar_link: String!</span></span><br><span class="line"><span class="string">        ): User</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        deleteUser(user_id: Int): Boolean</span></span><br><span class="line"><span class="string">        addCountry(country_name: String!): Country</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type User &#123;</span></span><br><span class="line"><span class="string">        user_id: ID</span></span><br><span class="line"><span class="string">        email: String</span></span><br><span class="line"><span class="string">        first_name: String</span></span><br><span class="line"><span class="string">        last_name: String</span></span><br><span class="line"><span class="string">        city: String</span></span><br><span class="line"><span class="string">        website: String</span></span><br><span class="line"><span class="string">        age: Int</span></span><br><span class="line"><span class="string">        hobbies: [String]</span></span><br><span class="line"><span class="string">        country: Country</span></span><br><span class="line"><span class="string">        avatar_link: String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type UserForEdit &#123;</span></span><br><span class="line"><span class="string">        user: User</span></span><br><span class="line"><span class="string">        countries: [Country]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type Country &#123;</span></span><br><span class="line"><span class="string">        country_id: ID</span></span><br><span class="line"><span class="string">        country_name: String</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type PaginatedCountries &#123;</span></span><br><span class="line"><span class="string">        countries: [Country]</span></span><br><span class="line"><span class="string">        cursor: Int</span></span><br><span class="line"><span class="string">        hasNextPage: Boolean</span></span><br><span class="line"><span class="string">        totalCountries: Int</span></span><br><span class="line"><span class="string">        countriesPerPage: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    type PaginatedUsers &#123;</span></span><br><span class="line"><span class="string">        users: [User]</span></span><br><span class="line"><span class="string">        cursor: Int</span></span><br><span class="line"><span class="string">        hasNextPage: Boolean</span></span><br><span class="line"><span class="string">        totalUsers: Int</span></span><br><span class="line"><span class="string">        usersPerPage: Int</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Resolvers-modules"><a href="#Resolvers-modules" class="headerlink" title="Resolvers modules"></a>Resolvers modules</h4><p>Now, create a new folder inside <strong>gql</strong>, and call it <strong>resolvers</strong>. We will put our resolvers modules here.</p>
<h5 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h5><p>First, lets make a module for <strong>Query</strong> resolvers. These are all resolvers that live directly inside the <strong>Query</strong> object on the resolvers object. Let’s call this module - <strong>query.ts</strong></p>
<p>Note the import of <strong>Pool</strong> from pg. We are doing this to use Pool as a type for pool connections that will eventually be provided to resolvers via <strong>context</strong>.</p>
<p>Few things: </p>
<ol>
<li>We are exporting an object, and include all resolvers in it as properties. </li>
<li>We use context argument, that holds an instance of the to node-postgres’ pool of connections. This way all resolvers have access to the same instance. We can call this instance with:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ontext.pgPool.query();</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Pool &#125; <span class="keyword">from</span> <span class="string">&quot;pg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    getCountry: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">id</span>: number&#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> getCountryRes = <span class="keyword">await</span> context.pgPool.query(<span class="string">`</span></span><br><span class="line"><span class="string">                SELECT country_id, country_name</span></span><br><span class="line"><span class="string">                FROM countries </span></span><br><span class="line"><span class="string">                WHERE country_id = <span class="subst">$&#123;args.id&#125;</span></span></span><br><span class="line"><span class="string">            `</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> getCountryRes.rows[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getCountries: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: any, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> getCountriesQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT country_id, country_name</span></span><br><span class="line"><span class="string">                FROM countries</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            <span class="keyword">const</span> getCountriesRes = <span class="keyword">await</span> context.pgPool.query(getCountriesQuery);</span><br><span class="line">            <span class="keyword">return</span> getCountriesRes.rows;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getUsers: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: any, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> userQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    users_login.user_id,</span></span><br><span class="line"><span class="string">                    users_login.email,</span></span><br><span class="line"><span class="string">                    users_info.first_name,</span></span><br><span class="line"><span class="string">                    users_info.last_name,</span></span><br><span class="line"><span class="string">                    users_info.city,</span></span><br><span class="line"><span class="string">                    users_info.website,</span></span><br><span class="line"><span class="string">                    users_info.&quot;age&quot;,</span></span><br><span class="line"><span class="string">                    users_info.hobbies,</span></span><br><span class="line"><span class="string">                    users_info.avatar_link</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    users_login</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                JOIN </span></span><br><span class="line"><span class="string">                    users_info</span></span><br><span class="line"><span class="string">                ON </span></span><br><span class="line"><span class="string">                    users_login.user_id = users_info.user_info_id;</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">            <span class="keyword">const</span> userSelect = <span class="keyword">await</span> context.pgPool.query(userQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> userSelect.rows</span><br><span class="line">            <span class="comment">// res.json(&#123;data: userSelect.rows&#125;);</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">            <span class="comment">// res.json(error);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getUser: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool&#125; ) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> userQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    users_login.user_id,</span></span><br><span class="line"><span class="string">                    users_login.email,</span></span><br><span class="line"><span class="string">                    users_info.first_name,</span></span><br><span class="line"><span class="string">                    users_info.last_name,</span></span><br><span class="line"><span class="string">                    users_info.city,</span></span><br><span class="line"><span class="string">                    users_info.website,</span></span><br><span class="line"><span class="string">                    users_info.&quot;age&quot;,</span></span><br><span class="line"><span class="string">                    users_info.hobbies,</span></span><br><span class="line"><span class="string">                    users_info.avatar_link</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    users_login</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                JOIN </span></span><br><span class="line"><span class="string">                    users_info</span></span><br><span class="line"><span class="string">                ON </span></span><br><span class="line"><span class="string">                    users_login.user_id = users_info.user_info_id</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    users_login.user_id = <span class="subst">$&#123;args.id&#125;</span></span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">            <span class="keyword">const</span> userSelect = <span class="keyword">await</span> context.pgPool.query(userQuery);</span><br><span class="line">            <span class="keyword">return</span> userSelect.rows[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    getUserForEdit: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">id</span>: number &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool&#125; ) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> client = <span class="keyword">await</span> context.pgPool.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;BEGIN&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> userQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    users_login.user_id,</span></span><br><span class="line"><span class="string">                    users_login.email,</span></span><br><span class="line"><span class="string">                    users_info.first_name,</span></span><br><span class="line"><span class="string">                    users_info.last_name,</span></span><br><span class="line"><span class="string">                    users_info.city,</span></span><br><span class="line"><span class="string">                    users_info.website,</span></span><br><span class="line"><span class="string">                    users_info.&quot;age&quot;,</span></span><br><span class="line"><span class="string">                    users_info.hobbies,</span></span><br><span class="line"><span class="string">                    users_info.avatar_link</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    users_login</span></span><br><span class="line"><span class="string">                JOIN </span></span><br><span class="line"><span class="string">                    users_info</span></span><br><span class="line"><span class="string">                ON </span></span><br><span class="line"><span class="string">                    users_login.user_id = users_info.user_info_id</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    users_login.user_id = <span class="subst">$&#123;args.id&#125;</span></span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            <span class="keyword">const</span> userSelect = <span class="keyword">await</span> client.query(userQuery);</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">const</span> countriesQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    country_id,</span></span><br><span class="line"><span class="string">                    country_name</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    countries</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> countriesSelect = <span class="keyword">await</span> client.query(countriesQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;COMMIT&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                user: userSelect.rows[<span class="number">0</span>],</span><br><span class="line">                countries: countriesSelect.rows</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            client.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getPaginatedCountries: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">cursor</span>: number &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> limit = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">const</span> client = <span class="keyword">await</span> context.pgPool.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;BEGIN&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> paginatedCountriesQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    country_id,</span></span><br><span class="line"><span class="string">                    country_name</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    countries</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    country_id &gt; <span class="subst">$&#123;args.cursor&#125;</span></span></span><br><span class="line"><span class="string">                LIMIT <span class="subst">$&#123;limit + <span class="number">1</span>&#125;</span>;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> paginatedCountriesRes = <span class="keyword">await</span> client.query(paginatedCountriesQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> numberOfCountriesQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    COUNT(country_id)</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    countries;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> numberOfCountriesRes = <span class="keyword">await</span> client.query(numberOfCountriesQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> hasNextPage = paginatedCountriesRes.rows.length &gt; limit;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> slicedCountries = paginatedCountriesRes.rows.slice(<span class="number">0</span>, limit);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> newCursor = slicedCountries[slicedCountries.length - <span class="number">1</span>].country_id;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;COMMIT&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                countries: slicedCountries,</span><br><span class="line">                cursor: newCursor,</span><br><span class="line">                hasNextPage,</span><br><span class="line">                totalCountries: numberOfCountriesRes.rows[<span class="number">0</span>].count,</span><br><span class="line">                countriesPerPage: limit</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">            client.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getPaginatedUsers: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">cursor</span>: number &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> limit = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">const</span> client = <span class="keyword">await</span> context.pgPool.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;BEGIN&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> paginatedUsersQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    users_login.user_id,</span></span><br><span class="line"><span class="string">                    users_login.email,</span></span><br><span class="line"><span class="string">                    users_info.first_name,</span></span><br><span class="line"><span class="string">                    users_info.last_name,</span></span><br><span class="line"><span class="string">                    users_info.city,</span></span><br><span class="line"><span class="string">                    users_info.website,</span></span><br><span class="line"><span class="string">                    users_info.&quot;age&quot;,</span></span><br><span class="line"><span class="string">                    users_info.hobbies,</span></span><br><span class="line"><span class="string">                    users_info.avatar_link</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    users_login</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                JOIN </span></span><br><span class="line"><span class="string">                    users_info</span></span><br><span class="line"><span class="string">                ON </span></span><br><span class="line"><span class="string">                    users_login.user_id = users_info.user_info_id</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    user_id &gt; <span class="subst">$&#123;args.cursor&#125;</span></span></span><br><span class="line"><span class="string">                ORDER BY users_login.user_id</span></span><br><span class="line"><span class="string">                LIMIT <span class="subst">$&#123;limit + <span class="number">1</span>&#125;</span>;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> paginatedUsersRes = <span class="keyword">await</span> client.query(paginatedUsersQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> numberOfUsersQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    COUNT(user_id)</span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    users_login;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> numberOfUsersRes = <span class="keyword">await</span> client.query(numberOfUsersQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> hasNextPage = paginatedUsersRes.rows.length &gt; limit;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> slicedUsers = paginatedUsersRes.rows.slice(<span class="number">0</span>, limit);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> newCursor = slicedUsers[slicedUsers.length - <span class="number">1</span>].user_id;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;COMMIT&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                users: slicedUsers,</span><br><span class="line">                cursor: newCursor,</span><br><span class="line">                hasNextPage,</span><br><span class="line">                totalUsers: numberOfUsersRes.rows[<span class="number">0</span>].count,</span><br><span class="line">                usersPerPage: limit</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">            client.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="User"><a href="#User" class="headerlink" title="User"></a>User</h5><p>In the <strong>User</strong> type, we defined that it has a property of <strong>country</strong>, which returns data of <strong>Country</strong> type. Note, however, that none of the resolvers that normally return User type, actually return any country-related data.<br>This is because we will create a separate resolver that will independently return country data for the User type, and it will do it every time User type is returned. Let’s do it now.</p>
<p>Create another file, and call it <strong>user.ts</strong>. We wil use this file as a module, to hold resolvers for all User’s properties that have more complex data types - that is, all properties that are not of basic types such as String or Integer.</p>
<p>In our case, the only such property is country. Since this property on the User type is called <strong>country</strong>, this is how we will call our resolver too.<br>Now, each time we query for <strong>User</strong> type, if we also require its <strong>country</strong> property, this particular resolver will be called</p>
<p>This is the case where we use the <strong>parent</strong> argument. The <strong>parent</strong> argument can hold all of the properties that the parent query returns.</p>
<ul>
<li>Parent query of the country resolver is the <strong>User</strong> type</li>
<li>And the property of User type that we need is its <strong>user_id</strong> - we need it to get the country of this user.</li>
</ul>
<p>Finally, we just export all resolvers (only <strong>country</strong> in our case) that we need.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Pool &#125; <span class="keyword">from</span> <span class="string">&quot;pg&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    country: <span class="keyword">async</span>(parent: &#123; <span class="attr">user_id</span>: number &#125;, <span class="attr">args</span>: any, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">typeof</span> parent.user_id);</span><br><span class="line">        <span class="built_in">console</span>.log(parent.user_id);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> getUserCountryQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                SELECT </span></span><br><span class="line"><span class="string">                    countries.country_id,</span></span><br><span class="line"><span class="string">                    countries.country_name </span></span><br><span class="line"><span class="string">                FROM </span></span><br><span class="line"><span class="string">                    countries</span></span><br><span class="line"><span class="string">                JOIN </span></span><br><span class="line"><span class="string">                    users_info</span></span><br><span class="line"><span class="string">                ON </span></span><br><span class="line"><span class="string">                    countries.country_id = users_info.country </span></span><br><span class="line"><span class="string">                WHERE</span></span><br><span class="line"><span class="string">                    users_info.user_info_id = <span class="subst">$&#123;parent.user_id&#125;</span>;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> getUserCountryRes = <span class="keyword">await</span> context.pgPool.query(getUserCountryQuery);</span><br><span class="line">            <span class="keyword">return</span> getUserCountryRes.rows[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h5><p>Finally, lets create resolvers for the <strong>Mutation</strong> type.</p>
<p>Create file <strong>mutation.ts</strong>, and Include code from the code block below, to create and export mutations that exist on the Mutation type.</p>
<p>Note the interfaces for arguments on <strong>newUser and editUser</strong> resolvers.</p>
<ol>
<li>This is required by TS</li>
<li>We have a base interface that holds properties that both resolvers’s arguments have</li>
<li>And then we create new interface for each of those resolvers, that extends the base interface, adding only a property specific for that particular interface. </li>
</ol>
<p>We also use bcrypt in these resolvers.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Pool &#125; <span class="keyword">from</span> <span class="string">&quot;pg&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; hash &#125; <span class="keyword">from</span> <span class="string">&quot;bcrypt&quot;</span>;</span><br><span class="line"></span><br><span class="line">interface mutateUserArgs &#123;</span><br><span class="line">    email?: string;</span><br><span class="line">    first_name?: string;</span><br><span class="line">    last_name?: string;</span><br><span class="line">    country?: number;</span><br><span class="line">    city?: string;</span><br><span class="line">    website?: string;</span><br><span class="line">    age?: number;</span><br><span class="line">    hobbies?: string[];</span><br><span class="line">    avatar_link?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface newUserArgs <span class="keyword">extends</span> mutateUserArgs &#123;</span><br><span class="line">    password?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface editUserArgs <span class="keyword">extends</span> mutateUserArgs &#123;</span><br><span class="line">    user_id: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    addCountry: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">country_name</span>: string &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> newCountryQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                INSERT INTO countries(country_name)</span></span><br><span class="line"><span class="string">                VALUES(&#x27;<span class="subst">$&#123;args.country_name&#125;</span>&#x27;)</span></span><br><span class="line"><span class="string">                RETURNING country_id, country_name;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            <span class="keyword">const</span> newCountryRes = <span class="keyword">await</span> context.pgPool.query(newCountryQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> newCountryRes.rows[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteUser: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: &#123; <span class="attr">user_id</span>: number &#125;, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> userDeleteQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                DELETE FROM users_login</span></span><br><span class="line"><span class="string">                WHERE user_id = <span class="subst">$&#123;args.user_id&#125;</span></span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> userDelete = <span class="keyword">await</span> context.pgPool.query(userDeleteQuery);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Boolean</span>(userDelete.rowCount);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    editUser: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: editUserArgs, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; user_id, email, first_name, last_name, country, city, website, age, hobbies, avatar_link &#125; = args;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> client = <span class="keyword">await</span> context.pgPool.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;BEGIN&quot;</span>);</span><br><span class="line">            <span class="keyword">const</span> users_loginUpdateQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                UPDATE users_login</span></span><br><span class="line"><span class="string">                SET </span></span><br><span class="line"><span class="string">                    email = &#x27;<span class="subst">$&#123;email&#125;</span>&#x27;</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    user_id = <span class="subst">$&#123;user_id&#125;</span></span></span><br><span class="line"><span class="string">                RETURNING </span></span><br><span class="line"><span class="string">                    user_id, </span></span><br><span class="line"><span class="string">                    email;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            <span class="keyword">const</span> users_loginUpdate = <span class="keyword">await</span> client.query(users_loginUpdateQuery);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">const</span> users_infoUpdateQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                UPDATE users_info</span></span><br><span class="line"><span class="string">                SET </span></span><br><span class="line"><span class="string">                    first_name = &#x27;<span class="subst">$&#123;first_name&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    last_name = &#x27;<span class="subst">$&#123;last_name&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    country = <span class="subst">$&#123;country&#125;</span>,</span></span><br><span class="line"><span class="string">                    city = &#x27;<span class="subst">$&#123;city&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    website = &#x27;<span class="subst">$&#123;website&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    &quot;age&quot; = <span class="subst">$&#123;age&#125;</span>,</span></span><br><span class="line"><span class="string">                    hobbies = &#x27;&#123;<span class="subst">$&#123;hobbies&#125;</span>&#125;&#x27;,</span></span><br><span class="line"><span class="string">                    avatar_link = &#x27;&#123;<span class="subst">$&#123;avatar_link&#125;</span>&#125;&#x27;</span></span><br><span class="line"><span class="string">                WHERE </span></span><br><span class="line"><span class="string">                    user_info_id = <span class="subst">$&#123;user_id&#125;</span></span></span><br><span class="line"><span class="string">                RETURNING </span></span><br><span class="line"><span class="string">                    first_name, </span></span><br><span class="line"><span class="string">                    last_name,</span></span><br><span class="line"><span class="string">                    city,</span></span><br><span class="line"><span class="string">                    website,</span></span><br><span class="line"><span class="string">                    &quot;age&quot;,</span></span><br><span class="line"><span class="string">                    hobbies,</span></span><br><span class="line"><span class="string">                    avatar_link</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">const</span> users_infoUpdate = <span class="keyword">await</span> client.query(users_infoUpdateQuery);</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;COMMIT&quot;</span>);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> &#123; </span><br><span class="line">                ...users_loginUpdate.rows[<span class="number">0</span>], </span><br><span class="line">                ...users_infoUpdate.rows[<span class="number">0</span>]</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            client.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    newUser: <span class="keyword">async</span>(parent: any, <span class="attr">args</span>: newUserArgs, <span class="attr">context</span>: &#123; <span class="attr">pgPool</span>: Pool &#125;) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; email, password, first_name, last_name, country, city, website, age, hobbies, avatar_link &#125; = args;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> client = <span class="keyword">await</span> context.pgPool.connect();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> hashed = <span class="keyword">await</span> hash(password, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;BEGIN&quot;</span>);</span><br><span class="line">            <span class="keyword">const</span> users_loginQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                INSERT INTO users_login (email, hash)</span></span><br><span class="line"><span class="string">                VALUES (&#x27;<span class="subst">$&#123;email&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;hashed&#125;</span>&#x27;)</span></span><br><span class="line"><span class="string">                RETURNING </span></span><br><span class="line"><span class="string">                    user_id, </span></span><br><span class="line"><span class="string">                    email;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> users_loginInsert = <span class="keyword">await</span> client.query(users_loginQuery);</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">const</span> users_infoQuery = <span class="string">`</span></span><br><span class="line"><span class="string">                INSERT INTO users_info(    </span></span><br><span class="line"><span class="string">                    user_info_id,</span></span><br><span class="line"><span class="string">                    first_name,</span></span><br><span class="line"><span class="string">                    last_name,</span></span><br><span class="line"><span class="string">                    country,</span></span><br><span class="line"><span class="string">                    city,</span></span><br><span class="line"><span class="string">                    website,</span></span><br><span class="line"><span class="string">                    &quot;age&quot;,</span></span><br><span class="line"><span class="string">                    hobbies,</span></span><br><span class="line"><span class="string">                    avatar_link</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                )</span></span><br><span class="line"><span class="string">                VALUES (</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;users_loginInsert.rows[<span class="number">0</span>].user_id&#125;</span>,</span></span><br><span class="line"><span class="string">                    &#x27;<span class="subst">$&#123;first_name&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    &#x27;<span class="subst">$&#123;last_name&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;country&#125;</span>,</span></span><br><span class="line"><span class="string">                    &#x27;<span class="subst">$&#123;city&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    &#x27;<span class="subst">$&#123;website&#125;</span>&#x27;,</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;age&#125;</span>,</span></span><br><span class="line"><span class="string">                    &#x27;&#123;<span class="subst">$&#123;hobbies&#125;</span>&#125;&#x27;,</span></span><br><span class="line"><span class="string">                    &#x27;<span class="subst">$&#123;avatar_link&#125;</span>&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                )</span></span><br><span class="line"><span class="string">                RETURNING             </span></span><br><span class="line"><span class="string">                    first_name,</span></span><br><span class="line"><span class="string">                    last_name,</span></span><br><span class="line"><span class="string">                    city,</span></span><br><span class="line"><span class="string">                    website,</span></span><br><span class="line"><span class="string">                    age,</span></span><br><span class="line"><span class="string">                    hobbies,</span></span><br><span class="line"><span class="string">                    avatar_link</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">const</span> users_infoInsert = <span class="keyword">await</span> client.query(users_infoQuery);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;COMMIT&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123; </span><br><span class="line">                ...users_loginInsert.rows[<span class="number">0</span>], </span><br><span class="line">                ...users_infoInsert.rows[<span class="number">0</span>] </span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="keyword">await</span> client.query(<span class="string">&quot;ROLLBACK&quot;</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            client.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="Uniting-all-resolvers-into-a-single-module"><a href="#Uniting-all-resolvers-into-a-single-module" class="headerlink" title="Uniting all resolvers into a single module"></a>Uniting all resolvers into a single module</h5><p>At the moment we have these modules living separately, and not combined into one object.<br>Good practice is to combine them into one object, and than import that object into server.ts, to be used by the instance of Apollo Server Express.<br>We want the shape of our resolvers object to be as in the code block below:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">resolvers = &#123;</span><br><span class="line">    Query: &#123;</span><br><span class="line">        different,</span><br><span class="line">        resolvers,</span><br><span class="line">        here</span><br><span class="line">    &#125;,</span><br><span class="line">    Mutation: &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    User &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So let’s have a place where we import all these resolvers and unite them into one object to give resolvers the necessary shape.</p>
<p>Create <strong>index.ts</strong> in the <strong>resolvers</strong> folder, and import all resolvers into it.<br>Then, export all imported resolvers as properties of the default exported object:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/gql/resolvers/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">&quot;./user&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Query <span class="keyword">from</span> <span class="string">&quot;./query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Mutation <span class="keyword">from</span> <span class="string">&quot;./mutation&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    User,</span><br><span class="line">    Query,</span><br><span class="line">    Mutation</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can import both type-defs and index.ts modules into server.ts.</p>
<ol>
<li>Delete test typeDefs and resolvers variables that exist in server.ts</li>
<li>Import typeDefs and resolvers from gql and resolvers folders</li>
<li><strong>typeDefs</strong> and <strong>resolvers</strong> properties on the argument to ApolloServer class now refer to out imported modules</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> typeDefs <span class="keyword">from</span> <span class="string">&quot;./gql/type-defs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> resolvers <span class="keyword">from</span> <span class="string">&quot;./gql/resolvers/index&quot;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ApolloServer(&#123;</span><br><span class="line">    typeDefs,</span><br><span class="line">    resolvers,</span><br><span class="line">&#125;);</span><br><span class="line">server.applyMiddleware(&#123; app, <span class="attr">path</span>: <span class="string">&quot;/grapqhl&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Setting-up-the-context-on-the-instance-of-Apollo-Server-Express"><a href="#Setting-up-the-context-on-the-instance-of-Apollo-Server-Express" class="headerlink" title="Setting up the context on the instance of Apollo Server Express"></a>Setting up the context on the instance of Apollo Server Express</h3><p>We need a way to provide access to connection clients to PSQL database.<br>We will use context for this.</p>
<p>Add another property to ApolloServer’s object argument, and call it <strong>context</strong>.<br>It is a function to which we will not provide any arguments at this point</p>
<p>We will have it return an object. This object will hold a reference to our instance of Pool connection</p>
<p>That’s it, we are done. Our resolvers now have access to the PSQL database</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">import</span> pgPool <span class="keyword">from</span> <span class="string">&quot;./pg/pg-connection&quot;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> ApolloServer(&#123;</span><br><span class="line">    typeDefs,</span><br><span class="line">    resolvers,</span><br><span class="line">    context: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            pgPool</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<!-- End Step Content -->
<!-- Project Information -->

<h2 id="Project-Information"><a href="#Project-Information" class="headerlink" title="Project Information"></a>Project Information</h2><h3 id="Available-at"><a href="#Available-at" class="headerlink" title="Available at"></a>Available at</h3><p><a target="_blank" rel="noopener" href="https://github.com/ikaem/graphql-jwt-react.git">Github</a> </p>
<h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><ol>
<li>Create an app that uses GrapqhQL on frontend and backend</li>
<li>Use PSQL for database</li>
<li>Use Typescript on both ends</li>
<li>The app should be hold a list of users that can be created, viewed, edited, and deleted.</li>
</ol>
<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><ol>
<li>Make simple Node and Express server with TypeScript</li>
<li>Create a PostgreSQL database and tables that hold user info</li>
<li>Use node-postgres to connect backend to database</li>
<li>Set up Apollo Express Server</li>
<li><strong>Create GQL types, queries and resolvers on backend</strong></li>
<li>Make simple frontend with React and TS</li>
<li>Set Apollo Client on frontend</li>
<li>Establish frontend and backend communication via Apollo Client</li>
<li>Create pagination</li>
</ol>
<h3 id="Tech-and-Tools"><a href="#Tech-and-Tools" class="headerlink" title="Tech and Tools"></a>Tech and Tools</h3><ol>
<li>React</li>
<li>React Router</li>
<li>Styled Components</li>
<li>Node</li>
<li>PSQL</li>
<li>GraphQL</li>
<li>Apollo Server Express</li>
<li>Apollo Client</li>
<li>Bcrypt</li>
<li>TypeScript</li>
<li>Express</li>
</ol>
<h3 id="Experience-with-Tech-amp-Tools"><a href="#Experience-with-Tech-amp-Tools" class="headerlink" title="Experience with Tech &amp; Tools"></a>Experience with Tech &amp; Tools</h3><p>I am new to Typescript, have super little experience with PSQL and GQL and just a tiny bit more skills with Node and Express.<br>I am relatively ok with JS, React and other frontend stuff from the list but I am no way even close to be a seasoned frontend person.</p>
<h2 id="DISCLAIMER"><a href="#DISCLAIMER" class="headerlink" title="DISCLAIMER"></a>DISCLAIMER</h2><p>Don’t take any of this seriously and as a matter-of-fact. These are my notes. It might look like I am trying to teach something to someone. I am not.</p>


                


                <!-- Cover image credit -->
                

  

            </div>
            
            <!-- Custom placed tags -->
            <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                
                    


<a href="/angry-chaired-blog/tags/apollo/">#apollo</a> <a href="/angry-chaired-blog/tags/graphql/">#graphql</a> <a href="/angry-chaired-blog/tags/backend/">#backend</a> <a href="/angry-chaired-blog/tags/types/">#types</a> <a href="/angry-chaired-blog/tags/queries/">#queries</a> <a href="/angry-chaired-blog/tags/resolvers/">#resolvers</a>


                
            </div>
            <!--  -->



            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            

            <!-- Hyvor comments -->

            <!-- End of Hyvor comments -->
        </div>
    </div>
</article>



    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2020 kaem<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>