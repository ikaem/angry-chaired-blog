<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Author-->
    
        <meta name="author" content="kaem"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="React Testing with Jest &amp; Enzyme: Integration Testing"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Angry Chaired Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

    <!-- Title -->
    
    <title>React Testing with Jest &amp; Enzyme: Integration Testing - Angry Chaired Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/angry-chaired-blog/css/style.css">

    
<link rel="stylesheet" href="/angry-chaired-blog/css/custom-style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/angry-chaired-blog/images/favicon.ico"/>
    

<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/angry-chaired-blog/atom.xml" title="Angry Chaired Blog" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/angry-chaired-blog/">Angry Chaired Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li class="">
                        <a href="/angry-chaired-blog/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://angrychaired.surge.sh">
                            
                                <i class="fa fa-user fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://github.com/ikaem/">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a href="/angry-chaired-blog/atom.xml">
                            
                                <i class="fa fa-rss fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('victor-he-2OakH-piKzU-unsplash.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>React Testing with Jest & Enzyme: Integration Testing</h1>

                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            01/12/2020
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/angry-chaired-blog/categories/react-test-driven-development-with-jest-enzyme/">react test driven development with jest & enzyme</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Step Content Start -->

<h4 id="Part-2-of-2-in-React-Testing-with-Jest-amp-Enzyme"><a href="#Part-2-of-2-in-React-Testing-with-Jest-amp-Enzyme" class="headerlink" title="Part 2 of 2 in React Testing with Jest &amp; Enzyme"></a>Part 2 of 2 in React Testing with Jest &amp; Enzyme</h4><p>We continue with our React app created in TDD approach. In the <a href="/angry-chaired-blog/2020/react-testing-with-jest-enzyme-unit-testing/" title="previous post">previous post</a> we got introduced to TDD and Enzyme, and we wrote unit tests for components in our React app.<br>In this post we will write integration tests, to make sure our components work well together.</p>
<a id="more"></a>

<h4 id="See-Project-Information"><a href="#See-Project-Information" class="headerlink" title="See Project Information"></a>See <a href="#Project-Information">Project Information</a></h4><p>By ‘integration tests’, I mean that we will do something in one component, and then see what consequences this has in another component.<br>We do this by rendering a parent component that holds components that we want to do integration tests on. By chance, ‘App’ component is a direct parent of all our other components, so we will render ‘App’.<br>In other projects this does not have to be the case, and integration tests could be done by rendering (or ‘mounting’) different parent components for different integration tests.</p>
<p>We will do ‘mounting’ with the <strong>mount</strong> method, which is provided by Enzyme. The <strong>mount</strong> method is similar to <strong>shallow</strong> method that we used in the previous post, in that it renders a passed in component in memory.<br>However, unlike <strong>shallow</strong>, <strong>mount</strong> will render the component we pass to it, as well as all of the component’s nested components. This way we will be able to select elements inside the nested components, perform actions on them, and inspect them.</p>
<p>Before we start with integration tests, however, we still have one more component to do unit testing on. This is the ‘App’ component, and we will do this first.</p>
<p>Here is what we will do in this post:</p>
<ol>
<li>Unit testing of ‘App’ component</li>
<li>Integration testing - rendering values in ‘Answer’ component</li>
<li>Integration testing - rendering ‘CustomButton’ component instances</li>
<li>Integration testing - rendering sentence correctly in ‘Sentence’ component</li>
</ol>
<h2 id="Step-1-Unit-testing-of-‘App’-component"><a href="#Step-1-Unit-testing-of-‘App’-component" class="headerlink" title="Step 1: Unit testing of ‘App’ component"></a>Step 1: Unit testing of ‘App’ component</h2><p>‘App’ component is in charge of organizing data flow between other components and Redux store, and as such needs to have access to the store.</p>
<p>We will do this setup now, before we move on with the testing.</p>
<p>First, Redux Store Provider is wrapped around ‘App’ component in <strong>src/index.tsx</strong> file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\index.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&quot;./store/index&quot;</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  &lt;/React.StrictMode&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Next, we have our ‘App’ component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Finally, we create a test file in <strong>src/tests</strong> folder, and call it <strong>app.test.tsx</strong>.<br>For now, we will import <strong>shallow</strong> from “enzyme” into it, as well as the ‘App’ component itself. We will also create a <strong>setup</strong> function, and set up a test suite.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\app.test.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">&quot;enzyme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> shallow(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&quot;&#x27;App&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>Now onto the test.<br>We plan to have two unit tests here: one to make sure that the component is rendering properly, and another one just to test that the first game question is properly rendered.</p>
<p>The second test will not really test any app feature. Questions will never be rendered directly in the ‘App’ component, but only in the ‘Answer’ component. Still, I want to include this test in the ‘App’s unit testing to make sure that ‘App’ property fetches questions from Redux state.</p>
<p>So let’s start with the first test. It is an easy one. As before, we create a shallow wrapper, and make sure that our component is rendered inside it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;&#x27;App&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&quot;renders without crashing&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">    <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">    expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Of course, the test fails. We don’t have an element with the <strong>data-test</strong> attribute on it, so let’s make one.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-test</span>=<span class="string">&quot;component-app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Great. This works.</p>
<p>Now the second test. Again, this test is a temporary one. We are testing that ‘App’ component can get store values from Redux.</p>
<p>To do this, we will shallowly render a component, as usual. Then we will assert that a ‘span’ element in the component holds a string of value “Who?”, which is the first question in the Redux store state.</p>
<p>Here is the test:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;&#x27;App&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  test(<span class="string">&quot;renders current question&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">    <span class="keyword">const</span> testSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;test-span&#x27;]&quot;</span>);</span><br><span class="line">    expect(testSpan.props().children).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>We already know that the test fails. Fixing the component to make the test pass will take several steps, so let’s start by dealing with whatever Jest warns us at the moment:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/app.test.tsx</span><br><span class="line"> ● <span class="string">&#x27;App&#x27;</span> component › renders current question</span><br><span class="line"></span><br><span class="line">   Method “props” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">     <span class="number">33</span> |     <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">     <span class="number">34</span> |     <span class="keyword">const</span> testSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;test-span&#x27;]&quot;</span>);</span><br><span class="line">   &gt; <span class="number">35</span> |     expect(testSpan.prop(<span class="string">&quot;children&quot;</span>)).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">        |                     ^</span><br><span class="line">     <span class="number">36</span> |   &#125;);</span><br><span class="line">     <span class="number">37</span> | &#125;);</span><br><span class="line">     <span class="number">38</span> |</span><br><span class="line"></span><br><span class="line">     at ShallowWrapper.single (node_modules/enzyme/src/ShallowWrapper.js:<span class="number">1652</span>:<span class="number">13</span>)</span><br><span class="line">     at ShallowWrapper.props (node_modules/enzyme/src/ShallowWrapper.js:<span class="number">1175</span>:<span class="number">17</span>)</span><br><span class="line">     at ShallowWrapper.prop (node_modules/enzyme/src/ShallowWrapper.js:<span class="number">1311</span>:<span class="number">17</span>)</span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">35</span>:<span class="number">21</span>)</span><br></pre></td></tr></table></figure>

<p>As we can see, Jest points out that there is no <strong>testSpan</strong> object that <strong>props</strong> method can run on.<br>So first step is to create such a span element in the ‘App’ component, and attach a <strong>data-test</strong> attribute on it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Alright. If we run the test again, we still get an error, but a different one this time:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/app.test.tsx (<span class="number">5.016</span> s)</span><br><span class="line"> ● <span class="string">&#x27;App&#x27;</span> component › renders current question</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="string">&quot;What?&quot;</span></span><br><span class="line">   Received: <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">     <span class="number">33</span> |     <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">     <span class="number">34</span> |     <span class="keyword">const</span> testSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;test-span&#x27;]&quot;</span>);</span><br><span class="line">   &gt; <span class="number">35</span> |     expect(testSpan.props().children).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">        |                                       ^</span><br><span class="line">     <span class="number">36</span> |   &#125;);</span><br><span class="line">     <span class="number">37</span> | &#125;);</span><br><span class="line">     <span class="number">38</span> |</span><br><span class="line"></span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">35</span>:<span class="number">39</span>)</span><br></pre></td></tr></table></figure>

<p>Here, Jest says that the received value is undefined, which is not surprising considering that we don’t render any value in the ‘span’ element.</p>
<p>So how do we get that question inside the ‘span’.<br>Well, the question we need is in the Redux store, so we need to get it from there. To accomplish this, we can use Redux’s <strong>useSelector</strong> hook, and fetch that first question from the store.</p>
<p>Here is the ‘App’ component code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useSelector &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[<span class="number">0</span>].question</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;&#123;question&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Before we run tests, let’s open the app in the browser and see what is rendered. We should see ‘who’ rendered on the screen.</p>
<p>However, if we run our tests, we will get an error. A bit different one, too:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> FAIL  src/tests/app.test.tsx (<span class="number">5.236</span> s)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  ● <span class="string">&#x27;App&#x27;</span> component › renders current question</span><br><span class="line"></span><br><span class="line">    could not find react-redux context value; please ensure the component is wrapped <span class="keyword">in</span> a &lt;Provider&gt;</span><br><span class="line"></span><br><span class="line">      <span class="number">22</span> |</span><br><span class="line">      <span class="number">23</span> | <span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    &gt; <span class="number">24</span> |   <span class="keyword">const</span> question = useSelector(</span><br><span class="line">         |                    ^</span><br><span class="line">      <span class="number">25</span> |     <span class="function">(<span class="params">state: RootStateType</span>) =&gt;</span></span><br><span class="line">state.questions[<span class="number">0</span>].question</span><br><span class="line">      <span class="number">26</span> |   );</span><br><span class="line">      <span class="number">27</span> |   <span class="keyword">return</span> (</span><br></pre></td></tr></table></figure>

<p>The error that Jest throws tells us that our component is not wrapped in a Redux provider. Indeed, even if we did wrap the ‘App’ component inside a Redux provider (in <strong>index.tsx</strong>), that was valid only for the app that gets rendered in the browser environment.<br>Our test environment does not have ‘App’ component wrapped in a provider because we start the test application from the ‘App’ component itself. Inside the component, there is no Redux provider that would actually provide a store for the <strong>useSelector</strong> hook. Because of this, Jest throws an error.</p>
<p>So how to fix this? Well, let’s wrap the the ‘App’ component in a provider.<br>We do this in the test file, by importing <strong>Provider</strong> from ‘react-redux’, and than wrapping it around the ‘App’ component in the <strong>setup</strong> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\app.test.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// import React from &quot;react&quot;;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">&quot;enzyme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> store = storeFactory();</span><br><span class="line">  <span class="keyword">return</span> shallow(</span><br><span class="line">    &lt;Provider&gt;</span><br><span class="line">      &#123;<span class="string">&quot; &quot;</span>&#125;</span><br><span class="line">      <span class="comment">/* Property &#x27;store&#x27; is missing */</span></span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Since we are using TypeScript, we immediately get a warning that the provider is missing the <strong>store</strong> property. This makes sense, as Redux provider does need to provide some value to its children components.</p>
<p>So how to get the store? We could use the store that we created for the app itself. However, that would mean that we mix testing and production code, and this does not seem like a good idea.<br>Better would be to create a store specifically meant to be used in testing. It would still use the same reducer as in the production store, but it would be its own entity, and it would get reset every time we call <strong>setup</strong> function to create a testing wrapper.</p>
<p>We will create this store as a return from a so-called store factory function. This function is a testing utility, and it will live in <strong>testing/test-utils.ts</strong> module.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// testing\test-utils.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">&quot;redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; rootReducer &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/index&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; QuestionStateObjectInterface &#125; <span class="keyword">from</span> <span class="string">&quot;../src/store/reducers/questions.reducer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> storeFactory = (</span><br><span class="line">  preloadedState?: QuestionStateObjectInterface[]</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> createStore(rootReducer, &#123; <span class="attr">questions</span>: preloadedState &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>What do we have here?<br>Well, we create a function that returns a value created by the Redux’s <strong>createStore</strong> method.<br>We pass our <strong>rootReducer</strong> to it, and we also pass a second argument to it, which is a preloaded state that we might want to use when we create a store.<br>We will be taking advantage of preloaded state while testing, to pass different store values into the application.</p>
<p>Great. Now we can import this store factory function into the test file, and use it the provide a store to the test application.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\app.test.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// import React from &quot;react&quot;;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shallow &#125; <span class="keyword">from</span> <span class="string">&quot;enzyme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; storeFactory &#125; <span class="keyword">from</span> <span class="string">&quot;../../testing/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> store = storeFactory();</span><br><span class="line">  <span class="keyword">return</span> shallow(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Nice. Our ‘App’ component is now wrapped into Redux provider, and the <strong>useSelector</strong> should have access to the store.</p>
<p>However, if we look at the output created by Jest, we will see that we still have errors. In fact, we now have 2 tests failing: both the “renders without crashing” one, and the “renders current question”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> FAIL  src/tests/app.test.tsx</span><br><span class="line">  ● <span class="string">&#x27;App&#x27;</span> component › renders without crashing</span><br><span class="line"></span><br><span class="line">    expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">    Expected: <span class="number">1</span></span><br><span class="line">    Received: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="number">27</span> |     <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">      <span class="number">28</span> |     <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">    &gt; <span class="number">29</span> |     expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">         |                              ^</span><br><span class="line">      <span class="number">30</span> |   &#125;);</span><br><span class="line">      <span class="number">31</span> |</span><br><span class="line">      <span class="number">32</span> |   test(<span class="string">&quot;renders current question&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">29</span>:<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line">  ● <span class="string">&#x27;App&#x27;</span> component › renders current question</span><br><span class="line"></span><br><span class="line">    Method “props” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">      <span class="number">33</span> |     <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">      <span class="number">34</span> |     <span class="keyword">const</span> testSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;test-span&#x27;]&quot;</span>);</span><br><span class="line">    &gt; <span class="number">35</span> |     expect(testSpan.props().children).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">         |                     ^</span><br><span class="line">      <span class="number">36</span> |   &#125;);</span><br><span class="line">      <span class="number">37</span> | &#125;);</span><br><span class="line">      <span class="number">38</span> |</span><br><span class="line"></span><br><span class="line">      at ShallowWrapper.single (node_modules/enzyme/src/ShallowWrapper.js:<span class="number">1652</span>:<span class="number">13</span>)</span><br><span class="line">      at ShallowWrapper.props (node_modules/enzyme/src/ShallowWrapper.js:<span class="number">1175</span>:<span class="number">17</span>)</span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">35</span>:<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line">Test Suites: <span class="number">1</span> failed, <span class="number">1</span> passed, <span class="number">2</span> total</span><br><span class="line">Tests:       <span class="number">2</span> failed, <span class="number">1</span> passed, <span class="number">3</span> total</span><br><span class="line">Snapshots:   <span class="number">0</span> total</span><br><span class="line">Time:        <span class="number">8.276</span> s</span><br><span class="line">Ran all test suites related to changed files.</span><br></pre></td></tr></table></figure>

<p>The first one is particulary surprising, considering that we have already passed that one.<br>Let’s look at the error a bit better.<br>What we see is that Jest cannot find the element we ask it to find, and our assertion fails. Returned length is 0, when we except it to be 1.<br>Why is that?</p>
<p>Well, remember that <strong>shallow</strong> fully renders only the surface component we pass to it. Anything else nested inside this surface component is represented only by a placeholder, and whaterver might be inside a nested component will not be rendered. Because of this, element that we ask Jest to find cannot be found.</p>
<p>To visualise this, let’s use <strong>debug()</strong> method to log the HTML output of the component rendered by the <strong>shallow</strong> method:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders without crashing&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;here is the shallow component:&quot;</span>, wrapper.debug());</span><br><span class="line">  <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">  expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Here is the output:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">● Console</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log</span><br><span class="line">    here is the shallow component: ShallowWrapper &#123;&#125;</span><br><span class="line"></span><br><span class="line">    at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">28</span>:<span class="number">13</span>)</span><br></pre></td></tr></table></figure>

<p>As we can see, <strong>shallow</strong> only renders the outer wrapper, and not the ‘App’ component.<br>So what to do?</p>
<p>Enzyme provides a <strong>dive()</strong> method which we might be able to use to deal with this.<br><strong>dive()</strong> will render a node of the current wrapper, and then will return a wrapper around the result. The node has to be a React component.<br><strong>dive()</strong> chains onto a wrapper, as in the code below:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders without crashing&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup().dive();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;here is the shallow component:&quot;</span>, wrapper.debug());</span><br><span class="line">  <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">  expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Here, we chained <strong>dive()</strong> onto the return of <strong>setup()</strong> function, and then assigned the return to the <strong>wrapper</strong> variable.</p>
<p>If we try to run the test to see the output created by <strong>debug()</strong> function, we will see new log:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/app.test.tsx</span><br><span class="line"> ● Console</span><br><span class="line"></span><br><span class="line">   <span class="built_in">console</span>.log</span><br><span class="line">     here is the shallow component: <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">28</span>:<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"> ● <span class="string">&#x27;App&#x27;</span> component › renders without crashing</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="number">1</span></span><br><span class="line">   Received: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">     <span class="number">28</span> |     <span class="built_in">console</span>.log(<span class="string">&quot;here is the shallow component:&quot;</span>, wrapper.debug());</span><br><span class="line">     <span class="number">29</span> |     <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">   &gt; <span class="number">30</span> |     expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">        |                              ^</span><br><span class="line">     <span class="number">31</span> |   &#125;);</span><br><span class="line">     <span class="number">32</span> |</span><br><span class="line">     <span class="number">33</span> |   test(<span class="string">&quot;renders current question&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">30</span>:<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<p>While we do get new output by the <strong>debug()</strong> method, we still get the same error: 0 elements with <strong>data-test</strong> attribute were found.</p>
<p>If we try to chain one more <strong>dive()</strong> onto return of the <strong>setup()</strong> function, we will finally be able to penetrate inside the ‘App’ component. But, we will encounter a familiar problem again: there is no Redux provider available from which <strong>useSelector</strong> hook would grab store state.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/app.test.tsx</span><br><span class="line"> ● <span class="string">&#x27;App&#x27;</span> component › renders without crashing</span><br><span class="line"></span><br><span class="line">   could not find react-redux context value; please ensure the component is wrapped <span class="keyword">in</span> a &lt;Provider&gt;</span><br><span class="line"></span><br><span class="line">     <span class="number">22</span> |</span><br><span class="line">     <span class="number">23</span> | <span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   &gt; <span class="number">24</span> |   <span class="keyword">const</span> question = useSelector(</span><br><span class="line">        |                    ^</span><br><span class="line">     <span class="number">25</span> |     <span class="function">(<span class="params">state: RootStateType</span>) =&gt;</span> state.questions[<span class="number">0</span>].question</span><br><span class="line">     <span class="number">26</span> |   );</span><br><span class="line">     <span class="number">27</span> |   <span class="keyword">return</span> (</span><br></pre></td></tr></table></figure>

<p>What a bummer.<br>So what to do about this? Issue that we have is that our ‘App’ component does not get properly rendered so that it can use Redux provider, and that Enzyme can find its rendered element. This is the limitation imposed by <strong>shallow</strong> method.</p>
<p>Enzyme, however, provides another method to render components in memory. This method is called <strong>mount</strong>, and it fully renders the component passed to it, as well as all other components nested inside it.<br>Obviously, because of such rendering, <strong>mount</strong> takes up much more memory. Still, it seems like we need it here.</p>
<p>To employ <strong>mount</strong>, we will import it from “enzyme”, and then use it in <strong>setup()</strong> function in place of <strong>shallow</strong>.<br>We will also remove all calls to the <strong>dive()</strong> method in our tests.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\app.test.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;enzyme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; storeFactory &#125; <span class="keyword">from</span> <span class="string">&quot;../../testing/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> store = storeFactory();</span><br><span class="line">  <span class="keyword">return</span> mount(</span><br><span class="line">    <span class="comment">// return shallow(</span></span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&quot;&#x27;App&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&quot;renders without crashing&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;here is the shallow component:&quot;</span>, wrapper.debug());</span><br><span class="line">    <span class="keyword">const</span> component = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-app&#x27;]&quot;</span>);</span><br><span class="line">    expect(component.length).toBe(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>This passes our tests.<br>Since we are here, we can also check the log of <strong>debug()</strong> method, to see HTML of the rendered app:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log</span><br><span class="line">  here is the shallow component:</span><br><span class="line">  &lt;Provider store=&#123;&#123;...&#125;&#125;&gt;</span><br><span class="line">    &lt;App&gt;</span><br><span class="line">      &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">        &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;</span><br><span class="line">          who</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/App&gt;</span><br><span class="line">  &lt;/Provider&gt;</span><br></pre></td></tr></table></figure>

<p>We can see that the app is fully rendered, toghether with ‘Provider’ and ‘App’ components.</p>
<p>With this, we can go back to testing the current question in the test ‘span’ element.<br>At this point, error in the output is as follows:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> FAIL  src/tests/app.test.tsx</span><br><span class="line">  ● <span class="string">&#x27;App&#x27;</span> component › renders current question</span><br><span class="line"></span><br><span class="line">    expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">    Expected: <span class="string">&quot;What?&quot;</span></span><br><span class="line">    Received: <span class="string">&quot;who&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="number">33</span> |     <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">      <span class="number">34</span> |     <span class="keyword">const</span> testSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;test-span&#x27;]&quot;</span>);</span><br><span class="line">    &gt; <span class="number">35</span> |     expect(testSpan.props().children).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">         |                                       ^</span><br><span class="line">      <span class="number">36</span> |   &#125;);</span><br><span class="line">      <span class="number">37</span> | &#125;);</span><br><span class="line">      <span class="number">38</span> |</span><br><span class="line"></span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/app.test.tsx:<span class="number">35</span>:<span class="number">39</span>)</span><br><span class="line">Test Suites: <span class="number">1</span> failed, <span class="number">1</span> passed, <span class="number">2</span> total</span><br><span class="line">Tests:       <span class="number">1</span> failed, <span class="number">2</span> passed, <span class="number">3</span> total</span><br><span class="line">Snapshots:   <span class="number">0</span> total</span><br><span class="line">Time:        <span class="number">6.284</span> s, estimated <span class="number">46</span> s</span><br><span class="line">Ran all test suites related to changed files.</span><br><span class="line"></span><br><span class="line">Watch Usage: Press w to show more.</span><br></pre></td></tr></table></figure>

<p>Well, this seems like nothing much. The only problem is that the question in the output is not correctly formatted, because it comes from Redux store where it is just a simple lowercase string.</p>
<p>To get the correct question format, we will create a helper function.<br>Let’s do this in <strong>src/helpers</strong> folder, in <strong>format-question.ts</strong> file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\helpers\format-question.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> formatQuestion = <span class="function">(<span class="params">question: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> question[<span class="number">0</span>].toUpperCase().concat(question.slice(<span class="number">1</span>)).concat(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> formatQuestion;</span><br></pre></td></tr></table></figure>

<p>The function takes the question tring, capitalizes it, and adds a question mark at its end.</p>
<p>We now import this helper function into ‘App’ component, and have it format the question string before it is renered:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> formatQuestion <span class="keyword">from</span> <span class="string">&quot;./helpers/format-question&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[<span class="number">0</span>].question</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;&#123;formatQuestion(question)&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>With this, the test passes and we can move on to integration tests.<br>Don’t forget to commit before.</p>
<h2 id="Step-2-Integration-testing-rendering-values-in-‘Answer’-component"><a href="#Step-2-Integration-testing-rendering-values-in-‘Answer’-component" class="headerlink" title="Step 2: Integration testing - rendering values in ‘Answer’ component"></a>Step 2: Integration testing - rendering values in ‘Answer’ component</h2><p>We will start integration testing with interaction between ‘App’, ‘Answer’, and ‘CustomButton’ component. Main idea here is to test that ‘label’ element in ‘Answer’ component renders correct data when an instance of ‘CustomButton’ component is clicked.</p>
<p>Before we go on with test, we need to prepare the test file.<br>So create <strong>integration.test.tsx</strong> file in <strong>src/tests</strong> folder.<br>Then, import following:</p>
<ul>
<li><strong>Provider</strong> from “react-redux”. We will use it to provide store values to the test rendered components</li>
<li><strong>App</strong> component</li>
<li><strong>storeFactory</strong> function. We will use to create a Redux store</li>
<li><strong>mount</strong> from “enzyme”. We need access to nested components, so we will use <strong>mount</strong> to accomplish that</li>
</ul>
<p>I also created a <strong>setup</strong> function that accepts an optional argument in shape of Redux state. In case such argument is not provided, we will use another one with preset values which already have valid answer strings.</p>
<p>Finally, I created a general test suite, and then a nested one for this group of tests.</p>
<p>Here is the current setup:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\integration.test.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&quot;enzyme&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;../App&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; storeFactory &#125; <span class="keyword">from</span> <span class="string">&quot;../../testing/test-utils&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">(<span class="params">initialState?: QuestionStateObjectInterface[]</span>) =&gt;</span> &#123;</span><br><span class="line">  initialState = initialState ?? [</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;who&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;Mark&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;what&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;jumps&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;when&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;all day long&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;where&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;in his head&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> store = storeFactory(initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mount(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&quot;Application&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">&quot;renders questions in &#x27;Answer&#x27; component properly&quot;</span>, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Now, let’s do tests.</p>
<h3 id="Render-‘What-’-question-when-‘Next-Question’-button-clicked-first-time"><a href="#Render-‘What-’-question-when-‘Next-Question’-button-clicked-first-time" class="headerlink" title="Render ‘What?’ question when ‘Next Question’ button clicked first time"></a>Render ‘What?’ question when ‘Next Question’ button clicked first time</h3><p>We already know that initial question is ‘Who?’, and that ‘Answer’ component will correctly render the ‘question’ prop.<br>What we do not know is if the component is going to render the next question when ‘Next Question’ button is clicked. So this is what we will test first.</p>
<p>Knowing that the first question is ‘who’, we want to simulate a button click on ‘Next Question instance of ‘CustomButton’ component. Then, we want to assert that the question rendered will be ‘What?’.</p>
<p>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;Application&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">&quot;renders in &#x27;Answer&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    test(<span class="string">&quot;renders &#x27;What&#x27; when &#x27;Next Question&#x27; button clicked first time&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">      <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">        (element) =&gt;</span><br><span class="line">          element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">          element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">      );</span><br><span class="line">      button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">      expect(label.text()).toBe(<span class="string">&quot;What?&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Just one thing to note here: after we select the ‘button’ element, only then do we find the label element.<br>We want to make sure to fetch the label component after whatever neccessary updates to the component are applied, so we have the most fresh version of UI.</p>
<p>So what errors do we get?<br>Well, first one is that there is no node to run ‘simulate’ method on. This makes sense, as we do not render ‘CustomButton’ component in the ‘App’ component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> ● Test suite failed to run</span><br><span class="line"></span><br><span class="line">   Method “simulate” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">     <span class="number">46</span> |         element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">     <span class="number">47</span> |     );</span><br><span class="line">   &gt; <span class="number">48</span> |     button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">        |            ^</span><br><span class="line">     <span class="number">49</span> |     <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">     <span class="number">50</span> |     expect(label.text()).toBe(<span class="string">&quot;What?&quot;</span>);</span><br><span class="line">     <span class="number">51</span> |   &#125;);</span><br></pre></td></tr></table></figure>

<p>As we add ‘CustomButton’ compoennt to our app, TypeScript warns us about props needed for the component. We supply those as temporarily hardcoded values to the ‘Next Question’ instance of ‘CustomButtom’ component, too.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[<span class="number">0</span>].question</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        isInvalidInput=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* test span */</span>&#125;</span><br><span class="line">      &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;&#123;formatQuestion(question)&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Ok, that part is done, and the error changes. Now, Jest complains that the <strong>text()</strong> method needs a node to run on, too:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> ● Test suite failed to run</span><br><span class="line"></span><br><span class="line">   Method “text” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">     <span class="number">48</span> |     button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">     <span class="number">49</span> |     <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">   &gt; <span class="number">50</span> |     expect(label.text()).toBe(<span class="string">&quot;What?&quot;</span>);</span><br><span class="line">        |                  ^</span><br><span class="line">     <span class="number">51</span> |   &#125;);</span><br></pre></td></tr></table></figure>

<p>This, of course, means that there is no ‘label’ element rendered in the application. Since ‘Answer’ component is the one providing such elemenet, let’s add that component to our app, too.<br>Note that we provide a valid <strong>question</strong> prop to ‘Answer’, but we hardcode other ones, since we don’t work with them at the moment.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[<span class="number">0</span>].question</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        isInvalidInput=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* test span */</span>&#125;</span><br><span class="line">      &lt;span data-test=<span class="string">&quot;test-span&quot;</span>&gt;&#123;formatQuestion(question)&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Alright. That is done, too.<br>But what is the error now? The test fails with incorrect value being rendered inside the ‘label’ element: instead of ‘What?’, the test received ‘Who?’ the old value.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> ● Test suite failed to run</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="string">&quot;What?&quot;</span></span><br><span class="line">   Received: <span class="string">&quot;Who?&quot;</span></span><br><span class="line"></span><br><span class="line">     <span class="number">48</span> |     button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">     <span class="number">49</span> |     <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">   &gt; <span class="number">50</span> |     expect(label.text()).toBe(<span class="string">&quot;What?&quot;</span>);</span><br><span class="line">        |                          ^</span><br><span class="line">     <span class="number">51</span> |   &#125;);</span><br></pre></td></tr></table></figure>

<p>The reason our test fails is that there is always the same question returned from the <strong>useSelector</strong> hook - the first question.<br>What we need is a way to switch questions when the button is clicke.</p>
<p>This functionality can be implemented in multiple ways. Here, we will React’s <strong>useState</strong> hook to create local state in ‘App’ component. This state holds a number, and is used by the <strong>useSelector</strong> hook as index of an object in Redux state.</p>
<p>Here is what I mean:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Thing to note: I don’t import <strong>useState</strong> hook from ‘react’ by name. Instead, i grab it from the <strong>React</strong> object. This is so I can later replace this function (<strong>useState</strong>) in our tests for a mock function, and manually set state value in our tests.</p>
<p>With this adjustment, of course, we still have the same error. Question shown in the ‘label’ element is still the same, regardless of the new local state introduced in the ‘App’ component.<br>However, we can leverage the <strong>setQuestionIndex</strong> setter provided by the <strong>useState</strong> hook to change the <strong>questionIdex</strong> value, and consequently, change the question rendered.<br>For this, we will create a handler function that calls the said setter, and have it increment the current state by 1.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// increment question index by one</span></span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        isInvalidInput=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;handleIncrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>For this to work, we have to accept the passed handler prop in the <strong>CustomButton</strong> component, and call it when the button is called.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\components\direction-button.component.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">interface CustomButtonProps &#123;</span><br><span class="line">  label: string;</span><br><span class="line">  onHandleClick: <span class="function">() =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">  isNotRendered?: boolean;</span><br><span class="line">  isInvalidInput?: boolean;</span><br><span class="line">  primaryColor: string;</span><br><span class="line">  secondaryColor: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CustomButton: React.FC&lt;CustomButtonProps&gt; = (&#123;</span><br><span class="line">  label,</span><br><span class="line">  isNotRendered,</span><br><span class="line">  onHandleClick,</span><br><span class="line">  isInvalidInput,</span><br><span class="line">  primaryColor,</span><br><span class="line">  secondaryColor,</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (isNotRendered) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;CustomButtonStyled</span><br><span class="line">      primaryColor=&#123;primaryColor&#125;</span><br><span class="line">      secondaryColor=&#123;secondaryColor&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;button</span><br><span class="line">        data-test=<span class="string">&quot;component-direction-button&quot;</span></span><br><span class="line">        onClick=&#123;onHandleClick&#125;</span><br><span class="line">        disabled=&#123;isInvalidInput&#125;</span><br><span class="line">      &gt;</span><br><span class="line">        &#123;label&#125;</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/CustomButtonStyled&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CustomButton;</span><br></pre></td></tr></table></figure>

<p>Note that this is just one way to accomplish question switching, and this functionality could be implemented in many other ways. Also worth of noting is that we are not testing implementation (the way how we make app do what we want). Instead, we only test UI - the end result shown to the user.</p>
<p>Finally, this works</p>
<h3 id="Render-‘When-’-question-when-‘Next-Question’-button-clicked-second-time"><a href="#Render-‘When-’-question-when-‘Next-Question’-button-clicked-second-time" class="headerlink" title="Render ‘When?’ question when ‘Next Question’ button clicked second time"></a>Render ‘When?’ question when ‘Next Question’ button clicked second time</h3><p>In this test we want to make sure that the ‘Answer’ component renders ‘When?’ question when current question is already ‘What’.<br>To accomplish this, we have to make two clicks on the button: once to set the question to ‘What?’, and then once again, to, hopefully, we set question to ‘When?’.</p>
<p>In theory, we could avoid multiple clicks by pre-setting <strong>questionIndex</strong> state to number 1. This, however, will require us to hijack <strong>useState</strong> hook from React, and replace it with our own mock function that returns state and a setter function. Returning state is not a problem, but my skills are not good enough yet to create a setter function that would update our pre-set state.<br>So we go with clicking. Note that I use a <strong>for-loop</strong> to do clicking. I use it to emphasize that this is some routine work, and not focus of the test,</p>
<p>Other than that, the test is pretty much the same as the previous one:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;renders in &#x27;Answer&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  test(<span class="string">&quot;renders &#x27;When&#x27; when &#x27;Next Question&#x27; button clicked second time&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">    <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">      (element) =&gt;</span><br><span class="line">        element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">        element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i++) &#123;</span><br><span class="line">      button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// action button click that we are focusing on</span></span><br><span class="line">    button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">    expect(label.text()).toBe(<span class="string">&quot;When?&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>This test passes. Let’s just quickly see if the test can fail, to make sure it is our current code that the test depends on.<br>I just changed the expected value to be “Who?”:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">expect(label.text()).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>The test indeed fails:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › renders <span class="string">&#x27;When&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> button clicked second time</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="string">&quot;Who?&quot;</span></span><br><span class="line">   Received: <span class="string">&quot;When?&quot;</span></span><br><span class="line"></span><br><span class="line">     <span class="number">70</span> |</span><br><span class="line">     <span class="number">71</span> |       <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">   &gt; <span class="number">72</span> |       expect(label.text()).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">        |                            ^</span><br><span class="line">     <span class="number">73</span> |     &#125;);</span><br><span class="line">     <span class="number">74</span> |   &#125;);</span><br><span class="line">     <span class="number">75</span> |</span><br></pre></td></tr></table></figure>

<p>Alright. After undoing the failing change, we move on.</p>
<h3 id="Render-‘Where-’-question-when-‘Next-Question’-button-clicked-3-or-more-times"><a href="#Render-‘Where-’-question-when-‘Next-Question’-button-clicked-3-or-more-times" class="headerlink" title="Render ‘Where?’ question when ‘Next Question’ button clicked 3 or more times"></a>Render ‘Where?’ question when ‘Next Question’ button clicked 3 or more times</h3><p>In our app, “Where?” is the last question before the sentenced is finally formed. Therefore, every click on the ‘Next Question’ button after the “What?” question is rendered, should do nothing as far as questions are concerned.</p>
<p>Let’s make sure our app behaves in such way.<br>Again, the test is similar to the previous ones: we keep clicking until we reach desired question, and then assert that the question is actually there. In this case, we will click 3 times, and assert that “Where?” is rendered. Then, we will click one more time, and assert that “Where?” is still rendered.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders &#x27;Where?&#x27; when &#x27;Next Question&#x27; is clicked 3 or more times&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> label: ReactWrapper&lt;HTMLAttributes, any, React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assign found &#x27;label&#x27; element to the &quot;label&quot; variable</span></span><br><span class="line">  label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// first assertion to check if label has just rendered &quot;Where?&quot;</span></span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;Where?&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// one more button click</span></span><br><span class="line">  button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// re-assign found &#x27;label&#x27; element to the &quot;label&quot; variable to have fresh UI</span></span><br><span class="line">  label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert that label is still &quot;Where?&quot;</span></span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;Where?&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Things to note:</p>
<ol>
<li>We have 2 assertions in the same test. This is ok</li>
<li>We reassign found ‘button’ element to the <strong>button</strong> variable before each assertion. This is done so that we deal with the freshest UI element available.</li>
</ol>
<p>If we run tests now, we get a major error. Of course, the test fails, but more importantly, the app has no <strong>question</strong> property to work with:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx (<span class="number">5.321</span> s)</span><br><span class="line"> ● Console</span><br><span class="line"></span><br><span class="line">   <span class="built_in">console</span>.error</span><br><span class="line">     <span class="built_in">Error</span>: Uncaught [<span class="built_in">TypeError</span>: Cannot read property <span class="string">&#x27;question&#x27;</span> <span class="keyword">of</span> <span class="literal">undefined</span>]</span><br></pre></td></tr></table></figure>

<p>What happend is that our <strong>questionIndex</strong> variable in the ‘App’ component went out of bounds of <strong>questions</strong> Redux state array.<br>See, after the clicking loop, the local state in the ‘App’ component has changed 3 times, and has reached value of “what”. At this point, the state value is <strong>3</strong>, Since there are no more questions in the Redux state, every new button will try to fetch a question from a non-existing index in the Redux state. This breaks the app.</p>
<p>To fix this, and effectively make our test pass, we need to disable the handler from changing local ‘App’ state when current question is “Where”.<br>We do it by returning from the function if the local state is already <strong>3</strong>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do nothing if questionIndex is &gt;= 3</span></span><br><span class="line">    <span class="keyword">if</span> (questionIndex &gt;= <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// increment question index by one</span></span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>With this, our test passes. Let’s commit and move on.</p>
<h3 id="Render-‘When-’-question-when-‘Go-Back’-button-clicked-after-previous-question-was-“Where-”"><a href="#Render-‘When-’-question-when-‘Go-Back’-button-clicked-after-previous-question-was-“Where-”" class="headerlink" title="Render ‘When?’ question when ‘Go Back’ button clicked after previous question was “Where?”"></a>Render ‘When?’ question when ‘Go Back’ button clicked after previous question was “Where?”</h3><p>Since we want our app to go back and see previous questions, let’s make tests for that too.<br>In this one, we will start from the last question (by looping clicks), and then will click on the ‘Go Back’ question. We will then assert that the current question rendered is “When?”, which is the one that comes just before “Where?”</p>
<p>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders &#x27;When?&#x27; after &#x27;Go Back&#x27; button is clicked when current question is &#x27;Where?&#x27;&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> backButton: ReactWrapper&lt;</span><br><span class="line">    HTMLAttributes,</span><br><span class="line">    any,</span><br><span class="line">    React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;</span><br><span class="line">  &gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> nextButton: ReactWrapper&lt;</span><br><span class="line">    HTMLAttributes,</span><br><span class="line">    any,</span><br><span class="line">    React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;</span><br><span class="line">  &gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> label: ReactWrapper&lt;HTMLAttributes, any, React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  nextButton = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    nextButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  backButton = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Go Back&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  backButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line"></span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;When?&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Things to note:</p>
<ol>
<li>We select both buttons: “Go Back” and “Next Question”. At this point, we have not added the “Go Back” question to the app, and this is one of the reasons that our test fails.</li>
</ol>
<p>Here is the error thrown by Jest, showing that the “Go Back” button is the issue:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> FAIL  src/tests/integration.test.tsx</span><br><span class="line">  Application</span><br><span class="line">    renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component</span><br><span class="line">      √ renders <span class="string">&#x27;What&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> button clicked first time (<span class="number">126</span> ms)</span><br><span class="line">      √ renders <span class="string">&#x27;When&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> button clicked second time (<span class="number">16</span> ms)</span><br><span class="line">      √ renders <span class="string">&#x27;Where?&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> is clicked <span class="number">3</span> or more times (<span class="number">15</span> ms)</span><br><span class="line">      × renders <span class="string">&#x27;When?&#x27;</span> after <span class="string">&#x27;Go Back&#x27;</span> button is clicked when current question is <span class="string">&#x27;Where?&#x27;</span> (<span class="number">15</span> ms)</span><br><span class="line"></span><br><span class="line">  ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › renders <span class="string">&#x27;When?&#x27;</span> after <span class="string">&#x27;Go Back&#x27;</span> button is clicked when current question is <span class="string">&#x27;Where?&#x27;</span></span><br><span class="line"></span><br><span class="line">    Method “simulate” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">      <span class="number">144</span> |       );</span><br><span class="line">      <span class="number">145</span> |</span><br><span class="line">    &gt; <span class="number">146</span> |       backButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">          |                  ^</span><br><span class="line">      <span class="number">147</span> |</span><br><span class="line">      <span class="number">148</span> |       label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">      <span class="number">149</span> |</span><br><span class="line"></span><br><span class="line">      at ReactWrapper.single (node_modules/enzyme/src/ReactWrapper.js:<span class="number">1168</span>:<span class="number">13</span>)</span><br><span class="line">      at ReactWrapper.simulate (node_modules/enzyme/src/ReactWrapper.js:<span class="number">665</span>:<span class="number">17</span>)</span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/integration.test.tsx:<span class="number">146</span>:<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line">Test Suites: <span class="number">1</span> failed, <span class="number">1</span> total</span><br><span class="line">Tests:       <span class="number">1</span> failed, <span class="number">3</span> passed, <span class="number">4</span> total</span><br><span class="line">Snapshots:   <span class="number">0</span> total</span><br><span class="line">Time:        <span class="number">5.007</span> s</span><br></pre></td></tr></table></figure>

<p>So we start by adding such button to the app:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do nothing if questionIndex is &gt;= 3</span></span><br><span class="line">    <span class="keyword">if</span> (questionIndex &gt;= <span class="number">3</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// increment question index by one</span></span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        isInvalidInput=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;handleIncrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Go Back&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">        primaryColor=&#123;colors.lightGray&#125;</span><br><span class="line">        secondaryColor=&#123;colors.purple&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that the “Go Back” button lacks <strong>isInvalidInput</strong> prop. Since we want to be able to go back to previous questions regardless of input validity, such control variable is not needed here.</p>
<p>We still fail the test, of course, as there is no logic implemented to actually decrement the ‘App’ local state. So let’s do that by creating a decrementing handler function, and passing it to the “Go Back” button component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> handleDecrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState - <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/*... */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Go Back&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;handleDecrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;colors.lightGray&#125;</span><br><span class="line">        secondaryColor=&#123;colors.purple&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Test is passed</p>
<h3 id="Render-‘Who-’-question-when-‘Go-Back’-button-clicked-after-previous-question-was-“Who-”"><a href="#Render-‘Who-’-question-when-‘Go-Back’-button-clicked-after-previous-question-was-“Who-”" class="headerlink" title="Render ‘Who?’ question when ‘Go Back’ button clicked after previous question was “Who?”"></a>Render ‘Who?’ question when ‘Go Back’ button clicked after previous question was “Who?”</h3><p>Similar to the last question, we want to make sure that clicking on the “Go Back” button does nothing to the rendered question when it is “Who?”.</p>
<p>For now, let’s make a failing test. Only thing we need to do is to create a wrapper, simulate click on the “Go Back” button, and assert that the question is still “Who?”.<br>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders &#x27;Who?&#x27; when &#x27;Go Back&#x27; button is clicked while current question is &#x27;Who?&#x27;&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Go Back&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Again, similar to the case before, not only does the test fail, but our whole app crashes, too:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx (<span class="number">5.404</span> s)</span><br><span class="line"> ● Console</span><br><span class="line"></span><br><span class="line">   <span class="built_in">console</span>.error</span><br><span class="line">     <span class="built_in">Error</span>: Uncaught [<span class="built_in">TypeError</span>: Cannot read property <span class="string">&#x27;question&#x27;</span> <span class="keyword">of</span> <span class="literal">undefined</span>]</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"> ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › renders <span class="string">&#x27;Who?&#x27;</span> when <span class="string">&#x27;Go Back&#x27;</span> button is clicked <span class="keyword">while</span> current question is <span class="string">&#x27;Who?&#x27;</span></span><br><span class="line"></span><br><span class="line">   <span class="built_in">TypeError</span>: Cannot read property <span class="string">&#x27;question&#x27;</span> <span class="keyword">of</span> <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">     <span class="number">26</span> |</span><br><span class="line">     <span class="number">27</span> |   <span class="keyword">const</span> question = useSelector(</span><br><span class="line">   &gt; <span class="number">28</span> |     <span class="function">(<span class="params">state: RootStateType</span>) =&gt;</span> state.questions[questionIndex].question</span><br><span class="line">        |                                                              ^</span><br><span class="line">     <span class="number">29</span> |   );</span><br><span class="line">     <span class="number">30</span> |</span><br><span class="line">     <span class="number">31</span> |   <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br></pre></td></tr></table></figure>

<p>Of course, this is because we are setting the local state in ‘App’ component to <strong>-1</strong>, and <strong>useSelector</strong> hook cannot find a question with that index in Redux store.<br>Fix is to return from the handler function if the current local state in ‘App’ component is equal or less than 0.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex].question</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleDecrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (questionIndex &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState - <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>With this, our test passes. Commit, and let’s go to the next test.</p>
<h3 id="Render-answer-for-the-‘Who-’-question-as-the-value-of-the-‘input’-element”"><a href="#Render-answer-for-the-‘Who-’-question-as-the-value-of-the-‘input’-element”" class="headerlink" title="Render answer for the ‘Who?’ question as the value of the ‘input’ element”"></a>Render answer for the ‘Who?’ question as the value of the ‘input’ element”</h3><p>‘Input’ element in our app is supposed to render answer for each of the questions, regardless of them being valid or empty strings.<br>From unit tests, we already know that the ‘Answer’ component can render ‘answer’ prop.<br>Here we will test that the ‘App’ and ‘Answer’ components are properly connected in regards with the ‘answer’ prop.</p>
<p>We will do this by taking advantage of the preloaded state passed to the <strong>storeFactory</strong> function, where answer for “who” question is set to “Mark”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\tests\integration.test.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setup = <span class="function">(<span class="params">initialState?: QuestionStateObjectInterface[]</span>) =&gt;</span> &#123;</span><br><span class="line">  initialState = initialState ?? [</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;who&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;Mark&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;what&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;jumps&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;when&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;all day long&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;where&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;in his head&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> store = storeFactory(initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mount(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">      &lt;App /&gt;</span><br><span class="line">    &lt;/Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&quot;Application&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">&quot;renders in &#x27;Answer&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    test(<span class="string">&quot;renders answers from Redux store successfully&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// create wrapper</span></span><br><span class="line">      <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// select input</span></span><br><span class="line">      <span class="keyword">const</span> input = wrapper.find(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// assert that value of the input is &quot;Mark&quot;</span></span><br><span class="line">      expect(input.prop(<span class="string">&quot;value&quot;</span>)).toBe(<span class="string">&quot;Mark&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Things to note:</p>
<ol>
<li>This test only checks that whatever is in the Redux store, is also rendered in the ‘input’ element</li>
<li>By default, <strong>storeFactory</strong> function creates a store with valid <strong>answer</strong> properties inside. Then, we pass this store to the Redux provider.</li>
</ol>
<p>The test fails because, as expected, current value of the ‘input’ element is just an empty string:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> Application</span><br><span class="line">   renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component</span><br><span class="line">     √ renders <span class="string">&#x27;What&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> button clicked first time (<span class="number">138</span> ms)</span><br><span class="line">     √ renders <span class="string">&#x27;When&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> button clicked second time (<span class="number">13</span> ms)</span><br><span class="line">     √ renders <span class="string">&#x27;Where?&#x27;</span> when <span class="string">&#x27;Next Question&#x27;</span> is clicked <span class="number">3</span> or more times (<span class="number">17</span> ms)</span><br><span class="line">     √ renders <span class="string">&#x27;When?&#x27;</span> after <span class="string">&#x27;Go Back&#x27;</span> button is clicked when current question is <span class="string">&#x27;Where?&#x27;</span> (<span class="number">22</span> ms)</span><br><span class="line">     √ renders <span class="string">&#x27;Who?&#x27;</span> when <span class="string">&#x27;Go Back&#x27;</span> button is clicked <span class="keyword">while</span> current question is <span class="string">&#x27;Who?&#x27;</span> (<span class="number">12</span> ms)</span><br><span class="line">     × renders answers <span class="keyword">from</span> Redux store successfully (<span class="number">8</span> ms)</span><br><span class="line"></span><br><span class="line"> ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › renders answers <span class="keyword">from</span> Redux store successfully</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="string">&quot;Mark&quot;</span></span><br><span class="line">   Received: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">     <span class="number">173</span> |</span><br><span class="line">     <span class="number">174</span> |       <span class="comment">// assert that value of the input is &quot;Mark&quot;</span></span><br><span class="line">   &gt; <span class="number">175</span> |       expect(input.prop(<span class="string">&quot;value&quot;</span>)).toBe(<span class="string">&quot;Mark&quot;</span>);</span><br><span class="line">         |                                   ^</span><br><span class="line">     <span class="number">176</span> |     &#125;);</span><br><span class="line">     <span class="number">177</span> |   &#125;);</span><br><span class="line">     <span class="number">178</span> |</span><br></pre></td></tr></table></figure>

<p>Fix involves making sure that the actual <strong>answer</strong> value is passed to the ‘Answer’ component. For now, we will directly pass the property:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; question, answer &#125; = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;answer&#125;</span><br><span class="line">        isNotRendered=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>This works, and we know that the component can actuall render corret answers.</p>
<h3 id="Does-not-render-when-last-question-is-submitted"><a href="#Does-not-render-when-last-question-is-submitted" class="headerlink" title="Does not render when last question is submitted"></a>Does not render when last question is submitted</h3><p>While this was not required in the task, I thought it would be neat if the question and input elements disappeared when final question has been submitted.<br>‘Answer’ component is already prepared for this via <strong>isNotRendered</strong> prop that we tested in the previous post.<br>Now, we just need to figure out a way how to control this prop from the ‘App’ component.</p>
<p>First, however, let’s write the test for it.<br>The idea is that when the ‘Next Question’ button is clicked after the active question is the last one - ‘Where?’, the ‘Answer’ component renders nothing.</p>
<p>So we want to make 3 initial button clicks, and then we want to make another click, to simulate submission of the final answer. After that, we assert that there is nothing rendered by the component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;does not render when final question has been submitted&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> answerComponent: ReactWrapper&lt;</span><br><span class="line">    HTMLAttributes,</span><br><span class="line">    any,</span><br><span class="line">    React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;</span><br><span class="line">  &gt;;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// clicks to reach the final question</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// click to submit the last answer</span></span><br><span class="line">  button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  answerComponent = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-answer&#x27;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert that the component does not render</span></span><br><span class="line">  expect(answerComponent.length).toBe(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>There is nothing special about this test, so let’s move on to fixing it.</p>
<p>Again, there are multiple ways in which we could prevent rendering of a component. For this case, I am going to introduce a new piece of local state in the ‘App’ component. A boolean, this state is initialy set to <strong>false</strong>, to indicate that questions are not over yet. Once the final answer is submitted via increment handler function, this piece of state is switched to true. This tells ‘Answer’ component that questions are over, and it should not render its content.</p>
<p>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; question, answer &#125; = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> submit answer to current question</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// questions are over when questionIndex is &gt;= 3</span></span><br><span class="line">    <span class="keyword">if</span> (questionIndex &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">      setIsQuestionsOver(<span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// increment question index by one</span></span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;answer&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that we switch the control variable to <strong>true</strong> only if the current <strong>questionsIndex</strong> is equal or more than 3. This ensures that ‘Answer’ component does not render only if ‘Next Question’ is clicked when the active question is ‘Where?’.<br>Also, we added a reminder to create functionality to actually submit answers to the Redux state.</p>
<p>With the above code implemented, Jest still fails tests. However, the test that failed is actuall a previous one, where we checked that ‘Where?’ question renders when ‘Next Question’ is clicked 3 or more times. This makes sense, as current setup prevents the question from rendering.<br>To fix this, we could remove the test, as we don’t need the functionality anymore. So we will do that.</p>
<p>After removing the test, all other tests pass successfully, and we are good. Commit, please.</p>
<h3 id="Does-render-when-returning-back-to-the-last-question"><a href="#Does-render-when-returning-back-to-the-last-question" class="headerlink" title="Does render when returning back to the last question"></a>Does render when returning back to the last question</h3><p>What if a user changes their mind, and wants to modify their answers after answer last question?<br>At this point, the ‘Answer’ component would not render again, but we want it to render.</p>
<p>Let’s create a test to ensure that the ‘Answer’ component renders in such case.<br>We want to loop ‘Next Question’ button clicks 4 times. At this point, the component will dissapear. Then we simulate a click on the ‘Go Back’ question, and expect that the component will render again.<br>In addition to this, we want to assert that the question rendered is indeed “Where?”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;does render when returning to the last question&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> nextButton = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    nextButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> backButton = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Go Back&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  backButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> answerComponent = wrapper.find(<span class="string">&quot;[data-test=&#x27;component-answer&#x27;]&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line"></span><br><span class="line">  expect(answerComponent.length).toBe(<span class="number">1</span>);</span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;Where?&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test fails, yes. Our component’s lenght is <strong>0</strong> instead of <strong>1</strong>, and there is no ‘label’ element that would render “Where?”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx (<span class="number">5.799</span> s)  ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › does render when returning to the last question</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="number">1</span></span><br><span class="line">   Received: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">     <span class="number">227</span> |       <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">     <span class="number">228</span> |</span><br><span class="line">   &gt; <span class="number">229</span> |       expect(answerComponent.length).toBe(<span class="number">1</span>);</span><br><span class="line">         |</span><br><span class="line"> ^</span><br><span class="line">     <span class="number">230</span> |       expect(label.text()).toBe(<span class="string">&quot;Where?&quot;</span>);</span><br><span class="line">     <span class="number">231</span> |     &#125;);</span><br><span class="line">     <span class="number">232</span> |   &#125;);</span><br><span class="line"></span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/integration.test.tsx:<span class="number">229</span>:<span class="number">38</span>)</span><br></pre></td></tr></table></figure>

<p>How do we fix it? Well, we need to return the <strong>isQuestionsOver</strong> state to false, as we are back to answering questions. So we can just do this in the decrement handler function in the ‘App’ component.<br>However, there is a catch. We should to this, and only this, only in case when <strong>questionIndex</strong> is <strong>3</strong> AND when <strong>isQuestionsOver</strong> is <strong>true</strong>.<br>We should not decrement <strong>questionIndex</strong> in this case, as that would jump over the “where” question, and go to the “when” question instead. And by including a check for <strong>true</strong> value of <strong>isQuestionsOver</strong>, we make sure that when questions are not over, users can normally go back to the “When?” question.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleDecrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (questionIndex &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (questionIndex === <span class="number">3</span> &amp;&amp; isQuestionsOver)</span><br><span class="line">      <span class="keyword">return</span> setIsQuestionsOver(<span class="literal">false</span>);</span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState - <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>It is worth pointing out that this fix code seems a bit convulted. I am sure it could be written in a more clear way, but this is the one I came up with. And I came up with it because of testing, by knowing what I want, and then working on the code until the test passed.</p>
<h2 id="Step-3-Integration-testing-rendering-‘CustomButton’-component"><a href="#Step-3-Integration-testing-rendering-‘CustomButton’-component" class="headerlink" title="Step 3: Integration testing - rendering ‘CustomButton’ component"></a>Step 3: Integration testing - rendering ‘CustomButton’ component</h2><p>We are now moving on to test integration of the “CustomButton” component with rest of the app. Specifically, we will test “Go Back” and “Next Question” buttons in next few sections, and then will test “New Sentence” button at the end of this post.<br>We will create a new suite for these tests.</p>
<h3 id="Does-not-render-“Go-Back”-button-when-“Who-”-question-is-rendered"><a href="#Does-not-render-“Go-Back”-button-when-“Who-”-question-is-rendered" class="headerlink" title="Does not render “Go Back” button when “Who?” question is rendered"></a>Does not render “Go Back” button when “Who?” question is rendered</h3><p>We start with the “Go Back” button. When a user starts the game, we don’t want to show the button as there is nowhere to go back to.<br>In the previous post we have already tested “CustomButton” component’s ability to disappear when needed. Now we just have to provide context for when this functionality is needed, and find a way to provide value for the prop that controls this functionality.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;integrates &#x27;CustomButton&#x27; component, which&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&quot;does not render &#x27;Go Back&#x27; button when current question is &#x27;Who?&#x27;&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// select the button</span></span><br><span class="line">    <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">      (element) =&gt;</span><br><span class="line">        element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Go Back&quot;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// assert that there is no button</span></span><br><span class="line">    expect(button.length).toBe(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Test fails, with the output telling us that the button is still there:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line">  ● Application › integrates <span class="string">&#x27;CustomButton&#x27;</span> component, which › does not render <span class="string">&#x27;Go Back&#x27;</span> button when current question is <span class="string">&#x27;Who?&#x27;</span></span><br><span class="line"></span><br><span class="line">    expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">    Expected: <span class="number">0</span></span><br><span class="line">    Received: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="number">243</span> |</span><br><span class="line">      <span class="number">244</span> |       <span class="comment">// assert that there is no button</span></span><br><span class="line">    &gt; <span class="number">245</span> |       expect(button.length).toBe(<span class="number">0</span>);</span><br><span class="line">          |                             ^</span><br><span class="line">      <span class="number">246</span> |     &#125;);</span><br><span class="line">      <span class="number">247</span> |   &#125;);</span><br><span class="line">      <span class="number">248</span> |</span><br><span class="line"></span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/integration.test.tsx:<span class="number">245</span>:<span class="number">29</span>)</span><br></pre></td></tr></table></figure>

<p>Ok, it is pretty simple to fix the failed test. We can coerce the current <strong>questionIndex</strong> into a boolean and invert it, and assign it as the value of the “Go Back” button’s <strong>isNotRendered</strong> prop. If <strong>questionIndex</strong> is 0 (inverted to <strong>true</strong>), we don’t render the button.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Go Back&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;!questionIndex&#125;</span><br><span class="line">        onHandleClick=&#123;handleDecrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;colors.lightGray&#125;</span><br><span class="line">        secondaryColor=&#123;colors.purple&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>With this code, our newest test passes. But, this breaks a test that expects “Who” question to still render when “Go Back” button is clicked while “Who?” is rendered.<br>Issue here is that we don’t have a button to click on:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx (<span class="number">6.097</span> s)  ● Application › renders <span class="keyword">in</span> <span class="string">&#x27;Answer&#x27;</span> component › renders <span class="string">&#x27;Who?&#x27;</span> when <span class="string">&#x27;Go Back&#x27;</span> button is clicked <span class="keyword">while</span> current question is <span class="string">&#x27;Who?&#x27;</span></span><br><span class="line"></span><br><span class="line">   Method “simulate” is meant to be run on <span class="number">1</span> node. <span class="number">0</span> found instead.</span><br><span class="line"></span><br><span class="line">     <span class="number">159</span> |       &#125;);</span><br><span class="line">     <span class="number">160</span> |</span><br><span class="line">   &gt; <span class="number">161</span> |       button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">         |              ^</span><br><span class="line">     <span class="number">162</span> |</span><br><span class="line">     <span class="number">163</span> |       <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">     <span class="number">164</span> |       expect(label.text()).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>This is similar to what we had with the ‘Answer’ component. It threw an error for a test that required ‘label’ element to render “Where?” on every “Next Question” button click after the third one. Like that one, we could remove the new broken test, obviously, since we don’t really need it. But, let’s keep it and adjust it to test that other questions are rendered when “Go Back” button is clicked.</p>
<p>So we will loop ‘Next Question’ button twice, to reach “When?” question, and then simulate a click on the ‘Go Back’ question. Then, we assert that the current rendered question is “What?”.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;Application&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  describe(<span class="string">&quot;renders in &#x27;Answer&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    test(<span class="string">&quot;renders &#x27;What?&#x27; when &#x27;Go Back&#x27; button is clicked while current question is &#x27;When?&#x27;&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> nextButton = wrapper.findWhere(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">          element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        nextButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> backButton = wrapper.findWhere(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Go Back&quot;</span></span><br><span class="line">        );</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      backButton.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">      expect(label.text()).toBe(<span class="string">&quot;What?&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>This works. If it seems like an unneccessary playing around, it’s because it probably is. It is also learning, experimenting, and figuring out how tests relate and affect each other.</p>
<h3 id="Does-not-render-“Next-Question”-when-the-last-answer-is-submitted"><a href="#Does-not-render-“Next-Question”-when-the-last-answer-is-submitted" class="headerlink" title="Does not render “Next Question” when the last answer is submitted"></a>Does not render “Next Question” when the last answer is submitted</h3><p>Similar to the previous test, we now want to prevent rendering of the “Next Question” button when the last question is submitted.</p>
<p>Let’s write a test that expects this to happen. We want to loop button clicks 4 times, to simulate that we submitted the last answer. Then, we assert that the “Next Question” button is no longer there.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;does not render &#x27;Next Question&#x27; button when final answer is submitted&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> button: ReactWrapper&lt;any, any, React.Component&lt;&#123;&#125;, &#123;&#125;, any&gt;&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select the button</span></span><br><span class="line">  button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// loop button clicks</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select the button again</span></span><br><span class="line">  button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert that the button is not there...</span></span><br><span class="line">  expect(button.length).toBe(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Test fails, no wonder.<br>Again, fix is simple. We already have a state variable that tells us when there is no more questions to ask. We will use that to make this test pass:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        isInvalidInput=&#123;<span class="literal">false</span>&#125;</span><br><span class="line">        onHandleClick=&#123;handleIncrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="disables-the-“Next-Question”-button-when-answer-input-is-invalid"><a href="#disables-the-“Next-Question”-button-when-answer-input-is-invalid" class="headerlink" title="disables the “Next Question” button when answer input is invalid"></a>disables the “Next Question” button when answer input is invalid</h3><p>Finally, we reach a more complex test. It starts with sounding simple: we want to disable the ‘Next Question’ button when there is an invalid (empty) string supplied to the ‘input’ element in the ‘Answer’ component.</p>
<p>The test itself is simple. We create the wrapper, by passing a preloaded Redux state with empty strings assigned to <strong>answer</strong> properties. Then, we select the button and assert that its <strong>disabled</strong> attribute (prop) is <strong>true</strong>.</p>
<p>So let’s do that:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;disables the &#x27;Next Question&#x27; button when answer input is invalid&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// prepare preloaded state with empty &#x27;answer&#x27; strings</span></span><br><span class="line">  <span class="keyword">const</span> preloadedState = [</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;who&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;what&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;when&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;where&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup(preloadedState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select the button</span></span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert that &#x27;disabled&#x27; prop on the button is true</span></span><br><span class="line">  expect(button.prop(<span class="string">&quot;disabled&quot;</span>)).toBe(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test fails, obviously. At this point, value of the <strong>disabled</strong> attribute on the button is determined by the <strong>isInvalidInput</strong> prop, passed to the “CustomButton” component instance, and hardcoded to false. There is no logic that would assign dynamic value to the prop, based on our app’s state.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">FAIL  src/tests/integration.test.tsx</span><br><span class="line"> ● Application › integrates <span class="string">&#x27;CustomButton&#x27;</span> component, which › disables the <span class="string">&#x27;Next Question&#x27;</span> button when answer input is invalid</span><br><span class="line"></span><br><span class="line">   expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">   Expected: <span class="literal">true</span></span><br><span class="line">   Received: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">     <span class="number">317</span> |</span><br><span class="line">     <span class="number">318</span> |       <span class="comment">// assert that &#x27;disabled&#x27; prop on the button is true</span></span><br><span class="line">   &gt; <span class="number">319</span> |       expect(button.prop(<span class="string">&quot;disabled&quot;</span>)).toBe(<span class="literal">true</span>);</span><br><span class="line">         |                                       ^</span><br><span class="line">     <span class="number">320</span> |     &#125;);</span><br><span class="line">     <span class="number">321</span> |   &#125;);</span><br><span class="line">     <span class="number">322</span> |</span><br><span class="line"></span><br><span class="line">     at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/integration.test.tsx:<span class="number">319</span>:<span class="number">39</span>)</span><br></pre></td></tr></table></figure>

<p>The fix requires a bit of involvement. Just a bit. We will start by creating another piece of local state in the ‘App’ component. This state will be in charge of controlling the ‘Answer’ component’s input value via <strong>answer</strong> prop. This state will also receive value of the current Redux state’s <strong>answer</strong> property. Then, we will use this piece of local state to disable or enable the button; if the string is empty, the button is disabled, and vice versa.</p>
<p>Here is the full code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [answerValue, setAnswerValue] = React.useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; question, answer &#125; = useSelector(</span><br><span class="line">    (state: RootStateType) =&gt; state.questions[questionIndex]</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  React.useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    setAnswerValue(answer);</span><br><span class="line">  &#125;, [questionIndex, answer]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;answerValue&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        onHandleChange=&#123;<span class="function">() =&gt;</span> &#123;&#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;CustomButton</span><br><span class="line">        label=&#123;<span class="string">&quot;Next Question&quot;</span>&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        isInvalidInput=&#123;!answerValue&#125;</span><br><span class="line">        onHandleClick=&#123;handleIncrementQuestion&#125;</span><br><span class="line">        primaryColor=&#123;<span class="string">&quot;purple&quot;</span>&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* test span */</span>&#125;</span><br><span class="line"></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that we use <strong>useEffect</strong> hook to assign value to the <strong>answerValue</strong> state. The hook will run its callback whenever <strong>questionIndex</strong> or <strong>answer</strong> variables change, to make sure that the ‘Answer’ component’s ‘input’ element gets the newest data.<br>Also note that the ‘Answer’ component is now passed <strong>answer</strong> prop with the value of ‘App’ component’s <strong>asnwerValue</strong> state. Later we will exploit this local state a bit more, to set it, and finally dispatch its value to Redux.</p>
<h2 id="Step-4-Integration-testing-rendering-sentence-correctly-in-‘Sentence’-component"><a href="#Step-4-Integration-testing-rendering-sentence-correctly-in-‘Sentence’-component" class="headerlink" title="Step 4: Integration testing - rendering sentence correctly in ‘Sentence’ component"></a>Step 4: Integration testing - rendering sentence correctly in ‘Sentence’ component</h2><p>We will now test the ‘Sentence’ component.</p>
<p>We want to test that:</p>
<ol>
<li>The component renders currently available answers</li>
<li>Incomplete sentence is rendered with an ellipsis</li>
<li>Complete sentence is rendered without an ellipisis</li>
<li>Input submission in ‘Answer’ component is rendered in the ‘Sentence’ component</li>
<li>The actual sentence is reset when ‘New Sentence’ button is clicked</li>
</ol>
<p>Before we start with testing, let’s create a helper method that will assemble the sentence. It will take the Redux store’s questions, and reduce their answers to one string.<br>This approach will also automatically put all answers in correct place when user changes questions both forward and backward.</p>
<p>Here is the module with the helper function, stored in <strong>src/helpers/assemble-sentence.ts</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\helpers\assemble-sentence.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; QuestionStateObjectInterface &#125; <span class="keyword">from</span> <span class="string">&quot;../store/reducers/questions.reducer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> assembleSentence = <span class="function">(<span class="params">questions: QuestionStateObjectInterface[]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> questions</span><br><span class="line">    .reduce(<span class="function">(<span class="params">acc, val</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (acc = <span class="string">`<span class="subst">$&#123;acc&#125;</span> <span class="subst">$&#123;val.answer&#125;</span>`</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    .trim();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> assembleSentence;</span><br></pre></td></tr></table></figure>

<p>We will also create a new suite for this group of tests, and then we can do testing.</p>
<h3 id="The-component-renders-currently-available-answers"><a href="#The-component-renders-currently-available-answers" class="headerlink" title="The component renders currently available answers"></a>The component renders currently available answers</h3><p>Here we want to test that the the ‘Sentence’ component will correctly render a sentence assembled out of Redux store answers.</p>
<p>We will create a variable with initial questions array (even if such array is already used by the <strong>setup</strong> function), and pass it to the <strong>setup</strong> function.<br>We will also pass this array to the <strong>assembleSentence</strong> helper, imported from its module.<br>Then, we select the sentence-rendering element in the ‘Sentence’ component, and we assert that its output contains whatever string was returned from the helper function.</p>
<p>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;integrates &#x27;Sentence&#x27; component, which&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  test(<span class="string">&quot;renders a sentence out of currently available answers&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> preloadedState = [</span><br><span class="line">      &#123;</span><br><span class="line">        question: <span class="string">&quot;who&quot;</span>,</span><br><span class="line">        answer: <span class="string">&quot;Mark&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        question: <span class="string">&quot;what&quot;</span>,</span><br><span class="line">        answer: <span class="string">&quot;jumps&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        question: <span class="string">&quot;when&quot;</span>,</span><br><span class="line">        answer: <span class="string">&quot;all day long&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        question: <span class="string">&quot;where&quot;</span>,</span><br><span class="line">        answer: <span class="string">&quot;in his head&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">const</span> expectedSentence = assembleSentence(preloadedState);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = setup(preloadedState);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sentenceSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;sentence-span&#x27;]&quot;</span>);</span><br><span class="line">    expect(sentenceSpan.text()).toContain(expectedSentence);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>As expected, the test fails.<br>At the moment, the reason is that we don’t have ‘Sentence’ component in our app. So let’s fix that.<br>Since the ‘Sentence’ component requires <strong>sentence</strong> prop, we create a value for it that by using the <strong>useSelector</strong> hook again, and applying the <strong>assembleSentence</strong> helper on the Redux store questions array.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> sentence = useSelector(<span class="function">(<span class="params">state: RootStateType</span>) =&gt;</span></span><br><span class="line">    assembleSentence(state.questions)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;Sentence sentence=&#123;sentence&#125; isNotComplete=&#123;<span class="literal">true</span>&#125; /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that we hardcode the <strong>isNotComplete</strong> prop since we don’t need it yet.</p>
<p>Ok, so this passes our test.</p>
<h3 id="Incomplete-sentence-is-rendered-with-an-ellipsis"><a href="#Incomplete-sentence-is-rendered-with-an-ellipsis" class="headerlink" title="Incomplete sentence is rendered with an ellipsis"></a>Incomplete sentence is rendered with an ellipsis</h3><p>Since the app has 4 questions to ask, after which the game is over, I thought it would be nice to let the player know when the game is over.</p>
<p>I figured to use an ellipsis for this. As long as the game is not over, an ellipsis will be rendered after whatever sentence we have. Once the last question is submitted, the game is over, and the ellipsis is gone.</p>
<p>How to we write the test? Well, this particular one is easy. We create a wrapper, select the ellipsis container, and assert that the container is rendered.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders an ellipsis when the sentence is not finished&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ellipsisSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;elipsis-span&#x27;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">  expect(ellipsisSpan.length).toBe(<span class="number">1</span>);</span><br><span class="line">  expect(ellipsisSpan.text()).toContain(<span class="string">&quot;...&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Note that we assert that the <strong>ellipsisSpan</strong> exists, and that it contains an actual ellipsis.</p>
<p>This test passes by default, due to current app setup. We should make it fail, however, to make sure that it is this code that it depends on.<br>I just replaced <strong>1</strong> with <strong>0</strong>, and the ellipsis with <strong>?</strong>.</p>
<h3 id="Complete-sentence-does-not-render-an-ellipsis"><a href="#Complete-sentence-does-not-render-an-ellipsis" class="headerlink" title="Complete sentence does not render an ellipsis"></a>Complete sentence does not render an ellipsis</h3><p>Let’s also test that we don’t have an ellipsis rendered when the last question is answered.</p>
<p>For this, we will do few new things.<br>We could loop ‘Next Question’ button clicks again, and reach the point where the last question is answered.</p>
<p>However, we could also hijack the React’s <strong>useState</strong> hook, and have it return values that would immediately be of the needed value. We will do this.<br>Note that looping clicks would be more in line with what the user would do. It would also be more aligned (I think) with how React works - clicks on ‘Next Question’ button cause reaction from other parts of code.</p>
<p>Still, lets play with the <strong>useState</strong> hook a bit.<br>What are we going to do?</p>
<ol>
<li>Store current <strong>useReact</strong> hook in a variable. We do this to make sure we can reset the hook after we finish with this test</li>
<li>Create a mock function and have it return state values that we need</li>
<li>Replace original <strong>useState</strong> hook with our mock function</li>
<li>Create a wrapper</li>
<li>Select the ellipsis span</li>
<li>Assert that the ellipsis span is not rendered</li>
</ol>
<p>Here is the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&quot;integrates &#x27;Sentence&#x27; component, which&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// extract original useState hook</span></span><br><span class="line">  <span class="keyword">const</span> originalUseState = React.useState;</span><br><span class="line"></span><br><span class="line">  afterEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// reset original useState hook after each test in this suite</span></span><br><span class="line">    React.useState = originalUseState;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  test(<span class="string">&quot;does not render an ellipsis when the sentence is finished&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> mockUseState = jest</span><br><span class="line">      .fn()</span><br><span class="line">      .mockReturnValueOnce([<span class="number">3</span>, jest.fn()])</span><br><span class="line">      .mockReturnValueOnce([<span class="literal">true</span>, jest.fn()])</span><br><span class="line">      .mockReturnValueOnce([<span class="string">&quot;&quot;</span>, jest.fn()]);</span><br><span class="line"></span><br><span class="line">    React.useState = mockUseState;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> wrapper = setup();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ellipsisSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;elipsis-span&#x27;]&quot;</span>);</span><br><span class="line">    expect(ellipsisSpan.length).toBe(<span class="number">0</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Things to note:</p>
<ol>
<li>We store original <strong>useState</strong> hook into a variable called <strong>originalUseState</strong>. We do this in the test suite, outside of any actual test.</li>
<li>We use <strong>afterEach</strong> function made available by Jest, to restore the original <strong>useState</strong> hook after each test. We do this so that any other test that depends on the actual original hook can use it.</li>
<li>In the test itself, we create a mock function for the <strong>useState</strong> hook - the <strong>mockUseState</strong>. Jest allows us to assign values to mock functions. In this case, we use <strong>mockReturnValueOnce</strong> method to return values that correspond to returns of the <strong>useState</strong> hook in the real-app use.</li>
<li>First mock return replaces <strong>questionIndex</strong> state and its setter. Index of <strong>3</strong> corresponds to “Where?” question, after which <strong>questionIndex</strong> cannot be incremeneted any further.</li>
<li>Second mock return replaces the <strong>isQuestionsOver</strong> state and its setter. Here we return <strong>true</strong> because we want to test behavior of the ellipsis when the questions are finished.</li>
<li>Third mock return replaces the answer input value. Here we just set it to an empty string, as we don’t really work with this state, but still need to set it to an appropriate variable type.</li>
</ol>
<p>The test fails because the ellipsis is still rendered:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  ● Application › integrates <span class="string">&#x27;Sentence&#x27;</span> component, which › does not render an</span><br><span class="line">ellipsis when the sentence is finished</span><br><span class="line"></span><br><span class="line">    expect(received).toBe(expected) <span class="comment">// Object.is equality</span></span><br><span class="line"></span><br><span class="line">    Expected: <span class="number">0</span></span><br><span class="line">    Received: <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="number">379</span> |</span><br><span class="line">      <span class="number">380</span> |       <span class="keyword">const</span> ellipsisSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;elipsis-span&#x27;]&quot;</span>);</span><br><span class="line">    &gt; <span class="number">381</span> |       expect(ellipsisSpan.length).toBe(<span class="number">0</span>);</span><br><span class="line">          |                                   ^</span><br><span class="line">      <span class="number">382</span> |     &#125;);</span><br><span class="line">      <span class="number">383</span> |   &#125;);</span><br><span class="line">      <span class="number">384</span> |</span><br><span class="line"></span><br><span class="line">      at <span class="built_in">Object</span>.&lt;anonymous&gt; (src/tests/integration.test.tsx:<span class="number">381</span>:<span class="number">35</span>)</span><br></pre></td></tr></table></figure>

<p>To fix it, we just have to pass the inverted <strong>isQuestionsOver</strong> value to the <strong>isNotRendered</strong> prop on the ‘Sentence’ component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [answerValue, setAnswerValue] = React.useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line"></span><br><span class="line">      &lt;Sentence sentence=&#123;sentence&#125; isNotComplete=&#123;!isQuestionsOver&#125; /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>This passes the test. Commit and move on.</p>
<h3 id="Input-submission-in-‘Answer’-component-is-rendered-in-the-‘Sentence’-component"><a href="#Input-submission-in-‘Answer’-component-is-rendered-in-the-‘Sentence’-component" class="headerlink" title="Input submission in ‘Answer’ component is rendered in the ‘Sentence’ component"></a>Input submission in ‘Answer’ component is rendered in the ‘Sentence’ component</h3><p>Finally, we get to the part where we test that our input is actually rendered in the ‘Sentence’ component.</p>
<p>For this, we will need to use the Redux action creator that we created in the previous post.<br>We will also have to create an input change handler, that will update local state in the ‘App’ component.</p>
<p>First, though, lets put down what we want by writing a test.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;renders input submission in the &#x27;Sentence&#x27; component&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// create mock event object</span></span><br><span class="line">  <span class="keyword">const</span> mockEvent = &#123;</span><br><span class="line">    target: &#123;</span><br><span class="line">      value: <span class="string">&quot;Mark&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// create empty preloaded Redux state</span></span><br><span class="line">  <span class="keyword">const</span> preloadedState = [</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;who&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;what&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;when&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      question: <span class="string">&quot;where&quot;</span>,</span><br><span class="line">      answer: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> wrapper = setup(preloadedState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select input element</span></span><br><span class="line">  <span class="keyword">const</span> input = wrapper.find(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// change event on input element</span></span><br><span class="line">  input.simulate(<span class="string">&quot;change&quot;</span>, mockEvent);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select &#x27;Next Question&#x27; button</span></span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp;</span><br><span class="line">      element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;Next Question&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// simulate button click to submit answer to Redux</span></span><br><span class="line">  button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// select sentence span</span></span><br><span class="line">  <span class="keyword">const</span> sentenceSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;sentence-span&#x27;]&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// assert that the sentence span contains our input value</span></span><br><span class="line">  expect(sentenceSpan.text()).toContain(mockEvent.target.value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Note that we preloaded state to make sure initial <strong>answer</strong> values are empty strings</p>
<p>As usual, the test fails. The fail is expected, as the sentence span renders an empty string instead of the “test” value from our <strong>mockEvent</strong> object.<br>On to fixing.</p>
<p>First, we want to make sure that there is a change handler passed to the ‘Answer’ component. This handler’s duty is to update <strong>answerValue</strong> state in the ‘App’ component.<br>With this, typing in the input will change the <strong>answerValue</strong> local state of the ‘App’ component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [answerValue, setAnswerValue] = React.useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleAnswerChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value &#125; = e.target;</span><br><span class="line"></span><br><span class="line">    setAnswerValue(value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;answerValue&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        onHandleChange=&#123;handleAnswerChange&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Next, we want to dispatch current value of the <strong>answerValue</strong> state to Redux.<br>We will do this in the question increment handler. When a user clicks on the ‘Next Question’ button, current answer is submitted to Redux, and then next question is rendered.<br>We will do this as a first thing in the handler, regardless of the current <strong>questionIndex</strong> value. This way we will be able to submit an answer whenever the button is clickable (not disabled or not rendered).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  setAnswerAction,</span><br><span class="line">  ANSWER_TYPE,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;./store/actions/questions.actions&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [answerValue, setAnswerValue] = React.useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleIncrementQuestion = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// submit answer to current question to Redux</span></span><br><span class="line">    dispatch(setAnswerAction(question.toUpperCase() <span class="keyword">as</span> ANSWER_TYPE, answerValue));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// questions are over when questionIndex is &gt;= 3</span></span><br><span class="line">    <span class="keyword">if</span> (questionIndex &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">      setIsQuestionsOver(<span class="literal">true</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// increment question index by one</span></span><br><span class="line">    setQuestionIndex(<span class="function">(<span class="params">prevState</span>) =&gt;</span> prevState + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Answer</span><br><span class="line">        question=&#123;formatQuestion(question)&#125;</span><br><span class="line">        answer=&#123;answerValue&#125;</span><br><span class="line">        isNotRendered=&#123;isQuestionsOver&#125;</span><br><span class="line">        onHandleChange=&#123;handleAnswerChange&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that I cast first argument to <strong>ANSWER_TYPE</strong>. This is because the action creator’s first argument can be only of certain values, and with this I make sure to tell TS that this value will conform to the requirement.</p>
<p>With this, the test passes. Our input does indeed render in the ‘Sentence’ component.</p>
<h3 id="Component-resets-sentence-when-‘New-Sentence’-button-is-clicked"><a href="#Component-resets-sentence-when-‘New-Sentence’-button-is-clicked" class="headerlink" title="Component resets sentence when ‘New Sentence’ button is clicked"></a>Component resets sentence when ‘New Sentence’ button is clicked</h3><p>Our last test checks that the game is reset when the ‘New Sentence’ button is clicked.<br>This means that the current sentence rendered in the ‘Sentence’ component is deleted, and only an empty string is rendered.<br>It also means that <strong>questionIndex</strong> state is reset to <strong>0</strong>, and <strong>isQuestions</strong> state is reset to <strong>false</strong>.</p>
<p>Let’s start with writing the test. We want to create a wrapper, select and click the button, and assert that the sentence span is empty.<br>We also expect the question in the ‘label’ element to be “Who?”, and that the ‘input’ element’s value is an empty string.</p>
<p>Here is the test:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">test(<span class="string">&quot;resets sentence when &#x27;New Sentence&#x27; button is clicked&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> wrapper = setup();</span><br><span class="line">  <span class="keyword">const</span> button = wrapper.findWhere(</span><br><span class="line">    (element) =&gt;</span><br><span class="line">      element.type() === <span class="string">&quot;button&quot;</span> &amp;&amp; element.prop(<span class="string">&quot;children&quot;</span>) === <span class="string">&quot;New Sentence&quot;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  button.simulate(<span class="string">&quot;click&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sentenceSpan = wrapper.find(<span class="string">&quot;[data-test=&#x27;sentence-span&#x27;]&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> label = wrapper.find(<span class="string">&quot;label&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> input = wrapper.find(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">  expect(sentenceSpan.text()).toBe(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  expect(label.text()).toBe(<span class="string">&quot;Who?&quot;</span>);</span><br><span class="line">  expect(input.prop(<span class="string">&quot;value&quot;</span>)).toBe(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test fails because, at the moment, we don’t have ‘New Sentence’ button in the app. Let’s add the <strong>Header</strong> component to the ‘App’ component, since ‘Header’ is the one where the button lives.<br>‘Header’ component expects two props: label for the button, and a function to handle the button click.<br>Here we supply both, after we define the said handler to dispatch another action to a Redux reducer. We will not deal with this action creator here, but focus on testing instead:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src\App.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useDispatch &#125; <span class="keyword">from</span> <span class="string">&quot;react-redux&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; newSentenceAction &#125; <span class="keyword">from</span> <span class="string">&quot;./store/actions/questions.actions&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [questionIndex, setQuestionIndex] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [isQuestionsOver, setIsQuestionsOver] = React.useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [answerValue, setAnswerValue] = React.useState(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleNewSentence = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    dispatch(newSentenceAction());</span><br><span class="line">    setQuestionIndex(<span class="number">0</span>);</span><br><span class="line">    setIsQuestionsOver(<span class="literal">false</span>);</span><br><span class="line">    setAnswerValue(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div data-test=<span class="string">&quot;component-app&quot;</span>&gt;</span><br><span class="line">      &lt;Header</span><br><span class="line">        onStartNewSentence=&#123;handleNewSentence&#125;</span><br><span class="line">        label=&#123;<span class="string">&quot;New Sentence&quot;</span>&#125;</span><br><span class="line">        primaryColor=&#123;colors.red&#125;</span><br><span class="line">        secondaryColor=&#123;<span class="string">&quot;white&quot;</span>&#125;</span><br><span class="line">      /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;<span class="comment">/* ... */</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Note that we manually reset required pieces of state in the handler function, to make sure the game is completely reset.</p>
<p>With this, we finish our app testing.<br>We have successfully created an app in TDD (I guess :)). We did unit testing and integration testing, and our app works. </p>
<p>Commit, and see you again. </p>
<!-- End Step Content -->

<!-- Project Information -->

<h2 id="Project-Information"><a href="#Project-Information" class="headerlink" title="Project Information"></a>Project Information</h2><h3 id="Available-at"><a href="#Available-at" class="headerlink" title="Available at"></a>Available at</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ikaem/sentence-game">Github repository</a></li>
<li><a target="_blank" rel="noopener" href="https://sentence-game.herokuapp.com/">Live website</a></li>
</ul>
<h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><ol>
<li>Use Jest and Enzyme to write an app with TDD approach</li>
<li>Make all tests pass and make the app work</li>
</ol>
<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><ol>
<li>Setup and unit testing</li>
<li><strong>Integration testing</strong></li>
</ol>
<h3 id="Tech-and-Tools"><a href="#Tech-and-Tools" class="headerlink" title="Tech and Tools"></a>Tech and Tools</h3><ul>
<li>React</li>
<li>TypeScript</li>
<li>Jest</li>
<li>Enzyme</li>
<li>Styled Components</li>
</ul>
<h3 id="Experience-with-Tech-amp-Tools"><a href="#Experience-with-Tech-amp-Tools" class="headerlink" title="Experience with Tech &amp; Tools"></a>Experience with Tech &amp; Tools</h3><p>I have no experience with React testing, aside from going over couple of tutorials online. At this point I am experimenting and have decided to go with Enzyme for this series, as it was the first testing library I did a course on.</p>
<h2 id="DISCLAIMER"><a href="#DISCLAIMER" class="headerlink" title="DISCLAIMER"></a>DISCLAIMER</h2><p>Don’t take any of this seriously and as a matter-of-fact. These are my notes. It might look like I am trying to teach something to someone. I am not.</p>
<p>Also, this post, and the whole blog, is not meant for a codealong. This is my notebook, and I learn these things by writing about them.<br>While I try to structure posts and organize them in a way that they build on previous posts’ progress, I can’t promise that they will include all details needed for the code to work. There is just too much of it, and I might omit things for brevity sake, or because I forgot something, or because I am not well organized, or because I changed my mind and reworked the code at the end of a blog series.</p>


                


                <!-- Cover image credit -->
                
                    <p class="image-credit-link">
                        Cover image by <strong>
                            <a target="_blank" rel="noopener" href="https://unsplash.com/@victorhwn725?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">
                                Victor He
                            </a>
                        </strong>
                    </p>

                

  

            </div>
            
            <!-- Custom placed tags -->
            <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                
                    


<a href="/angry-chaired-blog/tags/react/">#react</a> <a href="/angry-chaired-blog/tags/testing/">#testing</a> <a href="/angry-chaired-blog/tags/jest/">#jest</a> <a href="/angry-chaired-blog/tags/enzyme/">#enzyme</a> <a href="/angry-chaired-blog/tags/test-driven-development/">#test driven development</a>


                
            </div>
            <!--  -->



            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            

            <!-- Hyvor comments -->

            <!-- End of Hyvor comments -->
        </div>
    </div>
</article>



    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2020 kaem<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>