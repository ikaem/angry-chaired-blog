<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Author-->
    
        <meta name="author" content="kaem"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Tic Tac Toe with TypeScript: The Bug"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Angry Chaired Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

    <!-- Title -->
    
    <title>Tic Tac Toe with TypeScript: The Bug - Angry Chaired Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/angry-chaired-blog/css/style.css">

    
<link rel="stylesheet" href="/angry-chaired-blog/css/custom-style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/angry-chaired-blog/images/favicon.ico"/>
    

<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/angry-chaired-blog/atom.xml" title="Angry Chaired Blog" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/angry-chaired-blog/">Angry Chaired Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li class="">
                        <a href="/angry-chaired-blog/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://angrychaired.surge.sh">
                            
                                <i class="fa fa-user fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://github.com/ikaem/">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a href="/angry-chaired-blog/atom.xml">
                            
                                <i class="fa fa-rss fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('radek-3MLMpwt5Pj4-unsplash.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Tic Tac Toe with TypeScript: The Bug</h1>

                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            08/09/2020
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/angry-chaired-blog/categories/ts-tic-tac-toe/">ts tic tac toe</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Step Content Start -->

<h4 id="Part-3-of-3-in-Tic-Tac-Toe-with-TypeScript"><a href="#Part-3-of-3-in-Tic-Tac-Toe-with-TypeScript" class="headerlink" title="Part 3 of 3 in Tic Tac Toe with TypeScript"></a>Part 3 of 3 in Tic Tac Toe with TypeScript</h4><p>We have a bug in the game. Exciting times. Start the game and click on the same field twice. Now click on another field. What?! The same icon appears, you say? How can that be possible? Let’s find out.</p>
<a id="more"></a>

<h4 id="See-Project-Information"><a href="#See-Project-Information" class="headerlink" title="See Project Information"></a>See <a href="#Project-Information">Project Information</a></h4><p>The described behavior happens because the current code calls and executes code in the <strong>checkGameStatus</strong> method on every click. Since there is no check to prevent entering the method in case we already clicked on a field, the code checks if the current user has already made three moves. Assuming this is the second click on the same field after starting the game, code switches the player back to <strong>“X”</strong>, and adds a second move to the <strong>gameMoves</strong> array. We, however, cannot see any changes on the screen because the <strong>insertIcon</strong> method does not execute if there already is an icon in the cell.</p>
<p>So how do we fix this?</p>
<h2 id="Step-3-Insert-game-cells-from-the-game-class"><a href="#Step-3-Insert-game-cells-from-the-game-class" class="headerlink" title="Step 3: Insert game cells from the game class"></a>Step 3: Insert game cells from the game class</h2><p>This post is divided into:</p>
<ol>
<li>Possible solutions</li>
<li>Modifying the class constructor</li>
<li>Generating cell in the class</li>
<li>Append cells to the DOM</li>
<li>Modify new and reset game functionality</li>
</ol>
<h3 id="Possible-solution"><a href="#Possible-solution" class="headerlink" title="Possible solution"></a>Possible solution</h3><p>While you can probably figure out the solution by reading the post subtitle, let’s go over some of the options.</p>
<p>The issue here is that the event listener on each grid cell continues to live after we click on it first time.<br>The <strong>insertIcon</strong> method successfully deals with this by checking the cell contents before it exectues its logic. However, <strong>checkGameStatus</strong> cannot use this trick. Its logic actually depends on the contents of the cell.</p>
<p>So what to do?<br>Here are few options</p>
<h4 id="Remove-event-listener-after-the-click"><a href="#Remove-event-listener-after-the-click" class="headerlink" title="Remove event listener after the click."></a>Remove event listener after the click.</h4><p>JS does provide a method to remove an event listener from an element.<br>The method, <strong>removeEventListener</strong>, needs the event argument (<strong>“click”</strong> in our case), and the actual reference to a function that was used when the event listener was added.<br>To use this method, we should extract our function to a variable, and use it both when adding and removing the listener.</p>
<p>Here is an example:</p>
<figure class="highlight ts"><figcaption><span>Removing event listener from an element</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> listener = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;this is listener&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">element.addEventListener(<span class="string">&quot;click&quot;</span>, listener);</span><br><span class="line">element.removeEventListener(<span class="string">&quot;click&quot;</span>, listener);</span><br></pre></td></tr></table></figure>

<p>To solve our problem, we could use the listener function itself to remove event listener from an element.<br>We would need to define the listener inside the <strong>forEach</strong> loop, and then add use it with the event listener.<br>The listener function would call all needed methods in the class, and at the end it would call <strong>removeEventListene</strong>, and add itself as an argument</p>
<p>Here is the code</p>
<figure class="highlight ts"><figcaption><span>Removing event listener from grid cells</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">playGridCells.forEach(<span class="function">(<span class="params">cell</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// defining listener function</span></span><br><span class="line">  <span class="keyword">const</span> listener = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// calling class methods</span></span><br><span class="line">    exox.insertIcon(event.currentTarget <span class="keyword">as</span> HTMLDivElement);</span><br><span class="line">    exox.checkGameStatus(</span><br><span class="line">      (event.currentTarget <span class="keyword">as</span> HTMLDivElement).dataset <span class="keyword">as</span> CellLocation</span><br><span class="line">    );</span><br><span class="line">    exox.displayGameStatus();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// removing event listener from the current cell</span></span><br><span class="line">    cell.removeEventListener(<span class="string">&quot;click&quot;</span>, listener);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// adding event listener</span></span><br><span class="line">  cell.addEventListener(<span class="string">&quot;click&quot;</span>, listener);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>That is it. This would fix the problem with clicking multiple times on the same cell. Since event listener is removed from each cell that was clicked on, we cannot click on it anymore. Done.</p>
<p>But, but, but. What about the case when we start a new game? We cannot click on those same cells while playing a new game.<br>We could pass the entire cells array to the <strong>startNewGame</strong> and <strong>resetGame</strong> methods, and then iterate over them to and attach new event listeners.<br>But, what about the cells were not clicked on, and that have their old event listeners still active? Those would make old and new event listeners register a click, and we would have the <strong>checkGameStatus</strong> execute twice. Argh!!<br>Can we remove old event listeners? We could if we had access to the original listener function, but that one was declared in the <strong>forEach</strong> loop, and is not available to the class.<br>Could we declare it in the global scope? Sure, but then we would have to pass it to the class. Which is not a big deal, I guess. Still, I wan’t to have the code as compact as possible. We won’t do it.</p>
<h4 id="Use-“-once-true-”-argument-to-the-event-listener"><a href="#Use-“-once-true-”-argument-to-the-event-listener" class="headerlink" title="Use “{ once: true }” argument to the event listener"></a>Use “{ once: true }” argument to the event listener</h4><p>The <strong>addEventListener</strong> accepts the third argument, too. There are several possibilities to what the third argument can be, and one of those is an object holding a <strong>once</strong> boolean.<br>If used, it will automatically remove the event listener from the element after it is used first time.</p>
<figure class="highlight ts"><figcaption><span>Using "&#123; once: true &#125;" to use event listener only once</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">element.addEventListener(</span><br><span class="line">  <span class="string">&quot;click&quot;</span>,</span><br><span class="line">  () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;This event listener is used only once&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; once: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>This is similar to what we did in the first solution, and it results in the same problem.<br>We could pass the entire cells array…. We’re not doing it.</p>
<h4 id="Create-grid-cells-in-the-class-and-insert-them-into-DOM-for-each-new-game"><a href="#Create-grid-cells-in-the-class-and-insert-them-into-DOM-for-each-new-game" class="headerlink" title="Create grid cells in the class and insert them into DOM for each new game"></a>Create grid cells in the class and insert them into DOM for each new game</h4><p>What we could do is create cell elements inside the class and append them to the DOM every time the new and reset buttons are clicked. Before this is done, we would remove all previous cells, thus removing all active event listeners.<br>We would need to create the cell HTML element inside the game class, and give it CSS classes. We would need to iterate over nine of them to assign correct data attributes on each individual cell, and finally, to append them to the grid container in the DOM.</p>
<p>It is a longer, complicated and fun approach that uses the bug as an excuse to do something new. We’re doing it.</p>
<h3 id="Modifying-the-class-constructor"><a href="#Modifying-the-class-constructor" class="headerlink" title="Modifying the class constructor"></a>Modifying the class constructor</h3><p>Ok, here is the plan:</p>
<ol>
<li>We modify the constructor to accept the grid cells container</li>
<li>We create the cell HTML element inside the game class, and equip it with required CSS classes and an event listener.</li>
<li>We create methods that remove existing grid cells and append new grid cells to the DOM</li>
<li>We call these methods from <strong>startNewGame</strong> and <strong>resetGame</strong> methods, and do a final cleanup</li>
</ol>
<p>Let’s cross the first list item, and do the class constructor now.</p>
<p>We need to select the grid cells container and store it in a variable:</p>
<figure class="highlight ts"><figcaption><span>app.ts - Selecting the grid cells container</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gameGrid = <span class="built_in">document</span>.getElementById(<span class="string">&quot;game-grid&quot;</span>) <span class="keyword">as</span> HTMLDivElement;</span><br></pre></td></tr></table></figure>

<p>Then, we have the class constructor accept the new argument, and the game class passing it when the class instantiates</p>
<figure class="highlight ts"><figcaption><span>app ts - The grid cells container argument</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Exox &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> xScore: HTMLSpanElement,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> oScore: HTMLSpanElement,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> gameStatusBox: HTMLDivElement,</span></span><br><span class="line"><span class="params">    <span class="keyword">public</span> gameCellsContainer: HTMLDivElement</span></span><br><span class="line"><span class="params">  </span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.resetGame();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// game instance</span></span><br><span class="line"><span class="keyword">const</span> exoxGame = <span class="keyword">new</span> Exox(</span><br><span class="line">  playerXScore,</span><br><span class="line">  playerOScore,</span><br><span class="line">  gameStatusScreen,</span><br><span class="line">  gameGrid</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Generating-cell-in-the-class"><a href="#Generating-cell-in-the-class" class="headerlink" title="Generating cell in the class"></a>Generating cell in the class</h3><p>To generate the HTML element that will serve as a cell, we will create a helper function.<br>This function will return the element equiped with neccessary classes and a click event listener that calls methods of the class.</p>
<p>To create an element, we call <strong>createElement</strong> method available on the <strong>document</strong> object. We pass it a <strong>“div”</strong> string to indicate that we want a <strong>div</strong> element.</p>
<figure class="highlight ts"><figcaption><span>Creating a div element</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">createGridCell = (): <span class="function"><span class="params">HTMLDivElement</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> gridCell = <span class="built_in">document</span>.createElement(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Next is adding needed classes to the element. We will use the <strong>classList</strong> object available on the newly created element, and then call its <strong>add</strong> method to add multiple classes.<br>Note that these are <strong>Tailwind</strong> utility classes.</p>
<figure class="highlight ts"><figcaption><span>Adding classes to the cell element</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">createGridCell = (): <span class="function"><span class="params">HTMLDivElement</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ..</span></span><br><span class="line">  gridCell.classList.add(<span class="string">&quot;game-cell&quot;</span>, <span class="string">&quot;hover:bg-teal-400&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Finally, we add the event listener and return the newly created element from the method.<br>The methods that we call from the listener are all the same as the methods we called from the event listener on the selector variable.<br>However, note that we are using <strong>this</strong> keyword to specify that we are calling methods in the instance of the game class. To make sure that <strong>this</strong> refers to the class method, we also make the listener an arrow function.</p>
<figure class="highlight ts"><figcaption><span>Adding classes to the cell element</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">createGridCell = (): <span class="function"><span class="params">HTMLDivElement</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  gridCell.addEventListener(</span><br><span class="line">    <span class="string">&quot;click&quot;</span>,</span><br><span class="line">    (event) =&gt; &#123;</span><br><span class="line">      <span class="built_in">this</span>.insertIcon(event.currentTarget <span class="keyword">as</span> HTMLDivElement);</span><br><span class="line">      <span class="built_in">this</span>.checkGameStatus(</span><br><span class="line">        (event.currentTarget <span class="keyword">as</span> HTMLDivElement).dataset <span class="keyword">as</span> CellLocation</span><br><span class="line">      );</span><br><span class="line">      <span class="built_in">this</span>.displayGameStatus();</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; once: <span class="literal">true</span> &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> gridCell;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>That’s it. We added the <strong>{ once: true }</strong> argument to the <strong>addEventListener</strong> method, to make sure each cell can be clicked only once.</p>
<h3 id="Append-cells-to-the-DOM"><a href="#Append-cells-to-the-DOM" class="headerlink" title="Append cells to the DOM"></a>Append cells to the DOM</h3><p>Now we can append the newly created cell element to the DOM.</p>
<p>Before we do that, let’s create a method that will remove all existing cells from the DOM. We will call this method whenever new or reset buttons are clicked, to make sure the grid cell container is empty before we insert new cells.</p>
<p>To create this functionality, we will use the <strong>firstChild</strong> and <strong>removeChild</strong> properties available on DOM elements.</p>
<p>The <strong>firstChild</strong> property returns the first node inside an element. We will use it on the grid cells container.<br>The <strong>removeChild</strong> method removes a specified child on in a HTML element.<br>The idea here is to use a while loop to call <strong>removeChild</strong> as long as there is a <strong>firstChild</strong> node present on the grid cells container.</p>
<p>Here is the code:</p>
<figure class="highlight ts"><figcaption><span>Removing cells from the grid cells container</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">removeGridCells = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">this</span>.gameCellsContainer.firstChild) &#123;</span><br><span class="line">    <span class="built_in">this</span>.gameCellsContainer.removeChild(<span class="built_in">this</span>.gameCellsContainer.firstChild);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Nice. Now, we can create a method to append nine cell elements to the grid cells container.</p>
<p>There are few things we need to take care of before we actually do the appending.</p>
<ol>
<li>We need to have an array with nine elements. We will loop over it and append a cell to the grid on every iteration</li>
<li>We need to attach correct data attributes to each inidvidual cell. We will create local column, row, and diagonal variables to do so. Then, we will modify these variables while iterating over the array to assign proper values to each cell.</li>
<li>We need to use <strong>appendChild</strong> method on the grid container to insert a node at the end of the current child nodes stack</li>
</ol>
<h4 id="The-array"><a href="#The-array" class="headerlink" title="The array"></a>The array</h4><p>We create the array with the <strong>Array</strong> constructor, to which we pass an argument of <strong>9</strong>. This creates an array with the length of 9, but with no elements inside. This makes it unusable for any looping.<br>To make looping possible, we will assign an empty string to each position in the array by calling <strong>fill</strong> method on it, and passing it an empty string.</p>
<figure class="highlight ts"><figcaption><span>Creating an array</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cells = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="The-data-attributes-variables"><a href="#The-data-attributes-variables" class="headerlink" title="The data attributes variables"></a>The data attributes variables</h4><p>What a title, right?</p>
<p>Anyway, each cell has four data attributes:</p>
<ul>
<li><strong>data-cell-col</strong></li>
<li><strong>data-cell-row</strong></li>
<li><strong>data-cell-dg1</strong></li>
<li><strong>data-cell-dg2</strong></li>
</ul>
<p>We will create four variables to match the data attributes, and give them initial values:</p>
<ul>
<li><strong>col</strong>, with initial value of 1, because first cell will be in the first column</li>
<li><strong>row</strong>, with initial value of 1, because even though the first cell is in the first row, this makes my math easier</li>
<li><strong>dg1</strong> and <strong>dg2</strong> both start as an empty string</li>
</ul>
<figure class="highlight ts"><figcaption><span>The data attributes variables</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> col = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> row = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> dg1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> dg2 = <span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="The-loop"><a href="#The-loop" class="headerlink" title="The loop"></a>The loop</h4><p>Now, we loop. Inside the loop, we assign correct data attribute to each cell, and we append the cell to the grid cell container.</p>
<p>Let’s start with the data attribute for columns.<br>The <strong>col</strong> variable needs to increase by one on each loop iteration, and then return to 1 when it reaches 4. This will make each fourth cell get column attribute of 1.</p>
<p>Here is the code:</p>
<figure class="highlight ts"><figcaption><span>attaching data attributes to cells in the loop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> col = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">cells.map(<span class="function">(<span class="params">_, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// creating the cell from the helper method</span></span><br><span class="line">  <span class="keyword">const</span> gridCell = <span class="built_in">this</span>.createGridCell();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (col &gt; <span class="number">3</span>) col = <span class="number">1</span>; <span class="comment">// reverting to 1 when value reaches 4</span></span><br><span class="line"></span><br><span class="line">  gridCell.dataset.cellCol = col.toString(); <span class="comment">// assigning data attribute to the cell</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.gameCellsContainer.appendChild(gridCell); <span class="comment">// appending the cell to the cells container</span></span><br><span class="line"></span><br><span class="line">  col++; <span class="comment">// increase value by 1 on each iteration</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Note that we are using the <strong>dataset</strong> object on the cell to insert data attributes.<br>Also, the data attributes are strings, so we are converting our <strong>col</strong> variable to string with the <strong>toString</strong> function.</p>
<p>Next up is the <strong>row</strong> variable.<br>Row value stays same for every three cells in a row, and then increases by 1 with every fourth cell.<br>This means that we should increase the value of <strong>row</strong> variable on every fourth iteration.<br>We accomplish this by checking if the current iteration index is divisible by 3. If yes, we increase value of the variable by 1.</p>
<p>Here is the code:</p>
<figure class="highlight ts"><figcaption><span>attaching data attributes to cells in the loop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> row = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">cells.map(<span class="function">(<span class="params">_, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (index % <span class="number">3</span> === <span class="number">0</span>) row++;</span><br><span class="line"></span><br><span class="line">  gridCell.dataset.cellRow = row.toString();</span><br><span class="line">  <span class="comment">//   ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Let’s do the first diagonal now. It is the one going from top-left to bottom-right.<br>There are only three cells that are on this diagonal - 1st, 5th, and 9th.<br>In JS array counting, these are array elements at positions 0, 4, and 8.<br>Which makes it easy to see that if index of an element inside the array is divisible by 4, the cell attached to that element is on the first diagonal.</p>
<p>Here is the code:</p>
<figure class="highlight ts"><figcaption><span>attaching data attributes to cells in the loop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dg1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">cells.map(<span class="function">(<span class="params">_, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (index % <span class="number">4</span> === <span class="number">0</span>) dg1 = <span class="string">&quot;true&quot;</span>;</span><br><span class="line"></span><br><span class="line">  gridCell.dataset.cellDg1 = dg1;</span><br><span class="line">  <span class="comment">//   ...</span></span><br><span class="line"></span><br><span class="line">  dg1 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>It is a similar situation with the second diagonal, going from bottom left to top right.<br>Array positions of cells on this diagonal are 2, 4, and 6.<br>So if element index is divisible by 2, but it is not 0 or 8, its cell is on the second diagonal.</p>
<p>Here is the code:</p>
<figure class="highlight ts"><figcaption><span>attaching data attributes to cells in the loop</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> dg2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">cells.map(<span class="function">(<span class="params">_, index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (index % <span class="number">2</span> === <span class="number">0</span> &amp;&amp; index &amp;&amp; index !== <span class="number">8</span>) dg2 = <span class="string">&quot;true&quot;</span>;</span><br><span class="line"></span><br><span class="line">  gridCell.dataset.cellDg1 = dg2;</span><br><span class="line">  <span class="comment">//   ...</span></span><br><span class="line"></span><br><span class="line">  dg2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And that is it. Each of our cells will now have data attritues that correspond to their position in the grid.</p>
<p>Note that we did not assign the <strong>data-grid-cell</strong> data attribute to the cell.<br>We only used that one to select all cells in the DOM, and then attaching an event listener to them. Since we are now attaching event listener when we create the cell, there is no need for that data attribute.</p>
<h3 id="Modify-new-and-reset-game-functionality"><a href="#Modify-new-and-reset-game-functionality" class="headerlink" title="Modify new and reset game functionality"></a>Modify new and reset game functionality</h3><p>Finally, we can use the two newly created methods with our <strong>startNewGame</strong> and <strong>resetGame</strong> methods.</p>
<p>When either of those methods is called, we want to remove existing cells first, and then append new ones.</p>
<p>Here is the code for both methods:</p>
<figure class="highlight ts"><figcaption><span>modified "startNewGame" and "resetGame" methods</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">startNewGame = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.removeGridCells();</span><br><span class="line">  <span class="built_in">this</span>.appendGridCells();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.isGameOn = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">this</span>.gameMoves = [];</span><br><span class="line">  <span class="built_in">this</span>.roundWinner = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="built_in">this</span>.playerOnMove = <span class="string">`X`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.displayGameStatus();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">resetGame = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.removeGridCells();</span><br><span class="line">  <span class="built_in">this</span>.appendGridCells();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.isGameOn = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">this</span>.roundWinner = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="built_in">this</span>.gameMoves = [];</span><br><span class="line">  <span class="built_in">this</span>.playerOnMove = <span class="string">`X`</span>;</span><br><span class="line">  <span class="built_in">this</span>.totalScore = [];</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.displayGameScore();</span><br><span class="line">  <span class="built_in">this</span>.displayGameStatus();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>We could actually make this shorter and have <strong>resetGame</strong> call <strong>newGame</strong>, and only reset <strong>totalScore</strong> and call <strong>displayGameScore</strong> on its own.</p>
<p>In the end, we will just tidy up the code a bit.</p>
<ul>
<li>Since we are not using the hardoced HTML cells anymore, we can remove those</li>
<li>We are also not passing any arguments to our <strong>startNewGame</strong> and <strong>resetGame</strong> methods, so we can remove those both in methods’ defintions and calls</li>
<li>We don’t need the selector or adding of event listeners to grid cells outside of the game class, so that can go too.</li>
<li>Finally, since our event listeners now last only for one click, the empty target check on the <strong>insertIcon</strong> method can be removed</li>
</ul>
<p>That’s it. Game over. We have successfully replaced hardcoded HTML with … programmatic one? I don’t know how that is called.<br>But, it solved our problem by removing all grid cells and append new ones to the DOM every time we start a new game.</p>
<!-- End Step Content -->

<!-- Project Information -->

<h2 id="Project-Information"><a href="#Project-Information" class="headerlink" title="Project Information"></a>Project Information</h2><h3 id="Available-at"><a href="#Available-at" class="headerlink" title="Available at"></a>Available at</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ikaem/exox">Github repository</a></li>
<li><a target="_blank" rel="noopener" href="http://kaem.freecluster.eu/apps/exox/">Live website</a></li>
</ul>
<h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><ol>
<li>Create a simple Tic Tac Toe game for two persons</li>
</ol>
<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><ol>
<li>Set up the project</li>
<li>Code the game</li>
<li><strong>Insert game cells from the game class</strong></li>
</ol>
<h3 id="Tech-and-Tools"><a href="#Tech-and-Tools" class="headerlink" title="Tech and Tools"></a>Tech and Tools</h3><ol>
<li>TypeScript</li>
<li>Tailwind</li>
<li>Webpack</li>
</ol>
<h3 id="Experience-with-Tech-amp-Tools"><a href="#Experience-with-Tech-amp-Tools" class="headerlink" title="Experience with Tech &amp; Tools"></a>Experience with Tech &amp; Tools</h3><p>I guess I am ok with all of the tools used. Main reason I am doing this is to work on my logic skills. In the last project I couldn’t fully figure out the logic of the calculator by mayself, so I wanted to do it now to make myself feel better :)</p>
<h2 id="DISCLAIMER"><a href="#DISCLAIMER" class="headerlink" title="DISCLAIMER"></a>DISCLAIMER</h2><p>Don’t take any of this seriously and as a matter-of-fact. These are my notes. It might look like I am trying to teach something to someone. I am not.</p>


                


                <!-- Cover image credit -->
                
                    <p class="image-credit-link">
                        Cover image by <strong>
                            <a target="_blank" rel="noopener" href="https://unsplash.com/@radkovsky?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">
                                Radek
                            </a>
                        </strong>
                    </p>

                

  

            </div>
            
            <!-- Custom placed tags -->
            <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                
                    


<a href="/angry-chaired-blog/tags/typescript/">#typescript</a> <a href="/angry-chaired-blog/tags/games/">#games</a>


                
            </div>
            <!--  -->



            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            

            <!-- Hyvor comments -->

            <!-- End of Hyvor comments -->
        </div>
    </div>
</article>



    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2020 kaem<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>