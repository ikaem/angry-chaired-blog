<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Author-->
    
        <meta name="author" content="kaem"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="GraphQL &amp; React &amp; PSQL: Apollo Client &amp; Backend-frontend communication"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Inexperienced and curious pokes into the sprawling world of web development "/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="Angry Chaired Blog"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="https://ikaem.github.io/angry-chaired-blog/angry-chaired-blog/images/header-image.jpg"/>
    

    <!-- Title -->
    
    <title>GraphQL &amp; React &amp; PSQL: Apollo Client &amp; Backend-frontend communication - Angry Chaired Blog</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/angry-chaired-blog/css/style.css">


    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    
    <link rel="icon" href="/angry-chaired-blog/images/favicon.ico"/>
    

<meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/angry-chaired-blog/atom.xml" title="Angry Chaired Blog" type="application/atom+xml">
</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/angry-chaired-blog/">Angry Chaired Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li class="">
                        <a href="/angry-chaired-blog/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li class="">
                        <a href="/angry-chaired-blog/categories">
                            
                                Categories
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://angrychaired.surge.sh">
                            
                                <i class="fa fa-user fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a target="_blank" rel="noopener" href="https://github.com/ikaem/">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
                    <li class="icon-label">
                        <a href="/angry-chaired-blog/atom.xml">
                            
                                <i class="fa fa-rss fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/angry-chaired-blog/images/header-image.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>GraphQL & React & PSQL: Apollo Client & Backend-frontend communication</h1>

                    <span class="meta">
                        <!-- Date and Author -->
                        
                        
                            16/08/2020
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/angry-chaired-blog/categories/graphql-react-psql/">graphql & react & psql</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <!-- Step Content Start -->

<h4 id="Part-8-of-9-in-GraphQL-amp-React-amp-PSQL"><a href="#Part-8-of-9-in-GraphQL-amp-React-amp-PSQL" class="headerlink" title="Part 8 of 9 in GraphQL &amp; React &amp; PSQL"></a>Part 8 of 9 in GraphQL &amp; React &amp; PSQL</h4><p>Now that we have the Apollo Client set up on the frontend, we can use it to communicate with the backend.<br>For this purpose, Apollo Client provides hooks that can be used to query and mutate data. There is probably one to subscribe to data, but I don’t use it in this project. </p>
<a id="more"></a>

<h4 id="See-Project-Information"><a href="#See-Project-Information" class="headerlink" title="See Project Information"></a>See <a href="#Project-Information">Project Information</a></h4><h2 id="Step-9-Establish-frontend-and-backend-communication-via-Apollo-Client"><a href="#Step-9-Establish-frontend-and-backend-communication-via-Apollo-Client" class="headerlink" title="Step 9. Establish frontend and backend communication via Apollo Client"></a>Step 9. Establish frontend and backend communication via Apollo Client</h2><p>The hooks that we will use turn out to have a very useful feature, that I initially found confusing. They also hold state in them, so we do not need to use the actual React’s <strong>useState</strong> to hold data returned from the GQL query.<br>In the beginning I thought this to be unnecessary, but of course, it turned out that I don’t know much. It is a great feature.</p>
<p>This is what we will do:</p>
<ol>
<li>Test Apollo Client’s hooks to query and mutate country data in the PSQL database. </li>
<li>Get all users from database and show them on the home page with the useQuery hook</li>
<li>Get a specific user for profile page with useQuery hook</li>
<li>Add new user with useMutation hook</li>
<li>Edit user with useMutation hook</li>
<li>Delete user with useMutation hook</li>
</ol>
<h3 id="Test-Apollo-Client’s-hooks-to-query-and-mutate-country-data-in-the-PSQL-database"><a href="#Test-Apollo-Client’s-hooks-to-query-and-mutate-country-data-in-the-PSQL-database" class="headerlink" title="Test Apollo Client’s hooks to query and mutate country data in the PSQL database"></a>Test Apollo Client’s hooks to query and mutate country data in the PSQL database</h3><p>We will test the hooks by getting all countries from our PSQL database, getting a specific country, and by creating a new country. We will use console.log to see all of this data, instead of actuall rendering it on the page.</p>
<p>To get all available countries and a specific country, we will use the <strong>useQuery</strong> hook provided by Apollo CLient.<br>To add a new country to the database, we will use the <strong>useMutation</strong> hook.</p>
<p>We will do all of this inside the <strong>App</strong> component, under <strong>“/</strong> route. By visiting <strong>localhost:3000/</strong>, we will be able to see results of the <strong>useQuery</strong> hook, and after pressing a button to add a country, we will create a new country.</p>
<h4 id="useQuery-hook"><a href="#useQuery-hook" class="headerlink" title="useQuery hook"></a>useQuery hook</h4><p>First, we need to import the hook from <strong>“@apollo/client</strong>, together with the <strong>gql</strong> method.<br>We will use <strong>gql</strong> to parse strings into GQL queries.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useQuery, gql &#125; <span class="keyword">from</span> <span class="string">&quot;@apollo/client&quot;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="getCountries"><a href="#getCountries" class="headerlink" title="getCountries"></a>getCountries</h5><p>Now, we will create a query to fetch all countries from our database.<br>We do this outside the component, probably best under all imports used in the component.</p>
<p>The query we will create is the same as the query we were using in the GraphQL Playground.<br>We query for a particular property on the root Query type, and the resolver that matches the name of this property will do its thing and return appropriate data.</p>
<p>In this case we want to query the <strong>getCountries</strong> property, which will call <strong>getCountries</strong> resolver, and send use a response in form of array of Country types. Then, becuase this query returns Country data, which in turn has its own properties, we also need to specify which of those properties we want to have in the response.</p>
<p>Here is the query:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// app.tsx</span></span><br><span class="line">    <span class="keyword">const</span> GET_COUNTRIES_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetCountries &#123;</span></span><br><span class="line"><span class="string">        getCountries &#123;</span></span><br><span class="line"><span class="string">            country_id,</span></span><br><span class="line"><span class="string">            country_name</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>The actual hook needs to be placed inside the component in which we want to use it.<br>For this particular case, we will have it accept one argument - the query we just made.<br>The hook returns an object with multiple properties, and for now we will destructure three properties from this object:</p>
<ol>
<li>data - holding the data that we requested in our query, in case the query was successful</li>
<li>loading - evaluating to true or false, depending on whether the query is still being processed</li>
<li>error - holding an object with error information, in case an error happened and data could not be retrieved. </li>
</ol>
<p>Here is the <strong>useQuery</strong> in use:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.tsx</span></span><br><span class="line"><span class="keyword">const</span> &#123; data, loading, error &#125; = useQuery(GET_COUNTRIES_QUERY);</span><br></pre></td></tr></table></figure>

<p>We can now use the destructure properties to conditionally render contents of the component.<br>In this example, however, we will use them to conditionally console.log data.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.tsx</span></span><br><span class="line"><span class="keyword">const</span> &#123; data, loading, error &#125; = useQuery(GET_COUNTRIES_QUERY);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(loading) <span class="built_in">console</span>.log(<span class="string">&quot;loading&quot;</span>)</span><br><span class="line"><span class="keyword">if</span>(error) <span class="built_in">console</span>.log(error);</span><br><span class="line"><span class="keyword">if</span>(data) <span class="built_in">console</span>.log(data);</span><br></pre></td></tr></table></figure>

<p>The <strong>data</strong> property holds the respnse in form of another object. This object holds the name of the actual query that we called with the <strong>gql</strong> method. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">getCountries</span>: <span class="built_in">Array</span>(<span class="number">12</span>)&#125;</span><br></pre></td></tr></table></figure>

<p>And this object holds an array of countries what we required in our query.<br>Note the <strong>__typename</strong> property on the each item object in the array. It holds the name of the type of this object item, as defined in <strong>typeDefs</strong> in the Apollo Server Express instance.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">getCountries: <span class="built_in">Array</span>(<span class="number">12</span>)</span><br><span class="line">    <span class="number">0</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;croatia&quot;</span>&#125;</span><br><span class="line">    <span class="number">1</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;2&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;slovenia&quot;</span>&#125;</span><br><span class="line">    <span class="number">2</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;3&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;serbia&quot;</span>&#125;</span><br><span class="line">    <span class="number">3</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;4&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;montenegro&quot;</span>&#125;</span><br><span class="line">    <span class="number">4</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;5&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;bosnia and herzegovina&quot;</span>&#125;</span><br><span class="line">    <span class="number">5</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;6&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;germany&quot;</span>&#125;</span><br><span class="line">    <span class="number">6</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;7&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;albania&quot;</span>&#125;</span><br><span class="line">    <span class="number">7</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;8&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;kosovo&quot;</span>&#125;</span><br><span class="line">    <span class="number">8</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;9&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;macedonia&quot;</span>&#125;</span><br><span class="line">    <span class="number">9</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;10&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;hungary&quot;</span>&#125;</span><br><span class="line">    <span class="number">10</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;11&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;bulgaria&quot;</span>&#125;</span><br><span class="line">    <span class="number">11</span>: &#123;<span class="attr">__typename</span>: <span class="string">&quot;Country&quot;</span>, <span class="attr">country_id</span>: <span class="string">&quot;13&quot;</span>, <span class="attr">country_name</span>: <span class="string">&quot;romania&quot;</span>&#125;</span><br><span class="line">    length: <span class="number">12</span></span><br></pre></td></tr></table></figure>

<h5 id="getCountry"><a href="#getCountry" class="headerlink" title="getCountry"></a>getCountry</h5><p>Now, we will use the useQuery hook to get a specific country.<br>This requires us to provide an argument to the query, which will be used by a corresponsing resolver on the backend to find and return the matching country.</p>
<p>Again, we will create the query first.<br>Note the syntax for providing information about arguments within the <strong>gql</strong> method: </p>
<ul>
<li>First we declare the argument with <strong>$</strong> sign.</li>
<li>Then we specify what is the type of the argument.</li>
<li>Then, when we actually call the query <strong>getCountry</strong>, we specify that the <strong>id</strong> argument should be assign a variable of <strong>$id</strong>.</li>
</ul>
<p>Here is the query:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> GET_SPECIFIC_COUNTRY_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetCountry($id: Int!) &#123;</span></span><br><span class="line"><span class="string">        getCountry(id: $id) &#123;</span></span><br><span class="line"><span class="string">            country_id,</span></span><br><span class="line"><span class="string">            country_name</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>For this example, we need to provide the query with the necessary variable. We do this by adding a second argument to the <strong>useQuery</strong> hook. </p>
<p>This second argument is an object which has, among others, a property called <strong>variables</strong>.<br>The <strong>variables</strong> property is an object as well, and inside we add our variables as key - value pairs, where keys match names of the variables we need. </p>
<p>Here it is in action, together with conditional console.logging of responses from the query:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: specificCountryData, <span class="attr">loading</span>: specificCountryLoading, <span class="attr">error</span>: specificCountryError &#125; = useQuery(GET_SPECIFIC_COUNTRY_QUERY, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        id: <span class="number">8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(specificCountryLoading) <span class="built_in">console</span>.log(<span class="string">&quot;loading&quot;</span>)</span><br><span class="line"><span class="keyword">if</span>(specificCountryError) <span class="built_in">console</span>.log(specificCountryError);</span><br><span class="line"><span class="keyword">if</span>(specificCountryData) <span class="built_in">console</span>.log(specificCountryData);</span><br></pre></td></tr></table></figure>

<p>Note few things:</p>
<ul>
<li>We hardcoded the value of the variable inside the useQuery hook. Normally, we wouldn’t do this, but would instead get the value from the url, for instance.</li>
<li>We also assigned values of response data, loading and error to other variables, to avoid name clashing with the previous query for all countries.</li>
<li>The variable definition and type (this is how I call it, i don’t know if this is exactyl what it is) sets the <strong>$id</strong> to be of type <strong>Int!</strong>. The “!” is important, because this is the way se set this particular query on the backedn in typeDefs.</li>
</ul>
<p>Again, the response we receive from the backend is an object holding a single property with the name same as the actual query - <strong>getCountry</strong> in this case. This property contains values that we requested - country_id and country_name</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">getCountry</span>: &#123;…&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">getCountry:</span><br><span class="line">    country_id: <span class="string">&quot;8&quot;</span></span><br><span class="line">    country_name: <span class="string">&quot;kosovo&quot;</span></span><br><span class="line">    __typename: <span class="string">&quot;Country&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="addCountry"><a href="#addCountry" class="headerlink" title="addCountry"></a>addCountry</h5><p>Next up, we use the <strong>useMutation</strong> hook.<br>Same as with the previous hook, we need to import it from “@apollo/client” first</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMutation, gql &#125; <span class="keyword">from</span> <span class="string">&quot;@apollo/client&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>Again, we will first create the mutation query that we will pass to the hook.</p>
<p>Since we are creating new entry in our database, we need the query to send some data to GQL resolvers on the backend. We will use variables to do this.</p>
<p>Same as before, first we need to define and type variables that we plan to use, and then include them in the actual mutation query.<br>Then, we specify which data we want to receive back from the resolver. </p>
<p>In this case, we will have only one variable in the query, which will send the new country’s name to the resolver.<br>And once the mutation is over, we request the new country’s id and name back in the response data.</p>
<p>Here is the query:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ADD_COUNTRY_MUTATION_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    mutation AddCountry($country_name: String!) &#123;</span></span><br><span class="line"><span class="string">        addCountry(country_name: $$country_name) &#123;</span></span><br><span class="line"><span class="string">            country_id,</span></span><br><span class="line"><span class="string">            country_name</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>Note that the type of query is not “query” anymore, but instead it is “<strong>mutation</strong>“, as stated right at the start of string inside the <strong>gql</strong> method.</p>
<p>Ok, now we get to use the <strong>useMutation</strong> hook.</p>
<p>Unlike the <strong>useQuery</strong> hook which returns an object with exact names of properties that we can destructure, the <strong>useMutation</strong> hook returns an array.<br>This means that, when destructuring the returned array’s items, we can give them any names that we want. On the other side, however, we do have to destructure them in a specific order, to make sure we get correct items from the array.</p>
<p>The <strong>useMutation</strong> hook returns an array with these 2 items, in this specific order:</p>
<p><strong>mutationMethod</strong><br>The method to do actual mutation. This method needs to be called somewhere inside to do the actual mutatioh, since the hook itself doesn’t really perform the mutation.</p>
<p><strong>dataObject</strong><br>The object containing several properties:</p>
<ul>
<li>data - obviously, the property that contains data returned from the mutation</li>
<li>loading - loading</li>
<li>error - error information, in case of error</li>
<li>called - a boolean, telling us if the <strong>mutationMethod</strong> was called</li>
<li>client - instance of our ApolloClient, that we can use to update or read cache, for instance. We will not deal with it in this post. </li>
</ul>
<p>Next, the <strong>useMutation</strong> hook itself accepts 2 arguments:</p>
<ul>
<li>The actual mutation query</li>
<li>Object that can hold properties like <strong>variables</strong> object, <strong>onCompleted</strong> method specifying actions to be exectured after successful mutation, <strong>onError</strong> in case of error, and so on.</li>
</ul>
<p>Alright, here is the hook in use, with the variables property defined in the arguments to the <strong>useMutation</strong> hook:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [ addCountryMutation, &#123; <span class="attr">data</span>: addCountryMutationData, <span class="attr">loading</span>: addCountryMutationLoading, <span class="attr">error</span>: addCountryMutationError &#125; ] = useMutation(ADD_COUNTRY_MUTATION_QUERY, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        country_name: <span class="string">&quot;turkey&quot;</span>,</span><br><span class="line">    &#125;, </span><br><span class="line">    onCompleted: <span class="function">(<span class="params">data</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;data after mutation is completed:&quot;</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Note the <strong>onCompleted</strong> property on the hook’s arguments object. If the mutation succeeds, the property (method) receives the response as an argument, and the we log that response. </p>
<p>Now we actually need to perform the mutation to create a new country entry in the database, give the country the name of “turkey”, and have the mutation return the country’s id and name back to us. </p>
<p>Normally, we would have entire form and appropriate inputs to have user provide name of the country. Here, we will only have a button that will send the hardcoded country’s name to the backend. </p>
<p>The button will have the React’s onClick event listener attached to it, that will, when clicked, call <strong>addCountryMutation</strong> method. This method will then perform the mutation. </p>
<p>Here it is in code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;Switch&gt;</span><br><span class="line">    &lt;Route exact path=<span class="string">&quot;/&quot;</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;<span class="function">() =&gt;</span> addCountryMutation()&#125;&gt;</span><br><span class="line">          Add Country</span><br><span class="line">        &lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Route&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;Switch&gt;</span><br></pre></td></tr></table></figure>

<p>That’s it, very simple.<br>The mutation method (<strong>addCountryMutation</strong> in this case) also accepts argument of an object, and one of its properties can be the <strong>variables</strong> object. This makes it possible to dynamically change variable’s value, for instance.</p>
<p>/////////////////////////////////////////////////////////////////////////////////////////</p>
<h3 id="Get-all-users-from-database-and-show-them-on-the-home-page-with-the-useQuery-hook"><a href="#Get-all-users-from-database-and-show-them-on-the-home-page-with-the-useQuery-hook" class="headerlink" title="Get all users from database and show them on the home page with the useQuery hook"></a>Get all users from database and show them on the home page with the useQuery hook</h3><p>Now that we know how to do queries and mutations from the frontend, let’s use the knowledge to fill the app pages with data.</p>
<p>We will use the <strong>useQuery</strong> hook to fetch all users from the database, and show them on the <strong>home page</strong> that lives on the <strong>“/“</strong> route.</p>
<p>We will make such query that it only returns five pieces of data for each user:</p>
<ol>
<li>user_id</li>
<li>avatar_link</li>
<li>first_name</li>
<li>country_name</li>
<li>city,</li>
<li>website url</li>
</ol>
<p>We will use this data to create a brief description of each user. When clicked on the name, React Router’s <strong>Link</strong> component will take us to that user’s full profile.</p>
<p>Here are steps:</p>
<ol>
<li>We will create the query with <strong>gql</strong> method</li>
<li>We will use the <strong>useQuery</strong> hook to query the Apollo Server Express for a list of users</li>
<li>We will create component - a container more specifically. We will call it <strong>UsersBriefMapper</strong>, and will use it to map over the list of users returned form the Apollo Server Express, and then return <strong>UserBrief</strong> component described below, for each user in the list. We will not go into details of this particular component here. </li>
<li>Create a component that renders brief data for each user. We will call this component <strong>UserBrief</strong>, and will not go into details of creating it here.</li>
</ol>
<h4 id="Create-the-query-with-gql-method"><a href="#Create-the-query-with-gql-method" class="headerlink" title="Create the query with gql method"></a>Create the query with <strong>gql</strong> method</h4><p>As we already know, we need to import the <strong>gql</strong> method, and, since we are doing it, might as well import the <strong>useQuery</strong> hook.<br>We import it from “@apollo/client, and we do it in the <strong>home.page.tsx</strong> file.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useQuery, gql &#125; <span class="keyword">from</span> <span class="string">&quot;@apollo/client&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>Time for the query. Note the subquery for the country property.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> USERS_LIST_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetUsersList &#123;</span></span><br><span class="line"><span class="string">        getUsers &#123;</span></span><br><span class="line"><span class="string">            user_id,</span></span><br><span class="line"><span class="string">            avatar_link,</span></span><br><span class="line"><span class="string">            first_name,</span></span><br><span class="line"><span class="string">            last_name,</span></span><br><span class="line"><span class="string">            country &#123; country_name &#125;,</span></span><br><span class="line"><span class="string">            city,</span></span><br><span class="line"><span class="string">            website</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Use-the-useQuery-hook-to-query-the-Apollo-Server-Express-for-a-list-of-users"><a href="#Use-the-useQuery-hook-to-query-the-Apollo-Server-Express-for-a-list-of-users" class="headerlink" title="Use the useQuery hook to query the Apollo Server Express for a list of users"></a>Use the <strong>useQuery</strong> hook to query the Apollo Server Express for a list of users</h4><p>Let’s do this part.<br>We already have the hook imported, so we only need to pass it the query, and destructure its returned object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: usersData, <span class="attr">loading</span>: usersLoading, <span class="attr">error</span>: usersError &#125; = useQuery(USERS_LIST_QUERY);</span><br></pre></td></tr></table></figure>

<p>Next, we conditionally render the HomePage comcponent content, and pass the users to the UsersBriefMapper.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home.page.tsx</span></span><br><span class="line"><span class="keyword">return</span>(</span><br><span class="line">    ...</span><br><span class="line">    &lt;div </span><br><span class="line">        className=<span class="string">&quot;people-section__users-brief-mapper-wrapper&quot;</span>&gt;</span><br><span class="line">        &#123;usersError &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Unfortunately, there was an error fetching users. Please try again later. <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">        &#123;usersLoading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">        &#123;usersData &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">UsersBriefMapper</span> </span></span></span><br><span class="line"><span class="xml">            users=&#123;usersData.getUsers&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Use-the-UsersBriefMapper-component-to-map-over-the-list-of-users"><a href="#Use-the-UsersBriefMapper-component-to-map-over-the-list-of-users" class="headerlink" title="Use the UsersBriefMapper component to map over the list of users"></a>Use the <strong>UsersBriefMapper</strong> component to map over the list of users</h4><p>In this part we will:</p>
<ol>
<li>Set TS types for props coming to the UsersBriefMapper component</li>
<li>Map over the users, and render <strong>UserBrief</strong> component for each user</li>
</ol>
<h5 id="TS-types"><a href="#TS-types" class="headerlink" title="TS types"></a>TS types</h5><p>We will create an interface inside the <strong>users-brief-mapper.container.tsx</strong> file, to set the shape and type of props coming into this component.</p>
<p>The interface defines shape of all props, holding name of a prop, and its shape.<br>In this case, we have only <strong>users</strong> prop coming into the component, which is an array of objects with multiple properties.<br>Then, we declare the compoent, and set the type of its props.  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users-brief-mapper.container.tsx</span></span><br><span class="line">...</span><br><span class="line">interface UsersBriefMapperProps &#123;</span><br><span class="line"></span><br><span class="line">    users: <span class="built_in">Array</span>&lt;&#123;</span><br><span class="line">        avatar_link: string;</span><br><span class="line">        city: string;</span><br><span class="line">        first_name: string;</span><br><span class="line">        last_name: string;</span><br><span class="line">        user_id: string;</span><br><span class="line">        website: string;</span><br><span class="line">        country: &#123;</span><br><span class="line">            country_name: string;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UsersBriefMapper = <span class="function">(<span class="params">&#123; users &#125;: UsersBriefMapperProps </span>) =&gt;</span> &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="Map-over-users"><a href="#Map-over-users" class="headerlink" title="Map over users"></a>Map over users</h5><p>It is simple, really. We just map over the users, and return the <strong>UserBrief</strong> component, and pass it props.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users-brief-mapper.container.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &#123; users.map(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;UserBrief </span><br><span class="line">                key=&#123;user.user_id&#125;</span><br><span class="line">                user=&#123;user&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Use-the-UserBrief-component-to-render-each-user-in-the-list"><a href="#Use-the-UserBrief-component-to-render-each-user-in-the-list" class="headerlink" title="Use the UserBrief component to render each user in the list"></a>Use the <strong>UserBrief</strong> component to render each user in the list</h4><p>This part is pretty similar to the previous one.</p>
<ol>
<li>Set TS types for props coming to the UserBrief component</li>
<li>Inside the component, render the user data</li>
</ol>
<h5 id="TS-Props-Types"><a href="#TS-Props-Types" class="headerlink" title="TS Props Types"></a>TS Props Types</h5><p>Interface for the props here is the same as in the Mapper component, except for it being just a single user object instead of an array of user objects.</p>
<p>We could have also destructured the entire user object when setting props from the mapper component, and have the UserBrief component accept already destructured user properties.<br>I prefere this approach, though. I find it a bit cleaner, especially when there are other props not related to the user. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-brief.component.tsx</span></span><br><span class="line">...</span><br><span class="line">interface UserBriefProps &#123;</span><br><span class="line">    user: &#123;</span><br><span class="line">        avatar_link: string;</span><br><span class="line">        city: string;</span><br><span class="line">        first_name: string;</span><br><span class="line">        last_name: string;</span><br><span class="line">        user_id: string;</span><br><span class="line">        website: string;</span><br><span class="line">        country: &#123;</span><br><span class="line">            country_name: string;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserBrief = <span class="function">(<span class="params">&#123; user &#125;: UserBriefProps</span>) =&gt;</span> &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="Render-User-data"><a href="#Render-User-data" class="headerlink" title="Render User data"></a>Render User data</h5><p>Finally, the render itself is simple enough.<br>We can destructure the <strong>user</strong> props, and just render the values in the component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-brief.component.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;div className=<span class="string">&quot;person-item__avatar-container&quot;</span>&gt;</span><br><span class="line">        &lt;img src=&#123; avatar_link &#125; alt=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;Link className=<span class="string">&quot;person-item__link&quot;</span> to=&#123;<span class="string">`/profile/<span class="subst">$&#123;user_id&#125;</span>`</span>&#125;&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;person-item__name&quot;</span>&gt;</span><br><span class="line">            &#123; first_name &#125; &#123; last_name &#125;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/Link&gt;</span><br><span class="line">    &lt;span className=<span class="string">&quot;person-item__country&quot;</span>&gt;</span><br><span class="line">        &#123; country.country_name &#125;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">    &lt;span className=<span class="string">&quot;person-item__city&quot;</span>&gt;</span><br><span class="line">        &#123; city &#125;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">    &lt;span className=<span class="string">&quot;person-item__website&quot;</span>&gt;</span><br><span class="line">        &lt;a href=&#123; website &#125;&gt;&#123; website &#125;&lt;/a&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>/////////////////////////////////////////////////////////////////////////////////////////</p>
<h3 id="Get-a-specific-user-for-profile-page-with-useQuery-hook"><a href="#Get-a-specific-user-for-profile-page-with-useQuery-hook" class="headerlink" title="Get a specific user for profile page with useQuery hook"></a>Get a specific user for profile page with useQuery hook</h3><p>This one is pretty similar to the previous one, except for the fact that we are fetching a single user, with full data, and we need to provide and argument for the resolver to identify user.</p>
<p>We will use the data to provide content to the <strong>ProfilePage</strong> component in the <strong>profile.page.tsx</strong> file, rendered on the <strong>“/profile/:user_id</strong> route.<br>This means that we will use the <strong>user_id</strong> parameter on the route to provide value for the variable used in the <strong>getUser</strong> GQL query.</p>
<p>Here are the properties that we will be retrieving with the query: </p>
<ol>
<li>user_id,</li>
<li>email,</li>
<li>first_name,</li>
<li>last_name,</li>
<li>city,</li>
<li>website,</li>
<li>age,</li>
<li>hobbies,</li>
<li>country_name,</li>
<li>avatar_link</li>
</ol>
<p>The steps:</p>
<ol>
<li>Create the query</li>
<li>Retrieve user id from the React Router’s <strong>useParams</strong> hook.</li>
<li>Get user data with <strong>useQuery</strong> hook, and pass it to a view component for render.</li>
<li>Use the view component to render user data.</li>
</ol>
<h3 id="Create-the-query"><a href="#Create-the-query" class="headerlink" title="Create the query"></a>Create the query</h3><p>The query lives in the <strong>profile.page.tsx</strong> file, and uses imported <strong>gql</strong> method, as usual.<br>It declares a <strong>$user_id</strong> variable of <strong>Int</strong> type, and then uses it as the value to the <strong>id</strong> argument in <strong>getUser</strong> query.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> USER_DETAILED_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetUserDetailed($user_id: Int!) &#123;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        getUser(id: $user_id) &#123;</span></span><br><span class="line"><span class="string">            user_id,</span></span><br><span class="line"><span class="string">            email,</span></span><br><span class="line"><span class="string">            first_name,</span></span><br><span class="line"><span class="string">            last_name,</span></span><br><span class="line"><span class="string">            city,</span></span><br><span class="line"><span class="string">            website,</span></span><br><span class="line"><span class="string">            age,</span></span><br><span class="line"><span class="string">            hobbies,</span></span><br><span class="line"><span class="string">            country &#123; country_name &#125;,</span></span><br><span class="line"><span class="string">            avatar_link</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Retrieve-user-id-from-the-React-Router’s-useParams-hook"><a href="#Retrieve-user-id-from-the-React-Router’s-useParams-hook" class="headerlink" title="Retrieve user id from the React Router’s useParams hook"></a>Retrieve user id from the React Router’s <strong>useParams</strong> hook</h3><p>React Router provides a hook to extract parameters from urls.<br>The method is called <strong>useParams</strong>, and we need to import it from “react-router-dom”, and then extract the user_id from it.</p>
<p>In this case, we just destructured it from the hook, and can now use it in the component.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useParams, Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ProfilePage: React.FC = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; user_id &#125; = useParams();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="Get-user-data-with-useQuery-hook-and-pass-it-to-the-view-component-for-render"><a href="#Get-user-data-with-useQuery-hook-and-pass-it-to-the-view-component-for-render" class="headerlink" title="Get user data with useQuery hook, and pass it to the view component for render."></a>Get user data with <strong>useQuery</strong> hook, and pass it to the view component for render.</h3><p>We already know how to do this. </p>
<p>We need to destructure the properties from the hook’s returned object.<br>We also need to provide the hook with two arguments: the actual query and the object that contains variables property.</p>
<p>Note that the user_id destructured from the url needs to be coerced into a number, because the query expects $user_id variable to be of Int type.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: userData, <span class="attr">loading</span>: userLoading, <span class="attr">error</span>: userError &#125; = useQuery(USER_DETAILED_QUERY</span><br><span class="line">    , &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">      user_id: +user_id</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Now when we have the needed user data, we can pass it as props to the <strong>UserProfileDetailed</strong> component, which will render it. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;div </span><br><span class="line">        className=<span class="string">&quot;people-section__profile-detailed-wrapper&quot;</span>&gt;</span><br><span class="line">        &#123;userError &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Unfortunately, there was an error fetching user. Please try again later. <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">        &#123;userLoading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">        &#123;userData &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">UserProfileDetailed</span> </span></span></span><br><span class="line"><span class="xml">            user=&#123;userData.getUser&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Use-the-view-component-to-render-user-data"><a href="#Use-the-view-component-to-render-user-data" class="headerlink" title="Use the view component to render user data"></a>Use the view component to render user data</h3><p>The view component in this case is <strong>UserProfileDetailed</strong>. </p>
<p>We need to type the incoming props, and then just render them in the component. </p>
<h5 id="Typing-props"><a href="#Typing-props" class="headerlink" title="Typing props"></a>Typing props</h5><p>Interface for the props is almost the same as the one in the <strong>UserBrief</strong> component, with this one having few more properties.</p>
<p>Later, when we add functionality to delete user, we will just add another type to the interface, to be able to type the <strong>delete</strong> mutation coming into the component as props. Simple.<br>Its typing, though, its a bit trickier. We will get there.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-profile-detailed.component.tsx</span></span><br><span class="line">...</span><br><span class="line">interface UserProfileDetailedProps &#123;</span><br><span class="line"></span><br><span class="line">    user: &#123;</span><br><span class="line">        age: number;</span><br><span class="line">        avatar_link: string;</span><br><span class="line">        city: string;</span><br><span class="line">        country: &#123;</span><br><span class="line">            country_name: string;</span><br><span class="line">        &#125;;</span><br><span class="line">        email: string;</span><br><span class="line">        first_name: string;</span><br><span class="line">        last_name: string;</span><br><span class="line">        hobbies: string[];</span><br><span class="line">        user_id: string;</span><br><span class="line">        website: string;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserProfileDetailed = <span class="function">(<span class="params">&#123; user &#125;: UserProfileDetailedProps</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; age, avatar_link, city, country, email, first_name, last_name, hobbies, user_id, website &#125; = user;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="The-render"><a href="#The-render" class="headerlink" title="The render"></a>The render</h5><p>The render is very simple. Just render that data coming in.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;div className=<span class="string">&quot;profile-section__avatar-container&quot;</span>&gt;</span><br><span class="line">        &lt;img src=&#123;avatar_link&#125; alt=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;profile-section__basic-info&quot;</span>&gt;</span><br><span class="line">        &lt;h2 className=<span class="string">&quot;basic-info__name&quot;</span>&gt;&#123;first_name&#125; &#123;last_name&#125;&lt;/h2&gt;</span><br><span class="line">        &lt;h3 className=<span class="string">&quot;basic-info__email&quot;</span>&gt;&#123;email&#125;&lt;/h3&gt;</span><br><span class="line">        &lt;Link className=<span class="string">&quot;basic-info__edit-profile&quot;</span> to=&#123;<span class="string">`/editprofile/<span class="subst">$&#123;user_id&#125;</span>`</span>&#125;&gt;Update my profile&lt;/Link&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;profile-section__details-info&quot;</span>&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__key&quot;</span>&gt;Country:&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__value country-value&quot;</span>&gt;&#123;country.country_name&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__key&quot;</span>&gt;City:&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__value city-value&quot;</span>&gt;&#123;city&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__key&quot;</span>&gt;Website:&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;details-info__value&quot;</span>&gt;</span><br><span class="line">            &lt;a href=&#123;website&#125;&gt;&#123;website&#125;&lt;/a&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div className=<span class="string">&quot;profile-section__additional-info&quot;</span>&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;additional-info__key&quot;</span>&gt;Age:&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;additional-info__value&quot;</span>&gt;&#123;age&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span className=<span class="string">&quot;additional-info__key&quot;</span>&gt;Hobbies:&lt;/span&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &#123; hobbies.map(<span class="function"><span class="params">hobby</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    &lt;li </span><br><span class="line">                        key=&#123;hobby&#125;</span><br><span class="line">                        className=<span class="string">&quot;additional-info__value&quot;</span>&gt;&#123;hobby&#125;&lt;/li&gt;</span><br><span class="line"></span><br><span class="line">                );</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>/////////////////////////////////////////////////////////////////////////////////////////</p>
<h3 id="Add-new-user-with-useMutation-hook"><a href="#Add-new-user-with-useMutation-hook" class="headerlink" title="Add new user with useMutation hook"></a>Add new user with useMutation hook</h3><p>Ok, so we reached the part with the mutation.<br>This is still pretty simple, I think, with the whole thing been added few more factors to the process in order to remain interesting.</p>
<p>We will have 2 components dealing with the addition of a new user. </p>
<ul>
<li><strong>AddProfilePage</strong>, which will house the logic</li>
<li><strong>AddEditProfileForm</strong>, which will house the actual form. This component will be shared between the AddProfilePage and EditProfilePage, as these two need almost the same input elements to perform their function. </li>
</ul>
<p>Also, we will need some kind of state where we will store the input data for the new user before it has been submited to the Apollo Server Express.</p>
<p>Finally, we will need to use <strong>useQuery</strong> hook, to query for all countries for the <strong>select</strong> HTML element in the form component.</p>
<p>So, ordered plan:</p>
<ol>
<li>Create state for user input</li>
<li>Query for all countries</li>
<li>Use <strong>useMutation</strong> hook to create mutation method</li>
<li>Use form component to connect form inputs to the new user state and mutation method, and to render all countries in the <strong>select</strong> element</li>
<li>Redirect the user to the full profile once the mutation is successful.</li>
</ol>
<h4 id="Create-state-for-user-input"><a href="#Create-state-for-user-input" class="headerlink" title="Create state for user input"></a>Create state for user input</h4><p>Since I wanted to checkout the <strong>useReducer</strong> hook provided by React, the state for new user is created as a reduced state. </p>
<p>I don’t know if it is better to use <strong>useReducer</strong> instead of <strong>useState</strong> (which is possible, too), but I just went with the reduced state for this one.<br>This did introduce few problems for me, as I spent lot of time figuring out how to type the actual reducer and the actions but it worked out in the end.</p>
<p>Here is just a general idea how reduced state works. </p>
<ol>
<li>We have initial state object</li>
<li>We have a reducer function that manipulates the state</li>
<li>We have actions that the reducer uses to decide which part of the state to manipulate, and how to do it. Actions can hold value that the reducer will use to manipulate the state. Actions are just objects with properties. Commonly, actions have a <strong>type</strong> and <strong>payload</strong> properties. <strong>Type</strong> indicates what type of action is the reducer going to perform on the state, while <strong>payload</strong> is used by the reducer to update the state.</li>
<li>We have a dispatch function that sends actions to reducers</li>
</ol>
<p>Here is the plan again, because this was a bit of a pain for me. We are working in the <strong>AddProfilePage</strong> component, btw, living in <strong>add-profile.page.tsx</strong>.</p>
<ol>
<li>Create initial state and its type</li>
<li>Create type for the action sent to the reducer</li>
<li>Create reducer function</li>
<li>Use <strong>useReducer</strong> to get state and dispatch function</li>
<li>Pass the state as props to the form component</li>
</ol>
<h5 id="Create-initial-state-and-its-type"><a href="#Create-initial-state-and-its-type" class="headerlink" title="Create initial state and its type"></a>Create initial state and its type</h5><p>We will create an object that will represent the original shape of our state.<br>Reduced state is usually an object, and not a simple, single value, from what I understand. <strong>useState</strong> hook can deal just fine with simple states. </p>
<p>We will also need to create an interface for this object. We will use this interface in the reducer function later. </p>
<p>Anyway, outside of the component define the initial state object.<br>The state reflects the arguments needed to create a new user with <strong>addUser</strong> mutation, which we prepared on the backend. We will go into this in more details when we get to the <strong>useMutation</strong> hook.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> initialFormState = &#123;</span><br><span class="line">    first_name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    last_name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    password: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    country: <span class="number">0</span>,</span><br><span class="line">    city: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    website: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    avatar_link: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    age: <span class="number">0</span>,</span><br><span class="line">    hobbies: [<span class="string">&quot;&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Next, we need to type the initial state object. Most of the properties are of string type, as shown below. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line">interface FormStateInterface &#123;</span><br><span class="line">    first_name: string;</span><br><span class="line">    last_name: string;</span><br><span class="line">    email: string;</span><br><span class="line">    password: string;</span><br><span class="line">    country: number;</span><br><span class="line">    city: string;</span><br><span class="line">    website: string;</span><br><span class="line">    avatar_link: string;</span><br><span class="line">    age: number;</span><br><span class="line">    hobbies: string[];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Create-type-for-the-action-sent-to-the-reducer"><a href="#Create-type-for-the-action-sent-to-the-reducer" class="headerlink" title="Create type for the action sent to the reducer"></a>Create type for the action sent to the reducer</h5><p>Now, we need to type action sent to the reducer. Note that we are not creation the actual action here. Actions are created in the actual component, when, for instance, handling input change, or a click on a button. </p>
<p>But, even if we don’t know what each of our actions is going to be, we know a general action shape.</p>
<p>Our action is going to be an object, holding 2 properties:</p>
<ul>
<li><strong>type</strong>, which will be of <strong>string</strong> type. Reducer will use this proeprty to know which part of the state it needs to manipulate</li>
<li><strong>payload</strong>, which will be of <strong>any</strong> type. This property holds actual values that will be used to update the state.</li>
</ul>
<p>Note that the <strong>any</strong> type in the <strong>payload</strong> property is probably incorrect. With this type, TS switches off its type checks for this variable, and we get usual JS behavior. Unfortunately, I was not able to figure out how to set different type, and make it all work.<br>This particular property can be either a string, an array of strings, or a number. But when typed in such way, TS complains of following errors:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Argument of type &#39;(state: AddEditProfile, action: Action) &#x3D;&gt; &#123; hobbies: string | number | string[]; user_id?: number | undefined; first_name: string; last_name: string; email: string; ... 5 more ...; age: number; &#125;&#39; is not assignable to parameter of type &#39;ReducerWithoutAction&lt;any&gt;&#39;.</span><br><span class="line"></span><br><span class="line">Overload 2 of 5, &#39;(reducer: (state: AddEditProfile, action: Action) &#x3D;&gt; &#123; hobbies: string | number | string[]; user_id?: number | undefined; first_name: string; last_name: string; email: string; ... 5 more ...; age: number; &#125;, initialState: never, initializer?: undefined): [...]&#39;, gave the following error.</span><br><span class="line"></span><br><span class="line">Argument of type &#39;AddEditProfile&#39; is not assignable to parameter of type &#39;never&#39;.  TS2769</span><br></pre></td></tr></table></figure>

<p>I will keep the <strong>any</strong> type for now, and hope to solve it when I learn more about TS.</p>
<h5 id="Create-reducer-function"><a href="#Create-reducer-function" class="headerlink" title="Create reducer function"></a>Create reducer function</h5><p>Next up is the function that will be updating the state - the reducer function.</p>
<p>Few things here:</p>
<ul>
<li>Reducer function always takes 2 arguments in: current state, and an action sent to the reducer</li>
<li>Then, the reducer checks the type property in the action object, and reacts to as per its own setup that we create. </li>
<li>Finally, it returns a new state</li>
</ul>
<p>Also, note that we type the reducer’s arguments - the state and action are both typed with interfaces we created earlier. </p>
<p>With all of that in mind, here is the reducer the for our state:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> formStateReducer = <span class="function">(<span class="params">state: FormStateInterface, action: ActionInterface</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;firstName&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">first_name</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;lastName&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">last_name</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;email&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">email</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;password&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">password</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;country&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">country</span>: +action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;city&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">city</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;website&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">website</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;avatar_link&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">avatar_link</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;age&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">age</span>: +action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;hobbies&quot;</span>: </span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">hobbies</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;editUser&quot;</span>: </span><br><span class="line">            <span class="keyword">return</span> &#123; ...action.payload &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So what is going on here?<br>As mentioned, the reducer accepts state and action arguments. This is handled by the <strong>useReducer</strong> hook and dispactch function, created later in the post.</p>
<p>Then, the reducer uses the <strong>switch</strong> block to check the action argument’s <strong>type</strong> property.<br>Depending in what is the value of the property, the reducer modifies the state.</p>
<p>In case that the reducer doesn’t recongize a type property, unmodified state is returned.</p>
<h5 id="Use-useReducer-to-get-state-and-dispatch-function"><a href="#Use-useReducer-to-get-state-and-dispatch-function" class="headerlink" title="Use useReducer to get state and dispatch function"></a>Use <strong>useReducer</strong> to get state and dispatch function</h5><p>Finally, we implement the <strong>useReducer</strong> hook to unite everything done so far. </p>
<p>First, we need to import the hook from “react”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Then, inside the component, we use it.<br><strong>useReducer</strong> takes in 2 arguments - a reducer and an initial state object.<br>It returns an array that we can destructure to get two items</p>
<ul>
<li>Actual state that we can use in the app. This state is the result of the reducer’s manipulation - it is the freshest state available.</li>
<li>Dispatch method, which we use to send actions to the reducer.</li>
</ul>
<p>Here is how it looks:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> [ formState, formStateDispatch ] = useReducer(formStateReducer, initialFormState);</span><br></pre></td></tr></table></figure>

<h5 id="Pass-the-state-as-props-to-the-form-component"><a href="#Pass-the-state-as-props-to-the-form-component" class="headerlink" title="Pass the state as props to the form component"></a>Pass the state as props to the form component</h5><p>And, one more thing - we just pass the state as props to the component that will house the form for adding a new user.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">&lt;div className=<span class="string">&quot;add-edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">    &lt;AddEditProfileForm </span><br><span class="line">        formState=&#123;formState&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Query-for-all-countries"><a href="#Query-for-all-countries" class="headerlink" title="Query for all countries"></a>Query for all countries</h4><p>We still work inside the <strong>add-profile.page.tsx</strong> file.</p>
<p>We will now put the state business on pause for a bit, and move to getting the list of all coutries in our database.<br>We need this list to provide country options when creating a new user.</p>
<p>We need both country_id and country_name properties for each country. We will use the id as the value on <strong>option</strong> element, and we will use the name as the string rendered by the element. </p>
<p>Now, we don’t need to work much here. We already have this pretty much prepared from when we tested the <strong>useQuery</strong> hook in the <strong>App</strong> component. So we will just copy it from there, together with the hook’s import. </p>
<h5 id="The-query-and-the-hook"><a href="#The-query-and-the-hook" class="headerlink" title="The query and the hook"></a>The query and the hook</h5><p>Here are the query and the <strong>useQuery</strong> hook:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useQuery, gql &#125; <span class="keyword">from</span> <span class="string">&quot;@apollo/client&quot;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> GET_COUNTRIES_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetCountries &#123;</span></span><br><span class="line"><span class="string">        getCountries &#123;</span></span><br><span class="line"><span class="string">            country_id,</span></span><br><span class="line"><span class="string">            country_name</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> AddProfilePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: countriesData, <span class="attr">loading</span>: countriesLoading, <span class="attr">error</span>: countriesError &#125; = useQuery(GET_COUNTRIES_QUERY);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="Pass-countries-as-props-to-the-form-component"><a href="#Pass-countries-as-props-to-the-form-component" class="headerlink" title="Pass countries as props to the form component"></a>Pass countries as props to the form component</h5><p>We also need to pass the countries data to the form component.<br>Note that we are conditionally passing the countries prop with the <strong>?</strong> sign after <strong>countriesData</strong> variable.<br>This is a new JS syntax, from what I understand. If we didn’t use the question mark, the expression would result in an error, because <strong>countriesData</strong> is undefined when the component mounts, and it has no properties on it.<br>If we use the question mark, the expression will only continue checking for properties after the question mark in case the <strong>countriesData</strong> is a truthy value.<br>At least, that’s the way I understood it.</p>
<p>Also, we are adding an additional object to the countries array. This object has an id of 0, and an empty country_name property. We will use it to set the initial, empty option on the <strong>select</strong> element inside the form. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">&lt;div className=<span class="string">&quot;add-edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">    &lt;AddEditProfileForm </span><br><span class="line">        countries=&#123;countriesData?.getCountries.concat(&#123; <span class="attr">country_id</span>: <span class="number">0</span>, <span class="attr">country_name</span>: <span class="string">&quot;&quot;</span> &#125;)&#125;</span><br><span class="line">        formState=&#123;formState&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Use-useMutation-hook-to-create-mutation-method"><a href="#Use-useMutation-hook-to-create-mutation-method" class="headerlink" title="Use useMutation hook to create mutation method"></a>Use <strong>useMutation</strong> hook to create mutation method</h4><p>Now, we are creating a mutation to add a new user.<br>This means that we will have a lot of arguments passed to the mutation.<br>It also means that we will have a lot of variables to pass into the query.<br>Also, don’t forget that the <strong>useMutation</strong> hook creates a mutation method that we have to call to do the actual mutation.<br>Once the mutation is complete, we want to redirect the user to the actual profile page. We will use React Router’s <strong>Redirect</strong> component to do this. </p>
<p>So here is the plan:</p>
<ol>
<li>Create the mutation query</li>
<li>Import and set up the React Router’s <strong>Redirect</strong> component</li>
<li>Implement the <strong>useMutation</strong> hook and make sure that variables are ready</li>
<li>Use props to pass the mutation method to the form component</li>
</ol>
<h5 id="Create-the-mutation-query"><a href="#Create-the-mutation-query" class="headerlink" title="Create the mutation query"></a>Create the mutation query</h5><p>###############################################</p>
<p>Important thing here is that we have lot of variables to include in our query, and they need to match the arguments in the <strong>typeDefs</strong> in the Apollo Server Express instance on the backend.<br>Also, we will return only 1 property back from the mutation - the user_id. We will use it to create a link to the user profile, and redirect the user there once the mutation is complete.</p>
<p>Again, we are working in the <strong>add-profile.page.tsx</strong> file. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> NEW_USER_MUTATION = gql<span class="string">`</span></span><br><span class="line"><span class="string">    mutation NewUser(</span></span><br><span class="line"><span class="string">        $email: String!</span></span><br><span class="line"><span class="string">        $password: String!</span></span><br><span class="line"><span class="string">        $first_name: String!</span></span><br><span class="line"><span class="string">        $last_name: String!</span></span><br><span class="line"><span class="string">        $country: Int!</span></span><br><span class="line"><span class="string">        $city: String!</span></span><br><span class="line"><span class="string">        $website: String!</span></span><br><span class="line"><span class="string">        $age: Int!</span></span><br><span class="line"><span class="string">        $hobbies: [String]!</span></span><br><span class="line"><span class="string">        $avatar_link: String!</span></span><br><span class="line"><span class="string">    )&#123;</span></span><br><span class="line"><span class="string">        newUser(</span></span><br><span class="line"><span class="string">            email: $email</span></span><br><span class="line"><span class="string">            password: $password</span></span><br><span class="line"><span class="string">            first_name: $first_name</span></span><br><span class="line"><span class="string">            last_name: $last_name</span></span><br><span class="line"><span class="string">            country: $country </span></span><br><span class="line"><span class="string">            city: $city</span></span><br><span class="line"><span class="string">            website: $website</span></span><br><span class="line"><span class="string">            age: $age</span></span><br><span class="line"><span class="string">            hobbies: $hobbies</span></span><br><span class="line"><span class="string">            avatar_link: $avatar_link</span></span><br><span class="line"><span class="string">        ) &#123;</span></span><br><span class="line"><span class="string">            user_id</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Import-and-set-up-the-React-Router’s-Redirect-component"><a href="#Import-and-set-up-the-React-Router’s-Redirect-component" class="headerlink" title="Import and set up the React Router’s Redirect component"></a>Import and set up the React Router’s <strong>Redirect</strong> component</h5><p>Redirect component works in a way that, when returned by a React component, it redirects the client to any url specified in the Redirect’s <strong>to</strong> attribute. </p>
<p>However, we only want to redirect the user once our mutation is done, so we will conditionally render the Redirect component - if we complete the mutation, we return it. </p>
<p>We will also use the React’s useState hook to hold a number value. If the mutation has not been completed, the state’s value will be undefined, and if the mutation has completed, the state’s calue will be the <strong>user_id</strong>, returned from the mutation. </p>
<p>The Redirect component will conditionally rendered based on this state’s value, and will use the state’s value to assemble a link to the new user’s profile, too.</p>
<p>Let’s see what I mean.</p>
<p>The <strong>Redirect</strong> component’s import: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>The <strong>useState</strong> hook import and implementation:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> AddEditProfilePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> [ pathToNewUser, setPathToNewUser ] = useState&lt;number&gt; ();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Implementation of <strong>Redirect</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span>(</span><br><span class="line">...</span><br><span class="line">    &#123;pathToNewUser &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;</span>`/<span class="attr">profile</span>/$&#123;<span class="attr">pathToNewUser</span>&#125;`&#125; /&gt;</span></span>&#125;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="Implement-the-useMutation-hook-and-make-sure-that-variables-are-ready"><a href="#Implement-the-useMutation-hook-and-make-sure-that-variables-are-ready" class="headerlink" title="Implement the useMutation hook and make sure that variables are ready"></a>Implement the <strong>useMutation</strong> hook and make sure that variables are ready</h5><p>Next up is to implement the <strong>useMutation</strong> hook.</p>
<p>First, we need to import the hook from “react”:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useMutation &#125; <span class="keyword">from</span> <span class="string">&quot;@apollo/client&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>Then, we implement it inside the component.<br>We will pass 2 arguments to the hook - the actual query, and an object containing variables and the <strong>onCompleted</strong> property. </p>
<p>We will set the variables by destructuring the form state inside the <strong>variables</strong> object. This will make the whole thing a bit quicker, even if it is less readable.</p>
<p>We also need the onCompleted property to set the value of <strong>pathToNewUser</strong> once the mutation has completed. </p>
<p>On the other side, we will destructure (or spread? I don’t know what is the term for array) the hook’s return into a <strong>createUser method</strong>, and again destructure the <strong>data</strong> object from the second item in returned array.</p>
<p>Here it is: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> [ createUser, &#123; data &#125; ] = useMutation(NEW_USER_MUTATION, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        ...formState</span><br><span class="line">    &#125;,</span><br><span class="line">    onCompleted: <span class="function">(<span class="params">&#123;newUser&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;mutation is complete: &quot;</span>, newUser);</span><br><span class="line">        setPathToNewUser(newUser.user_id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Use-props-to-pass-the-mutation-method-to-the-form-component"><a href="#Use-props-to-pass-the-mutation-method-to-the-form-component" class="headerlink" title="Use props to pass the mutation method to the form component"></a>Use props to pass the mutation method to the form component</h5><p>Finally, we need to pass the mutation method to the form component, because a button in its form is the one that actually triggers the mutation when it is clicked.</p>
<p>Again, I had few problems with TS types here, and was only able to get around it, I think. We will get to it a bit later. </p>
<p>Anyway, we can pass the method to the form component in the way it is - as a prop. Or, we can put inside a handler function, and pass the handler instead.</p>
<p>I chose to pass the handler, primarily because I wanted to do some logging when the mutation query is sent, but also because of the annoying TS typing thing.</p>
<p>Here is the handler function that wraps the mutation method. Note that we need to type the argument of handler. The argument is the React’ form event.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> handleSubmit = <span class="keyword">async</span> (e:React.FormEvent&lt;HTMLFormElement&gt;) =&gt; &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    createUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And here is us passing it as a prop to the form component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;div className=<span class="string">&quot;add-edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">        &lt;AddEditProfileForm </span><br><span class="line">            countries=&#123; countriesData?.getCountries.concat(&#123; <span class="attr">country_id</span>: <span class="number">0</span>, <span class="attr">country_name</span>: <span class="string">&quot;&quot;</span>&#125;) &#125;</span><br><span class="line">            handleSubmit=&#123;handleSubmit&#125;</span><br><span class="line">            formState=&#123;formState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Use-form-component-to-connect-form-inputs-to-the-new-user-state-and-mutation-method-and-to-render-all-countries-in-the-select-element"><a href="#Use-form-component-to-connect-form-inputs-to-the-new-user-state-and-mutation-method-and-to-render-all-countries-in-the-select-element" class="headerlink" title="Use form component to connect form inputs to the new user state and mutation method, and to render all countries in the select element"></a>Use form component to connect form inputs to the new user state and mutation method, and to render all countries in the <strong>select</strong> element</h4><p>The form component is the one that renders the form for adding a new profile. It accepts props such as state properties, as well as change and submit handlers, and the countries array, so the user can choose a country. </p>
<p>We will not go into creation of the actual component here. We will only make sure that the neccessary props are passed to it, and that handlers do their job.</p>
<p>The plan:</p>
<ol>
<li>Create change handler in the <strong>AddProfilePage</strong> component, and pass it to the <strong>AddEditProfileForm</strong> component</li>
<li>Create interface for props coming into <strong>AddEditProfileForm</strong></li>
<li>Use <strong>AddEditProfileForm</strong> component to render form and change and submit data.</li>
</ol>
<h5 id="Create-change-handler-in-the-AddProfilePage-component-and-pass-it-to-the-AddEditProfileForm-component"><a href="#Create-change-handler-in-the-AddProfilePage-component-and-pass-it-to-the-AddEditProfileForm-component" class="headerlink" title="Create change handler in the AddProfilePage component, and pass it to the AddEditProfileForm component"></a>Create change handler in the <strong>AddProfilePage</strong> component, and pass it to the <strong>AddEditProfileForm</strong> component</h5><p>We are creating the <strong>handleChange</strong> function in the <strong>AddProfilePage</strong>.<br>This function will be using the dispatch function destructured from the <strong>useReducer</strong> hook to send an action to the reducer. The action will include type and payload properties.<br>It will also hold some logic, in order to shape the <strong>action</strong> before it reaches the reducer.</p>
<p>So here is the <strong>handleChange</strong> function, together with the TS type required for the handler’s argument:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line">type HandleChangeType = React.ChangeEvent&lt;HTMLInputElement&gt; | React.ChangeEvent&lt;HTMLTextAreaElement&gt; | React.ChangeEvent&lt;HTMLSelectElement&gt;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> AddEditProfilePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: HandleChangeType</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; name, value &#125; = e.target;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> payloadValue: string | string[] = name === <span class="string">&quot;hobbies&quot;</span>? value.split(<span class="string">&quot;,&quot;</span>).map(<span class="function"><span class="params">hobby</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> hobby.trim();</span><br><span class="line">        &#125;): value;</span><br><span class="line"></span><br><span class="line">        formStateDispatch(&#123; <span class="attr">type</span>: name, <span class="attr">payload</span>: payloadValue &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>A bit of explanation: </p>
<ol>
<li>handleChange accepts an argument of <strong>event</strong>, for which we created TS type. The type is React’s ChangeEvent type - either for regular input element, textarea element, or select element. I am not sure if this is correct what I just wrote.</li>
<li>Inside the handler, we destructure name and value from the element that triggered the event. </li>
<li>Then, we created the payloadValue to be included in the action. If we are changing the <strong>hobbies</strong> input, we are making it an array of strings to be inluded in the state. In all other cases, we just assign the input value to the payload. </li>
<li>Finally, we use the dispatch function to send the action to the reducer. We set the type to have value of the <strong>name</strong> attribute on the input, and include payloadValue as the <strong>payload</strong> property. </li>
</ol>
<p>Now we just have to pass the handler to the <strong>AddEditProfileForm</strong> component. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;div className=<span class="string">&quot;add-edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">        &lt;AddEditProfileForm </span><br><span class="line">            countries=&#123;countriesData?.getCountries.concat(&#123; <span class="attr">country_id</span>: <span class="number">0</span>, <span class="attr">country_name</span>: <span class="string">&quot;&quot;</span>&#125;)&#125;</span><br><span class="line">            handleChange=&#123; handleChange &#125;</span><br><span class="line">            handleSubmit=&#123;handleSubmit&#125;</span><br><span class="line">            formState=&#123;formState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="Create-interface-for-props-coming-into-AddEditProfileForm"><a href="#Create-interface-for-props-coming-into-AddEditProfileForm" class="headerlink" title="Create interface for props coming into AddEditProfileForm"></a>Create interface for props coming into <strong>AddEditProfileForm</strong></h5><p>We are now working in the <strong>AddEditProfileForm</strong> component. This component is used by both <strong>AddProfilePage</strong> and <strong>EditProfilePage</strong>.<br>Because of this, we have two cases of optional properties included in the interface.</p>
<p>Default behavior of properties included in interface is that they are all mandatory. This means that if a property is included in the interface, the object that uses this interface for its type has to have that property.<br>We can, however, specify that certain properties are optional by using a question mark next to the property name. This way a property does not need to exist in the object.</p>
<p>In case of React and our component, we will have <strong>user_id</strong> and <strong>password</strong> propeties be optional.<br>This is because <strong>user_id</strong> is not used when we create a new user, and such property does not exist in the state of <strong>AddProfilePage</strong>. On the other hand, <strong>password</strong> does will not exist in the state of <strong>EditProfilePage</strong>, because we will not have an option to edit password when editing a user. It is just the way I decided to have the edit functionality. </p>
<p>All other properties are same for both adding and editing users.</p>
<p>Here is the interface, defined and in use with props:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-edit-profile-form.component.tsx</span></span><br><span class="line">...</span><br><span class="line">interface AddEditProfileFormProps &#123;</span><br><span class="line">    countries: &#123; <span class="attr">country_id</span>: string, <span class="attr">country_name</span>: string &#125;[];</span><br><span class="line">    handleChange: <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt; | React.ChangeEvent&lt;HTMLTextAreaElement&gt; | React.ChangeEvent&lt;HTMLSelectElement&gt;</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">    handleSubmit: <span class="function">(<span class="params">e: React.FormEvent&lt;HTMLFormElement&gt;</span>) =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line">    formState: &#123;</span><br><span class="line">        user_id?: number;</span><br><span class="line">        first_name: string;</span><br><span class="line">        last_name: string;</span><br><span class="line">        email: string;</span><br><span class="line">        password?: string;</span><br><span class="line">        country: number;</span><br><span class="line">        city: string;</span><br><span class="line">        website: string;</span><br><span class="line">        avatar_link: string;</span><br><span class="line">        age: number;</span><br><span class="line">        hobbies: string[];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AddEditProfileForm = <span class="function">(<span class="params">&#123; countries, handleChange, handleSubmit, formState &#125;: AddEditProfileFormProps</span>) =&gt;</span> &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="Use-AddEditProfileForm-component-to-render-form-and-change-and-submit-data"><a href="#Use-AddEditProfileForm-component-to-render-form-and-change-and-submit-data" class="headerlink" title="Use AddEditProfileForm component to render form and change and submit data."></a>Use <strong>AddEditProfileForm</strong> component to render form and change and submit data.</h5><p>This part is simple, classic React. We just use the props to render data or enable changing inputs and updating state.</p>
<p>Few things though:</p>
<ol>
<li>We render <strong>password</strong> label and input only if the <strong>password</strong> prop is truthy - when we are actually creating a new user.</li>
<li>Initial value of <strong>select</strong> element is 0, as taken from the state for new user. Remember that we also concatanated a new object into countries prop, to add it id of 0, and name of “”. In the code for <strong>option</strong>, we also specify that we disable and hide option entry for that particular object in the array, so it becomes unclickable and not visible. </li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add-edit-profile-form.component.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">&lt;div</span><br><span class="line">    onSubmit=&#123;handleSubmit&#125;</span><br><span class="line">    className=<span class="string">&quot;add-edit-profile-section__add-edit-profile-form&quot;</span>&gt;</span><br><span class="line">    &lt;div className=<span class="string">&quot;add-edit-profile-form__basic-info&quot;</span>&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;firstName&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;First Name: &#123;<span class="keyword">typeof</span> user_id&#125; &lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;firstName&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;firstName&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;first_name&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;lastName&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Last Name&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            type=<span class="string">&quot;text&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;lastName&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;lastName&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;last_name&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;email&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Email&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">                type=<span class="string">&quot;email&quot;</span> </span><br><span class="line">                id=<span class="string">&quot;email&quot;</span> </span><br><span class="line">                name=<span class="string">&quot;email&quot;</span> </span><br><span class="line">                className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">                value=&#123;email&#125;</span><br><span class="line">                onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &#123; password !== <span class="literal">undefined</span> &amp;&amp; (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">            &lt;label htmlFor=<span class="string">&quot;password&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Password&lt;/label&gt;</span><br><span class="line">            &lt;input </span><br><span class="line">                type=<span class="string">&quot;password&quot;</span> </span><br><span class="line">                id=<span class="string">&quot;password&quot;</span> </span><br><span class="line">                name=<span class="string">&quot;password&quot;</span> </span><br><span class="line">                className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">                value=&#123;password&#125;</span><br><span class="line">                onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;/&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;add-edit-profile-form__personal-info&quot;</span>&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;country&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Country&lt;/label&gt;</span><br><span class="line">        &lt;select </span><br><span class="line">            value=&#123;country&#125;</span><br><span class="line">            name=<span class="string">&quot;country&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;country&quot;</span></span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            onChange=&#123;handleChange&#125;&gt;</span><br><span class="line">            &#123; countries &amp;&amp; countries.map(<span class="function">(<span class="params">&#123; country_id, country_name &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    &lt;option </span><br><span class="line">                        key=&#123;country_id&#125;</span><br><span class="line">                        value=&#123;country_id&#125;</span><br><span class="line">                        disabled=&#123;country_name === <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">                        hidden=&#123;country_name === <span class="string">&quot;&quot;</span>&#125;&gt;</span><br><span class="line">                            &#123;country_name&#125;</span><br><span class="line">                    &lt;/option&gt;</span><br><span class="line">                );</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">        &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;city&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;City&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            type=<span class="string">&quot;text&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;city&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;city&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;city&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;website&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Website&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            type=<span class="string">&quot;text&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;website&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;website&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;website&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;avatar_link&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Profile Picture&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            type=<span class="string">&quot;text&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;avatar_link&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;avatar_link&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;avatar_link&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;age&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Age&lt;/label&gt;</span><br><span class="line">        &lt;input </span><br><span class="line">            min=<span class="string">&quot;18&quot;</span> </span><br><span class="line">            type=<span class="string">&quot;number&quot;</span> </span><br><span class="line">            id=<span class="string">&quot;age&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;age&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            value=&#123;age&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;/&gt;</span><br><span class="line">        &lt;label htmlFor=<span class="string">&quot;hobbies&quot;</span> className=<span class="string">&quot;add-edit-profile-form__label&quot;</span>&gt;Interests&lt;/label&gt;</span><br><span class="line">        &lt;textarea </span><br><span class="line">            id=<span class="string">&quot;hobbies&quot;</span> </span><br><span class="line">            name=<span class="string">&quot;hobbies&quot;</span> </span><br><span class="line">            className=<span class="string">&quot;add-edit-profile-form__input&quot;</span></span><br><span class="line">            placeholder=<span class="string">&quot;Please separate your interests with commas&quot;</span> </span><br><span class="line">            value=&#123;hobbies.join(<span class="string">&quot;, &quot;</span>)&#125;</span><br><span class="line">            onChange=&#123;handleChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button type=<span class="string">&quot;submit&quot;</span> className=<span class="string">&quot;register-form__add-edit-submit-button&quot;</span>&gt;Submit&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">...</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Mutation for a new user is now done. Our change handler updates the state for new user, and clicking the submit button in the form triggers the submit handler, which calls mutation method provided to use by the <strong>useMutation</strong> hook. A new user is created, and the client is redirected to its profile page.</p>
<p>/////////////////////////////////////////////////////////////////////////////////////</p>
<h3 id="Edit-user-with-useMutation-hook"><a href="#Edit-user-with-useMutation-hook" class="headerlink" title="Edit user with useMutation hook"></a>Edit user with useMutation hook</h3><p>This part is pretty similar to the previous one. In fact, it is much quicker and easier because we can use lot of the previous’ part code.</p>
<ul>
<li>We will reuse the <strong>AddEditFormComponent</strong></li>
<li>Props that we will be passing to to the component from <strong>EditProfilePage</strong> are already typed in the <strong>AddEditFormComponent</strong></li>
</ul>
<p>There are few differences, however. We need to fetch data for the user that we want to edit, and then put that data into correcsponding input fields in the form component.<br>Same as before, we need the list of countries, but we don’t want to fetch them with the separate query. Instead, we created a GQL type on the backend that returns the user for edit, as well as all the countries. This way we will get all necessary data in one go. </p>
<p>Here are the type and the query, so you don’t have to go back and search for it in previous posts.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// type-defs in the backend</span></span><br><span class="line"><span class="keyword">import</span> &#123; gql &#125; <span class="keyword">from</span> <span class="string">&quot;apollo-server-express&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> gql<span class="string">`</span></span><br><span class="line"><span class="string">    type Query &#123;</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">        getUserForEdit(id: Int): UserForEdit</span></span><br><span class="line"><span class="string">        ...</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">    type UserForEdit &#123;</span></span><br><span class="line"><span class="string">        user: User</span></span><br><span class="line"><span class="string">        countries: [Country]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br></pre></td></tr></table></figure>

<p>Quick summary of data flow when editing a profile:<br><strong>useQuery</strong> hook queries a user for edit data and, when done, assigns user data to the reduced state that exists in the component. The state itself is passed as props to the form component, togher with the countries array coming from the same GQL query. Change and submit handlers are also passed to the form component. When submit button is clicked, the submit handler calls mutate function returned by the <strong>useMutation</strong> hook. The hooks itself again uses the whole state as variables for the mutation query.</p>
<p>Plan:</p>
<ol>
<li>Create query for to get user for edit, and mutation query for editing user</li>
<li>Use React Router to get id of the user for edit</li>
<li>Create reduced state for edited user and useState for <strong>Redirect</strong> component. </li>
<li>Implement <strong>useQuery</strong> and <strong>useMutation</strong> hooks</li>
<li>Create change and submit handlers and pass them to the <strong>AddEditProfileForm</strong> component</li>
<li>Use <strong>Redirect</strong> component to navigate to edited profile when mutation is complete</li>
<li>We don’t need to do anything in the form comonent bc all is ready from the previous mutation.</li>
</ol>
<h4 id="Create-query-for-to-get-user-for-edit-and-mutation-query-for-editing-user"><a href="#Create-query-for-to-get-user-for-edit-and-mutation-query-for-editing-user" class="headerlink" title="Create query for to get user for edit, and mutation query for editing user"></a>Create query for to get user for edit, and mutation query for editing user</h4><p>For the <strong>getUserForEdit query</strong>, we will require both the user, with its full properties, and all countries, with both the id and name.<br>The only argument the query needs is the user id.</p>
<p>Here is the query: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GET_USER_FOR_EDIT_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    query GetUserForEdit($user_id: Int!) &#123;</span></span><br><span class="line"><span class="string">        getUserForEdit(id: $user_id) &#123;</span></span><br><span class="line"><span class="string">            user &#123;</span></span><br><span class="line"><span class="string">                user_id,</span></span><br><span class="line"><span class="string">                email,</span></span><br><span class="line"><span class="string">                first_name,</span></span><br><span class="line"><span class="string">                last_name,</span></span><br><span class="line"><span class="string">                city,</span></span><br><span class="line"><span class="string">                website,</span></span><br><span class="line"><span class="string">                age,</span></span><br><span class="line"><span class="string">                hobbies,</span></span><br><span class="line"><span class="string">                # country,</span></span><br><span class="line"><span class="string">                country &#123; country_id &#125;,</span></span><br><span class="line"><span class="string">                avatar_link</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            countries &#123;</span></span><br><span class="line"><span class="string">                country_id,</span></span><br><span class="line"><span class="string">                country_name</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<p>In case of the mutation query, we need to provide arguments for all properties that the user has.<br>I tried to figure out a way to include only edited properties, but it seems that this would require lot of code on both frontend and backend, so decided to stick with all of it.<br>We will require just the <strong>user_id</strong> property back from the mutation, and we will use the property to navigate to the user profile page.</p>
<p>Here is the mutation query: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> EDIT_USER_MUTATION = gql<span class="string">`</span></span><br><span class="line"><span class="string">    mutation EditUser(</span></span><br><span class="line"><span class="string">        $user_id: Int!</span></span><br><span class="line"><span class="string">        $email: String!</span></span><br><span class="line"><span class="string">        $first_name: String!</span></span><br><span class="line"><span class="string">        $last_name: String!</span></span><br><span class="line"><span class="string">        $country: Int!</span></span><br><span class="line"><span class="string">        $city: String!</span></span><br><span class="line"><span class="string">        $website: String!</span></span><br><span class="line"><span class="string">        $age: Int!</span></span><br><span class="line"><span class="string">        $hobbies: [String]!</span></span><br><span class="line"><span class="string">        $avatar_link: String!</span></span><br><span class="line"><span class="string">    )&#123;</span></span><br><span class="line"><span class="string">        editUser(</span></span><br><span class="line"><span class="string">            user_id: $user_id</span></span><br><span class="line"><span class="string">            email: $email</span></span><br><span class="line"><span class="string">            first_name: $first_name</span></span><br><span class="line"><span class="string">            last_name: $last_name</span></span><br><span class="line"><span class="string">            country: $country </span></span><br><span class="line"><span class="string">            city: $city</span></span><br><span class="line"><span class="string">            website: $website</span></span><br><span class="line"><span class="string">            age: $age</span></span><br><span class="line"><span class="string">            hobbies: $hobbies</span></span><br><span class="line"><span class="string">            avatar_link: $avatar_link</span></span><br><span class="line"><span class="string">        ) &#123;</span></span><br><span class="line"><span class="string">            user_id</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Use-React-Router-to-get-id-of-the-user-for-edit"><a href="#Use-React-Router-to-get-id-of-the-user-for-edit" class="headerlink" title="Use React Router to get id of the user for edit"></a>Use React Router to get id of the user for edit</h4><p>We have already done this before when we fetched user data for the profile page.</p>
<p>Here is the import of the <strong>useParams</strong> hook, as well as destructuring of its <strong>user_id</strong> parameter. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; useParams &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> EditProfilePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; user_id &#125; = useParams();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Create-reduced-state-for-edited-user"><a href="#Create-reduced-state-for-edited-user" class="headerlink" title="Create reduced state for edited user"></a>Create reduced state for edited user</h4><p>We have experience with this part as well. The reduced state parts are almost the same as in the <strong>AddProfilePage</strong> component. </p>
<p>Few differences are: </p>
<ol>
<li>Interface for state and initial state both miss the <strong>password</strong> properties</li>
<li>Instead, they have the <strong>user_id</strong> properties.</li>
<li>Switch block in the reducer also misses the case for “password” action type. </li>
<li>The switch block in the reducer has 2 other cases: case for <strong>userId</strong>, and case for completely replacing the state. We will use this option to assign queried user data to the state when the <strong>useQuery</strong> hook completes. </li>
</ol>
<p>So let’s do it.</p>
<p>The intial state and its interface, as well as the interface for <strong>action</strong>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialFormState = &#123;</span><br><span class="line">    user_id: <span class="number">0</span>,</span><br><span class="line">    first_name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    last_name: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    email: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    country: <span class="number">0</span>,</span><br><span class="line">    city: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    website: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    avatar_link: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    age: <span class="number">0</span>,</span><br><span class="line">    hobbies: [<span class="string">&quot;&quot;</span>],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line">interface FormStateInterface &#123;</span><br><span class="line">    user_id: number;</span><br><span class="line">    first_name: string;</span><br><span class="line">    last_name: string;</span><br><span class="line">    email: string;</span><br><span class="line">    country: number;</span><br><span class="line">    city: string;</span><br><span class="line">    website: string;</span><br><span class="line">    avatar_link: string;</span><br><span class="line">    age: number;</span><br><span class="line">    hobbies: string[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface ActionInterface &#123;</span><br><span class="line">    type: string;</span><br><span class="line">    payload: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The reducer, with its arguments typed:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> formStateReducer = <span class="function">(<span class="params">state: FormStateInterface, action: ActionInterface</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;userId&quot;</span>: </span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">user_id</span>: +action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;firstName&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">first_name</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;lastName&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">last_name</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;email&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">email</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;country&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">country</span>: +action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;city&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">city</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;website&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">website</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;avatar_link&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">avatar_link</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;age&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">age</span>: +action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;hobbies&quot;</span>: </span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, <span class="attr">hobbies</span>: action.payload &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;userForEdit&quot;</span>: </span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, ...action.payload &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Finally, implementation of the <strong>useReducer</strong> hook:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> EditProfilePage = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [ formState, formStateDispatch ] = useReducer(formStateReducer, initialFormState);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>And now, we will just pass the state to the form component. Props are already typed on the form component, with <strong>password</strong> and <strong>user_id</strong> being optional</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">        &lt;AddEditProfileForm    </span><br><span class="line">            formState=&#123;formState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Last thing, we will create a simple state with <strong>useState</strong> hook, to hold <strong>user_id</strong> when edit user mutation completes. I know we already know the user’s id, but I still prefer to do it this way. It makes code more readable and consistent with the code in <strong>AddProfilePage</strong>. We could also have this state just return true or false, and set the Redirect’s <strong>to</strong> attribute to hold the <strong>useParams</strong> user_id parameter. It’s a choice, really. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> [ pathToEditedUser, setPathToEditedUser ] = useState&lt;number&gt; ();</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Implement-useQuery-and-useMutation-hooks"><a href="#Implement-useQuery-and-useMutation-hooks" class="headerlink" title="Implement useQuery and useMutation hooks"></a>Implement <strong>useQuery</strong> and <strong>useMutation</strong> hooks</h4><p>As already established wwhen we made the query, with <strong>useQuery</strong> we will be fetching the actual user, as well as all the country that exist in the database.<br>We have the <strong>user_id</strong> paramater from the React Router’s <strong>useParams</strong> hook, which we will use as an argument to the query. Once the data is fetched, we will assign the user data to the <strong>formState</strong> that we created. Then, its properties can be used as values for edit inputs in the form component.</p>
<p>So here is the hook implementation. Note that we are using the <strong>useReducer’s</strong> dispatch method to replace the whole state with what we received from the Apollo Server Express. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: userForEditData, <span class="attr">loading</span>: userForEditLoading, <span class="attr">error</span>: userForEditError &#125; = useQuery(GET_USER_FOR_EDIT_QUERY, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        user_id: +user_id,</span><br><span class="line">    &#125;,</span><br><span class="line">    onCompleted: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; __typename, ...restOfUser &#125; = data.getUserForEdit.user;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> userForState = &#123;</span><br><span class="line">            ...restOfUser,</span><br><span class="line">            country: +restOfUser.country.country_id,</span><br><span class="line">            user_id: +restOfUser.user_id,</span><br><span class="line">        &#125;</span><br><span class="line">        formStateDispatch(&#123;</span><br><span class="line">            type: <span class="string">&quot;userForEdit&quot;</span>,</span><br><span class="line">            payload: userForState,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Since the query returned the countries data as well, we can now pass that data to the form component.<br>This time we don’t have to concatanate an additional object into the array, becuase the <strong>select</strong> element will get it’s value from the <strong>formState</strong>, and it’s value will be a country that the user is from. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">        &lt;AddEditProfileForm    </span><br><span class="line">            countries=&#123;userForEditData?.getUserForEdit.countries&#125;</span><br><span class="line">            formState=&#123;formState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>As far as the <strong>useMutation</strong> hook goes, its not much different from what we did with the <strong>AddProfilePage</strong> component. We will use the mutation query that we prepared, and will include the whole <strong>formState</strong> into the hook’s variables object. Once the mutation completes, it will return the user id, and assign it to the <strong>pathToEditedUser</strong> state. This, in turn, will trigger rendering of the <strong>Redirect</strong> component, and the client will be redirected to the user’s profile page. </p>
<p>Here is the whole thing:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> [ editUser, &#123; data &#125; ] = useMutation(EDIT_USER_MUTATION, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        ...formState</span><br><span class="line">    &#125;,</span><br><span class="line">    onCompleted: <span class="function">(<span class="params">&#123; editUser &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">        setPathToEditedUser(editUser.user_id);</span><br><span class="line">    &#125;,</span><br><span class="line">    onError: <span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Create-change-and-submit-handlers-and-pass-them-to-the-AddEditProfileForm-component"><a href="#Create-change-and-submit-handlers-and-pass-them-to-the-AddEditProfileForm-component" class="headerlink" title="Create change and submit handlers and pass them to the AddEditProfileForm component"></a>Create change and submit handlers and pass them to the <strong>AddEditProfileForm</strong> component</h4><p>We can copy both handlers from the <strong>AddProfile</strong>, and just replace the <strong>createUser</strong> mutation method with this component’s <strong>editUser</strong> mutation.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">const</span> handleSubmit = <span class="keyword">async</span> (e:React.FormEvent&lt;HTMLFormElement&gt;) =&gt; &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    editUser();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: HandleChangeType</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, value &#125; = e.target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> payloadValue: string | string[] = name === <span class="string">&quot;hobbies&quot;</span>? value.split(<span class="string">&quot;,&quot;</span>).map(<span class="function"><span class="params">hobby</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hobby.trim();</span><br><span class="line">    &#125;): value;</span><br><span class="line"></span><br><span class="line">    formStateDispatch(&#123; <span class="attr">type</span>: name, <span class="attr">payload</span>: payloadValue &#125;);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Then, we just pass the handler’s as props to the form component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    &lt;div className=<span class="string">&quot;edit-profile__form-wrapper&quot;</span>&gt;</span><br><span class="line">        &lt;AddEditProfileForm    </span><br><span class="line">            handleSubmit=&#123;handleSubmit&#125;</span><br><span class="line">            handleChange=&#123;handleChange&#125;</span><br><span class="line">            countries=&#123;userForEditData?.getUserForEdit.countries&#125;</span><br><span class="line">            formState=&#123;formState&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Use-Redirect-component-to-navigate-to-edited-profile-when-mutation-is-complete"><a href="#Use-Redirect-component-to-navigate-to-edited-profile-when-mutation-is-complete" class="headerlink" title="Use Redirect component to navigate to edited profile when mutation is complete"></a>Use <strong>Redirect</strong> component to navigate to edited profile when mutation is complete</h4><p>This part is the same as in the <strong>AddProfilePage</strong>. Once <strong>pathToEditedUser</strong> is a truthy value, the client is redirected to the user’s profile page.</p>
<p>Here it the code:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// edit-profile.page.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line">...</span><br><span class="line">&#123;pathToEditedUser &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#123;</span>`/<span class="attr">profile</span>/$&#123;<span class="attr">pathToEditedUser</span>&#125;`&#125; /&gt;</span></span>&#125;</span><br></pre></td></tr></table></figure>

<p>////////////////////////////////////////////////////////////////////////////////</p>
<h3 id="Delete-user-with-useMutation-hook"><a href="#Delete-user-with-useMutation-hook" class="headerlink" title="Delete user with useMutation hook"></a>Delete user with useMutation hook</h3><p>When it comes to deleting user, we have set up the mutation query and the resolver on the backend.<br>The mutation takes in an integer argument, and returns a boolean to indicate of the user has been deleted. Maybe we don’t need this boolean, but I guess we do need the query to return something. Also, since I plan to use the <strong>useMutation</strong>‘s <strong>onCompleted</strong> argument property, and I have a suspicion that it will execute anytime the mutaiton completes, even if the user has not been deleted, using a boolean seems like a plan. </p>
<p>More detailed plan is to:</p>
<ol>
<li>Create a delete mutation query in the <strong>ProfilePage</strong> component</li>
<li>Create state to hold a boolean indicating id a user has been deleted once the mutation completes</li>
<li>Use React Router’s <strong>useParams</strong> hook to get the user’s id.</li>
<li>Implement the <strong>useMutation</strong> hook, and add the user’s id as a variable</li>
<li>Pass and type the mutation method to the profile view component as a prop and add a delete button in the <strong>UserProfileDetailed</strong> view component.</li>
<li>Implement <strong>Redirect</strong> component to redirect to <strong>“/home</strong> once the mutation completes</li>
</ol>
<h4 id="Create-a-delete-mutation-query-in-the-ProfilePage-component"><a href="#Create-a-delete-mutation-query-in-the-ProfilePage-component" class="headerlink" title="Create a delete mutation query in the ProfilePage component"></a>Create a delete mutation query in the <strong>ProfilePage</strong> component</h4><p>Nothing to it here:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> USER_DELETE_MUTATION_QUERY = gql<span class="string">`</span></span><br><span class="line"><span class="string">    mutation DeleteUser ($user_id: Int) &#123;</span></span><br><span class="line"><span class="string">        deleteUser(user_id: $user_id) </span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Create-state-to-hold-a-boolean-indicating-id-a-user-has-been-deleted-once-the-mutation-completes"><a href="#Create-state-to-hold-a-boolean-indicating-id-a-user-has-been-deleted-once-the-mutation-completes" class="headerlink" title="Create state to hold a boolean indicating id a user has been deleted once the mutation completes"></a>Create state to hold a boolean indicating id a user has been deleted once the mutation completes</h4><p>Just a simple state with the <strong>useState</strong> hook. It holds a boolean:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> [ isProfileDeleted, setIsProfileDeleted ] = useState&lt;<span class="built_in">Boolean</span>&gt; (<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>

<h4 id="Use-React-Router’s-useParams-hook-to-get-the-user’s-id"><a href="#Use-React-Router’s-useParams-hook-to-get-the-user’s-id" class="headerlink" title="Use React Router’s useParams hook to get the user’s id."></a>Use React Router’s <strong>useParams</strong> hook to get the user’s id.</h4><p>We actually already have this one, from when we fetched the actual user info for the page.</p>
<h4 id="Implement-the-useMutation-hook-and-add-the-user’s-id-as-a-variable"><a href="#Implement-the-useMutation-hook-and-add-the-user’s-id-as-a-variable" class="headerlink" title="Implement the useMutation hook, and add the user’s id as a variable"></a>Implement the <strong>useMutation</strong> hook, and add the user’s id as a variable</h4><p>We’ve done this many times now. Once the mutation completes, we will set the state of <strong>isProfileDeleted</strong> to whatever the mutation returns. We could kinda hardcode a <strong>true</strong> in it instead of the mutation return, but I have suscpicions that the mutation might call the <strong>onCompleted</strong> method even if the mutation doesn’t actually delete the user. </p>
<p>Here is the hook implementation, with only mutation method being destructured from the hook’s return:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">const</span> [ deleteUser ] = useMutation(USER_DELETE_MUTATION_QUERY, &#123;</span><br><span class="line">    variables: &#123;</span><br><span class="line">        user_id: +user_id,</span><br><span class="line">    &#125;, </span><br><span class="line">    onCompleted: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;data from deletion&quot;</span>, data);</span><br><span class="line">        setIsProfileDeleted(data.deleteUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="Pass-and-type-the-mutation-method-to-the-profile-view-component-as-a-prop-and-add-a-delete-button-in-the-UserProfileDetailed-view-component"><a href="#Pass-and-type-the-mutation-method-to-the-profile-view-component-as-a-prop-and-add-a-delete-button-in-the-UserProfileDetailed-view-component" class="headerlink" title="Pass and type the mutation method to the profile view component as a prop and add a delete button in the UserProfileDetailed view component."></a>Pass and type the mutation method to the profile view component as a prop and add a delete button in the <strong>UserProfileDetailed</strong> view component.</h4><p>We will pass the actual mutation method to the view component this time. It is still an issue that I don’t know how to type it in the interface, so I will just type it as an <strong>any</strong> type. </p>
<p>Here is the props passing from the <strong>ProfilePage</strong> component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    &lt;div </span><br><span class="line">        className=<span class="string">&quot;people-section__profile-detailed-wrapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">        &#123;userError &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Unfortunately, there was an error fetching user. Please try again later. <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line">        &#123;userLoading &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>&#125;</span><br><span class="line"></span><br><span class="line">        &#123;userData &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">UserProfileDetailed</span> </span></span></span><br><span class="line"><span class="xml">            user=&#123;userData.getUser&#125;</span></span><br><span class="line"><span class="xml">            deleteUser=&#123;deleteUser&#125;</span></span><br><span class="line"><span class="xml">        /&gt;</span>&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>And here is the interface in the <strong>UserProfileDetailed</strong> component:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-profile-detailed.component.tsx</span></span><br><span class="line">...</span><br><span class="line">interface UserProfileDetailedProps &#123;</span><br><span class="line"></span><br><span class="line">    user: &#123;</span><br><span class="line">        age: number;</span><br><span class="line">        avatar_link: string;</span><br><span class="line">        city: string;</span><br><span class="line">        country: &#123;</span><br><span class="line">            country_name: string;</span><br><span class="line">        &#125;;</span><br><span class="line">        email: string;</span><br><span class="line">        first_name: string;</span><br><span class="line">        last_name: string;</span><br><span class="line">        hobbies: string[];</span><br><span class="line">        user_id: string;</span><br><span class="line">        website: string;</span><br><span class="line">    &#125;;</span><br><span class="line">    deleteUser: any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserProfileDetailed = <span class="function">(<span class="params">&#123; user, deleteUser &#125;: UserProfileDetailedProps</span>) =&gt;</span> &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Finally, we add a button (well, a paragraph actually) to delete user, and attach event listener on it to call the delete function (which has to be a callback in this case, probably becuase i didn’t type it?) when clicked.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user-profile-detailed.component.tsx</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &lt;p </span><br><span class="line">        onClick=&#123;deleteUser&#125;</span><br><span class="line">        className=<span class="string">&quot;basic-info__delete-profile&quot;</span>&gt;Delete profile</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Implement-Redirect-component-to-redirect-to-“-home-once-the-mutation-completes"><a href="#Implement-Redirect-component-to-redirect-to-“-home-once-the-mutation-completes" class="headerlink" title="Implement Redirect component to redirect to “/home once the mutation completes"></a>Implement <strong>Redirect</strong> component to redirect to <strong>“/home</strong> once the mutation completes</h4><p>Finally, we use the <strong>Redirect</strong> in the <strong>ProfilePage</strong> to be rendered depending on the <strong>isProfileDeleted</strong> state.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// profile.page.tsx</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">...</span><br><span class="line">    &#123;isProfileDeleted &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span> /&gt;</span></span>&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<!-- End Step Content -->
<!-- Project Information -->

<h2 id="Project-Information"><a href="#Project-Information" class="headerlink" title="Project Information"></a>Project Information</h2><h3 id="Available-at"><a href="#Available-at" class="headerlink" title="Available at"></a>Available at</h3><p><a target="_blank" rel="noopener" href="https://github.com/ikaem/graphql-jwt-react.git">Github</a> </p>
<h3 id="Goals"><a href="#Goals" class="headerlink" title="Goals"></a>Goals</h3><ol>
<li>Create an app that uses GrapqhQL on frontend and backend</li>
<li>Use PSQL for database</li>
<li>Use Typescript on both ends</li>
<li>The app should be hold a list of users that can be created, viewed, edited, and deleted.</li>
</ol>
<h3 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h3><ol>
<li>Make simple Node and Express server with TypeScript</li>
<li>Create a PostgreSQL database and tables that hold user info</li>
<li>Use node-postgres to connect backend to database</li>
<li>Set up Apollo Express Server</li>
<li>Create GQL types, queries and resolvers on backend</li>
<li>Make simple frontend with React and TS</li>
<li>Set Apollo Client on frontend</li>
<li><strong>Establish frontend and backend communication via Apollo Client</strong></li>
<li>Create pagination</li>
</ol>
<h3 id="Tech-and-Tools"><a href="#Tech-and-Tools" class="headerlink" title="Tech and Tools"></a>Tech and Tools</h3><ol>
<li>React</li>
<li>React Router</li>
<li>Styled Components</li>
<li>Node</li>
<li>PSQL</li>
<li>GraphQL</li>
<li>Apollo Server Express</li>
<li>Apollo Client</li>
<li>Bcrypt</li>
<li>TypeScript</li>
<li>Express</li>
</ol>
<h3 id="Experience-with-Tech-amp-Tools"><a href="#Experience-with-Tech-amp-Tools" class="headerlink" title="Experience with Tech &amp; Tools"></a>Experience with Tech &amp; Tools</h3><p>I am new to Typescript, have super little experience with PSQL and GQL and just a tiny bit more skills with Node and Express.<br>I am relatively ok with JS, React and other frontend stuff from the list but I am no way even close to be a seasoned frontend person.</p>
<h2 id="DISCLAIMER"><a href="#DISCLAIMER" class="headerlink" title="DISCLAIMER"></a>DISCLAIMER</h2><p>Don’t take any of this seriously and as a matter-of-fact. These are my notes. It might look like I am trying to teach something to someone. I am not.</p>


                


                <!-- Cover image credit -->
                

  

            </div>
            
            <!-- Custom placed tags -->
            <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                
                    


<a href="/angry-chaired-blog/tags/react/">#react</a> <a href="/angry-chaired-blog/tags/apollo/">#apollo</a> <a href="/angry-chaired-blog/tags/frontend/">#frontend</a> <a href="/angry-chaired-blog/tags/backend/">#backend</a>


                
            </div>
            <!--  -->



            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            

            <!-- Hyvor comments -->

            <!-- End of Hyvor comments -->
        </div>
    </div>
</article>



    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2020 kaem<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>